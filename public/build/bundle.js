var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function s(e){e.forEach(t)}function i(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function o(t,n,s){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const s=t.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}(n,s))}function a(e,t,n){return e.set(n),t}function c(e,t){e.appendChild(t)}function l(e,t,n){e.insertBefore(t,n||null)}function u(e){e.parentNode.removeChild(e)}function h(e){return document.createElement(e)}function p(e){return document.createTextNode(e)}function d(){return p(" ")}function m(){return p("")}function f(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function _(e){return""===e?null:+e}function v(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function y(e,t){e.value=null==t?"":t}let w;function b(e){w=e}function x(){if(!w)throw new Error("Function called outside component initialization");return w}function C(e){x().$$.before_update.push(e)}const T=[],A=[],S=[],E=[],O=Promise.resolve();let k=!1;function P(e){S.push(e)}function $(e){E.push(e)}const M=new Set;let R=0;function N(){const e=w;do{for(;R<T.length;){const e=T[R];R++,b(e),I(e.$$)}for(b(null),T.length=0,R=0;A.length;)A.pop()();for(let e=0;e<S.length;e+=1){const t=S[e];M.has(t)||(M.add(t),t())}S.length=0}while(T.length);for(;E.length;)E.pop()();k=!1,M.clear(),b(e)}function I(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(P)}}const L=new Set;let D;function V(){D={r:0,c:[],p:D}}function j(){D.r||s(D.c),D=D.p}function G(e,t){e&&e.i&&(L.delete(e),e.i(t))}function B(e,t,n,s){if(e&&e.o){if(L.has(e))return;L.add(e),D.c.push((()=>{L.delete(e),s&&(n&&e.d(1),s())})),e.o(t)}}function F(e,t,n){const s=e.$$.props[t];void 0!==s&&(e.$$.bound[s]=n,n(e.$$.ctx[s]))}function q(e){e&&e.c()}function U(e,n,r,o){const{fragment:a,on_mount:c,on_destroy:l,after_update:u}=e.$$;a&&a.m(n,r),o||P((()=>{const n=c.map(t).filter(i);l?l.push(...n):s(n),e.$$.on_mount=[]})),u.forEach(P)}function W(e,t){const n=e.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function H(e,t){-1===e.$$.dirty[0]&&(T.push(e),k||(k=!0,O.then(N)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Y(t,i,r,o,a,c,l,h=[-1]){const p=w;b(t);const d=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(p?p.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:i.target||p.$$.root};l&&l(d.root);let m=!1;if(d.ctx=r?r(t,i.props||{},((e,n,...s)=>{const i=s.length?s[0]:n;return d.ctx&&a(d.ctx[e],d.ctx[e]=i)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](i),m&&H(t,e)),n})):[],d.update(),m=!0,s(d.before_update),d.fragment=!!o&&o(d.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);d.fragment&&d.fragment.l(e),e.forEach(u)}else d.fragment&&d.fragment.c();i.intro&&G(t.$$.fragment),U(t,i.target,i.anchor,i.customElement),N()}b(p)}class z{$destroy(){W(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var X,Z;!function(e){e.NONE="NONE",e.CONNECT_CHAT="CONNECT_CHAT",e.MAIN_MENU="MAIN_MENU",e.INTRO="INTRO",e.SETTINGS="SETTINGS",e.ABOUT="ABOUT",e.CREDITS="CREDITS",e.GAME="GAME"}(X||(X={})),function(e){e.CONNECT_CHAT="CONNECT_CHAT",e.DISCONNECT_CHAT="DISCONNECT_CHAT",e.NEW_CLEAVAGE="NEW_CLEAVAGE",e.LAUNCH_CLEAVAGE="LAUNCH_CLEAVAGE",e.PLAYER_CLEAVE="PLAYER_CLEAVE",e.PLAYER_MESSAGE="PLAYER_MESSAGE",e.DRAW_CLEAVAGE="DRAW_CLEAVAGE",e.PLAYER_SUGGEST_CLEAVAGE="SUGGEST_CLEAVAGE",e.PLAYER_ASK_FOR_HELP="PLAYER_ASK_FOR_HELP",e.CANCEL_CLEAVAGE="CANCEL_CLEAVAGE",e.PLAYER_HYPERLIKE="PLAYER_HYPERLIKE",e.PLAYER_APPLAUSE="PLAYER_APPLAUSE",e.PLAYER_SHOOT="PLAYER_SHOOT",e.PLAYER_WHISTLE="PLAYER_WHISTLE",e.APPLICATION_START="APPLICATION_START",e.NAVIGATE="NAVIGATE",e.CHANGE_MUSIC_VOLUME="CHANGE_MUSIC_VOLUME",e.CHANGE_SOUND_VOLUME="CHANGE_SOUND_VOLUME",e.PLAYER_QUIT="PLAYER_QUIT",e.START_AUTOPLAY="START_AUTOPLAY",e.CHECK_AUTOPLAY="CHECK_AUTOPLAY",e.STOP_AUTOPLAY="STOP_AUTOPLAY",e.DRAW_GLOBAL_CLEAVAGE_DRAWPILE="DRAW_GLOBAL_CLEAVAGE_DRAWPILE",e.SAVE_CLEAVAGE_ON_GLOBAL_CLEAVAGE_DRAWPILE="SAVE_CLEAVAGE_ON_GLOBAL_CLEAVAGE_DRAWPILE",e.PLAYER_JOIN_BAR="PLAYER_JOIN_BAR",e.PLAYER_MOVE="PLAYER_MOVE",e.INSTALL_NEW_TABLE="INSTALL_NEW_TABLE",e.INSTALL_NEW_STOOLS_ON_TABLE="INSTALL_NEW_STOOLS_ON_TABLE",e.TABLE_STOOL_AVAILABLE="TABLE_STOOL_AVAILABLE",e.CREATE_BAR="CREATE_BAR",e.DRAW="DRAW",e.INSTALL_NEW_STOOLS_ON_BAR="INSTALL_NEW_STOOLS_ON_BAR",e.CHANGE_GAME_PHASE="CHANGE_GAME_PHASE"}(Z||(Z={}));class J{}class K extends J{constructor(e,t,n){super(),this.username=e,this.token=t,this.channel=n,this.eventType=Z.CONNECT_CHAT}}class Q extends J{constructor(e){super(),this.targetView=e,this.eventType=Z.NAVIGATE}}function ee(t){let n,s,r,o,a;return{c(){n=h("button"),s=p(t[1]),g(n,"class",r=("large"===t[2]?"text-2xl":"text")+" "+(t[3]?"w-full":"")+" p-2 m-2 "+(t[4]<33?"":t[4]<66?"rotate-3":"-rotate-3")+" bg-dark-background text-no-emphasis font-sans border-2 rounded-xl border-medium-emphasis active:border-low-emphasis focus:border-low-emphasis"),g(n,"type","button")},m(e,r){l(e,n,r),c(n,s),o||(a=f(n,"click",(function(){i(t[0])&&t[0].apply(this,arguments)})),o=!0)},p(e,[i]){t=e,2&i&&v(s,t[1]),12&i&&r!==(r=("large"===t[2]?"text-2xl":"text")+" "+(t[3]?"w-full":"")+" p-2 m-2 "+(t[4]<33?"":t[4]<66?"rotate-3":"-rotate-3")+" bg-dark-background text-no-emphasis font-sans border-2 rounded-xl border-medium-emphasis active:border-low-emphasis focus:border-low-emphasis")&&g(n,"class",r)},i:e,o:e,d(e){e&&u(n),o=!1,a()}}}function te(e,t,n){let{onClick:s}=t,{text:i}=t,{size:r="medium"}=t,{wfull:o=!1}=t;const a=100*Math.random();return e.$$set=e=>{"onClick"in e&&n(0,s=e.onClick),"text"in e&&n(1,i=e.text),"size"in e&&n(2,r=e.size),"wfull"in e&&n(3,o=e.wfull)},[s,i,r,o,a]}class ne extends z{constructor(e){super(),Y(this,e,te,ee,r,{onClick:0,text:1,size:2,wfull:3})}}function se(e){let t,n,s,i,r;return{c(){t=h("input"),g(t,"class",n="p-1 "+(e[5]?"m-5 text-2xl":"m-5 text-xl")+" "+(e[7]<33?"":e[7]<66?"rotate-3":"-rotate-3")+" rounded-xl border-low-emphasis focus:border-medium-emphasis focus:ring-1 focus:ring-medium-emphasis text-no-emphasis placeholder-no-emphasis border-2 bg-dark-background font-sans text-center"),g(t,"type","password"),g(t,"id",e[3]),g(t,"name",e[4]),t.required=!0,g(t,"placeholder",e[2]),g(t,"autocomplete",s="password"===e[1]?"new-password":null)},m(n,s){l(n,t,s),y(t,e[0]),i||(r=f(t,"input",e[10]),i=!0)},p(e,i){32&i&&n!==(n="p-1 "+(e[5]?"m-5 text-2xl":"m-5 text-xl")+" "+(e[7]<33?"":e[7]<66?"rotate-3":"-rotate-3")+" rounded-xl border-low-emphasis focus:border-medium-emphasis focus:ring-1 focus:ring-medium-emphasis text-no-emphasis placeholder-no-emphasis border-2 bg-dark-background font-sans text-center")&&g(t,"class",n),8&i&&g(t,"id",e[3]),16&i&&g(t,"name",e[4]),4&i&&g(t,"placeholder",e[2]),2&i&&s!==(s="password"===e[1]?"new-password":null)&&g(t,"autocomplete",s),1&i&&t.value!==e[0]&&y(t,e[0])},d(e){e&&u(t),i=!1,r()}}}function ie(e){let t,n,s,i;return{c(){t=h("input"),g(t,"class",n="p-1 "+(e[5]?"m-5 text-2xl":"m-5 text-xl")+" "+(e[7]<33?"":e[7]<66?"rotate-3":"-rotate-3")+" rounded-xl border-low-emphasis focus:border-medium-emphasis focus:ring-1 focus:ring-medium-emphasis text-no-emphasis placeholder-no-emphasis border-2 bg-dark-background font-sans text-center"),g(t,"type","text"),g(t,"id",e[3]),g(t,"name",e[4]),t.required=!0,g(t,"placeholder",e[2])},m(n,r){l(n,t,r),y(t,e[0]),s||(i=f(t,"input",e[9]),s=!0)},p(e,s){32&s&&n!==(n="p-1 "+(e[5]?"m-5 text-2xl":"m-5 text-xl")+" "+(e[7]<33?"":e[7]<66?"rotate-3":"-rotate-3")+" rounded-xl border-low-emphasis focus:border-medium-emphasis focus:ring-1 focus:ring-medium-emphasis text-no-emphasis placeholder-no-emphasis border-2 bg-dark-background font-sans text-center")&&g(t,"class",n),8&s&&g(t,"id",e[3]),16&s&&g(t,"name",e[4]),4&s&&g(t,"placeholder",e[2]),1&s&&t.value!==e[0]&&y(t,e[0])},d(e){e&&u(t),s=!1,i()}}}function re(e){let t,n,s,i;return{c(){t=h("textarea"),g(t,"class",n="p-1 "+(e[5]?"m-5 text-2xl":"m-5 text-xl")+" "+(e[7]<33?"":e[7]<66?"rotate-3":"-rotate-3")+" rounded-xl border-low-emphasis focus:border-medium-emphasis text-no-emphasis placeholder-no-emphasis border-2 bg-dark-background font-sans text-center"),g(t,"id",e[3]),g(t,"name",e[4]),g(t,"rows",e[6]),g(t,"cols",ae),t.required=!0,g(t,"placeholder",e[2]),g(t,"autocomplete","new-password")},m(n,r){l(n,t,r),y(t,e[0]),s||(i=f(t,"input",e[8]),s=!0)},p(e,s){32&s&&n!==(n="p-1 "+(e[5]?"m-5 text-2xl":"m-5 text-xl")+" "+(e[7]<33?"":e[7]<66?"rotate-3":"-rotate-3")+" rounded-xl border-low-emphasis focus:border-medium-emphasis text-no-emphasis placeholder-no-emphasis border-2 bg-dark-background font-sans text-center")&&g(t,"class",n),8&s&&g(t,"id",e[3]),16&s&&g(t,"name",e[4]),64&s&&g(t,"rows",e[6]),4&s&&g(t,"placeholder",e[2]),1&s&&y(t,e[0])},d(e){e&&u(t),s=!1,i()}}}function oe(t){let n;function s(e,t){return"textarea"===e[1]?re:"text"===e[1]?ie:"password"===e[1]?se:void 0}let i=s(t),r=i&&i(t);return{c(){r&&r.c(),n=m()},m(e,t){r&&r.m(e,t),l(e,n,t)},p(e,[t]){i===(i=s(e))&&r?r.p(e,t):(r&&r.d(1),r=i&&i(e),r&&(r.c(),r.m(n.parentNode,n)))},i:e,o:e,d(e){r&&r.d(e),e&&u(n)}}}const ae=30;function ce(e,t,n){let s,{inputValue:i}=t,{type:r="text"}=t,{placeholder:o}=t,{id:a}=t,{name:c}=t,{mainInput:l=!1}=t;const u=100*Math.random();return C((()=>{if("textarea"===r){let e=Math.round(i.length/ae);n(6,s=e<1?1:e)}})),e.$$set=e=>{"inputValue"in e&&n(0,i=e.inputValue),"type"in e&&n(1,r=e.type),"placeholder"in e&&n(2,o=e.placeholder),"id"in e&&n(3,a=e.id),"name"in e&&n(4,c=e.name),"mainInput"in e&&n(5,l=e.mainInput)},[i,r,o,a,c,l,s,u,function(){i=this.value,n(0,i)},function(){i=this.value,n(0,i)},function(){i=this.value,n(0,i)}]}class le extends z{constructor(e){super(),Y(this,e,ce,oe,r,{inputValue:0,type:1,placeholder:2,id:3,name:4,mainInput:5})}}function ue(e){let t,n;return{c(){t=h("a"),n=p(e[0]),g(t,"class","text-center font-sans underline text-low-emphasis hover:text-medium-emphasis visited:text-low-emphasis "+(e[3]<33?"":e[3]<66?"rotate-3":"-rotate-3")),g(t,"href",e[1])},m(e,s){l(e,t,s),c(t,n)},p(e,s){1&s&&v(n,e[0]),2&s&&g(t,"href",e[1])},d(e){e&&u(t)}}}function he(e){let t,n;return{c(){t=h("a"),n=p(e[0]),g(t,"class","text-center font-sans underline text-low-emphasis hover:text-medium-emphasis visited:text-low-emphasis "+(e[3]<33?"":e[3]<66?"rotate-3":"-rotate-3")),g(t,"href",e[1]),g(t,"target","_blank")},m(e,s){l(e,t,s),c(t,n)},p(e,s){1&s&&v(n,e[0]),2&s&&g(t,"href",e[1])},d(e){e&&u(t)}}}function pe(t){let n;function s(e,t){return e[2]?he:ue}let i=s(t),r=i(t);return{c(){r.c(),n=m()},m(e,t){r.m(e,t),l(e,n,t)},p(e,[t]){i===(i=s(e))&&r?r.p(e,t):(r.d(1),r=i(e),r&&(r.c(),r.m(n.parentNode,n)))},i:e,o:e,d(e){r.d(e),e&&u(n)}}}function de(e,t,n){let{text:s}=t,{href:i}=t,{newTab:r=!1}=t;const o=100*Math.random();return e.$$set=e=>{"text"in e&&n(0,s=e.text),"href"in e&&n(1,i=e.href),"newTab"in e&&n(2,r=e.newTab)},[s,i,r,o]}class me extends z{constructor(e){super(),Y(this,e,de,pe,r,{text:0,href:1,newTab:2})}}function fe(t){let n,s=t[0].replaceAll("\n","<br>")+"";return{c(){n=h("h2"),g(n,"class","my-3 "+(t[1]<33?"":t[1]<66?"rotate-3":"-rotate-3")+" text-xl font-sans text-center text-medium-emphasis")},m(e,t){l(e,n,t),n.innerHTML=s},p(e,[t]){1&t&&s!==(s=e[0].replaceAll("\n","<br>")+"")&&(n.innerHTML=s)},i:e,o:e,d(e){e&&u(n)}}}function ge(e,t,n){let{subtitle:s=""}=t;const i=100*Math.random();return e.$$set=e=>{"subtitle"in e&&n(0,s=e.subtitle)},[s,i]}class _e extends z{constructor(e){super(),Y(this,e,ge,fe,r,{subtitle:0})}}function ve(t){let n,s;return{c(){n=h("h1"),s=p(t[0]),g(n,"class","my-3 "+(t[1]<33?"":t[1]<66?"rotate-3":"-rotate-3")+" text-center text-6xl break-all font-sans font-bold text-high-emphasis")},m(e,t){l(e,n,t),c(n,s)},p(e,[t]){1&t&&v(s,e[0])},i:e,o:e,d(e){e&&u(n)}}}function ye(e,t,n){let{title:s="Le jeu du clivage"}=t,{rotate:i=!0}=t;const r=i?100*Math.random():0;return e.$$set=e=>{"title"in e&&n(0,s=e.title),"rotate"in e&&n(2,i=e.rotate)},[s,r,i]}class we extends z{constructor(e){super(),Y(this,e,ye,ve,r,{title:0,rotate:2})}}const be=[];function xe(t,n=e){let s;const i=new Set;function o(e){if(r(t,e)&&(t=e,s)){const e=!be.length;for(const e of i)e[1](),be.push(e,t);if(e){for(let e=0;e<be.length;e+=2)be[e][0](be[e+1]);be.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(r,a=e){const c=[r,a];return i.add(c),1===i.size&&(s=n(o)||e),r(t),()=>{i.delete(c),0===i.size&&(s(),s=null)}}}}var Ce;!function(e){e.CLEAVING="CLEAVING",e.NEW_CLEAVAGE="NEW_CLEAVAGE",e.NONE="NONE"}(Ce||(Ce={}));const Te=xe(void 0),Ae=xe(void 0),Se=xe(X.NONE),Ee=xe(100),Oe=xe(100),ke=xe(!1),Pe=xe(Ce.NONE);function $e(e){let t,n;return t=new ne({props:{text:"Connexion Twitch !",onClick:e[6]}}),{c(){q(t.$$.fragment)},m(e,s){U(t,e,s),n=!0},p(e,n){const s={};7&n&&(s.onClick=e[6]),t.$set(s)},i(e){n||(G(t.$$.fragment,e),n=!0)},o(e){B(t.$$.fragment,e),n=!1},d(e){W(t,e)}}}function Me(e){let t,n,s,i,r,o,a,p,m,f,_,v,y,w,b,x,C,T,S,E,O,k;function P(t){e[3](t)}s=new we({}),r=new _e({props:{subtitle:"Connectes-toi sur ta chaine Twitch pour faire participer tes viewers !!!"}});let M={id:"user",name:"user",placeholder:"Utilisateur Twitch"};function R(t){e[4](t)}void 0!==e[0]&&(M.inputValue=e[0]),m=new le({props:M}),A.push((()=>F(m,"inputValue",P)));let N={id:"password",name:"password",placeholder:"Token Twitch",type:"password"};function I(t){e[5](t)}void 0!==e[1]&&(N.inputValue=e[1]),v=new le({props:N}),A.push((()=>F(v,"inputValue",R)));let L={id:"channel",name:"channel",placeholder:"Chaine Twitch"};void 0!==e[2]&&(L.inputValue=e[2]),b=new le({props:L}),A.push((()=>F(b,"inputValue",I)));let D=e[0]&&e[1]&&e[2]&&$e(e);return S=new ne({props:{text:"Menu principal",onClick:e[7]}}),O=new me({props:{text:"Twitch Token Generator",href:"https://twitchapps.com/tmi/",newTab:!0}}),{c(){t=h("main"),n=h("div"),q(s.$$.fragment),i=d(),q(r.$$.fragment),o=d(),a=h("div"),p=h("div"),q(m.$$.fragment),_=d(),q(v.$$.fragment),w=d(),q(b.$$.fragment),C=d(),D&&D.c(),T=d(),q(S.$$.fragment),E=d(),q(O.$$.fragment),g(n,"class","flex flex-col w-full items-center"),g(p,"class","flex flex-col items-center"),g(a,"class","flex flex-row w-full place-items-center justify-center"),g(t,"class","bg-dark-background h-full w-full flex flex-col justify-evenly")},m(e,u){l(e,t,u),c(t,n),U(s,n,null),c(n,i),U(r,n,null),c(t,o),c(t,a),c(a,p),U(m,p,null),c(p,_),U(v,p,null),c(p,w),U(b,p,null),c(p,C),D&&D.m(p,null),c(p,T),U(S,p,null),c(a,E),U(O,a,null),k=!0},p(e,[t]){const n={};!f&&1&t&&(f=!0,n.inputValue=e[0],$((()=>f=!1))),m.$set(n);const s={};!y&&2&t&&(y=!0,s.inputValue=e[1],$((()=>y=!1))),v.$set(s);const i={};!x&&4&t&&(x=!0,i.inputValue=e[2],$((()=>x=!1))),b.$set(i),e[0]&&e[1]&&e[2]?D?(D.p(e,t),7&t&&G(D,1)):(D=$e(e),D.c(),G(D,1),D.m(p,T)):D&&(V(),B(D,1,1,(()=>{D=null})),j())},i(e){k||(G(s.$$.fragment,e),G(r.$$.fragment,e),G(m.$$.fragment,e),G(v.$$.fragment,e),G(b.$$.fragment,e),G(D),G(S.$$.fragment,e),G(O.$$.fragment,e),k=!0)},o(e){B(s.$$.fragment,e),B(r.$$.fragment,e),B(m.$$.fragment,e),B(v.$$.fragment,e),B(b.$$.fragment,e),B(D),B(S.$$.fragment,e),B(O.$$.fragment,e),k=!1},d(e){e&&u(t),W(s),W(r),W(m),W(v),W(b),D&&D.d(),W(S),W(O)}}}function Re(e,t,n){let s="",i="",r="";return[s,i,r,function(e){s=e,n(0,s)},function(e){i=e,n(1,i)},function(e){r=e,n(2,r)},()=>Te.set(new K(s,i,r)),()=>Te.set(new Q(X.MAIN_MENU))]}class Ne extends z{constructor(e){super(),Y(this,e,Re,Me,r,{})}}function Ie(t){let n,s;return{c(){n=h("p"),g(n,"class",s="font-sans text-low-emphasis "+(t[1]?"text-center":"text-justify")+" w-full md:w-2/3 lg:w-1/2 "+(t[2]<33?"":t[2]<66?"rotate-1":"-rotate-1")+" p-3")},m(e,s){l(e,n,s),n.innerHTML=t[0]},p(e,[t]){1&t&&(n.innerHTML=e[0]),2&t&&s!==(s="font-sans text-low-emphasis "+(e[1]?"text-center":"text-justify")+" w-full md:w-2/3 lg:w-1/2 "+(e[2]<33?"":e[2]<66?"rotate-1":"-rotate-1")+" p-3")&&g(n,"class",s)},i:e,o:e,d(e){e&&u(n)}}}function Le(e,t,n){let{text:s}=t,{center:i=!1}=t;const r=100*Math.random();return e.$$set=e=>{"text"in e&&n(0,s=e.text),"center"in e&&n(1,i=e.center)},[s,i,r]}class De extends z{constructor(e){super(),Y(this,e,Le,Ie,r,{text:0,center:1})}}function Ve(t){let n,s,i,r,o,a,p,m,f,_,v,y,w,b,x,C,T,A,S,E,O,k;return i=new we({}),o=new _e({props:{subtitle:"A propos"}}),m=new De({props:{text:t[0]}}),_=new De({props:{text:t[1],center:!0}}),y=new me({props:{text:"GitHub",href:"https://github.com/Sometimes-Useful/the-cleavage-game",newTab:!0}}),b=new me({props:{text:"Replay du dev",href:"https://youtube.com/playlist?list=PL4jAusJfrmMsRWjFhgjZXcPnEZdkUnLGc",newTab:!0}}),C=new me({props:{text:"Chaine Twitch pour le live",href:"https://www.twitch.tv/benjaminbohec",newTab:!0}}),A=new De({props:{text:t[2],center:!0}}),O=new ne({props:{onClick:t[3],text:"Menu Principal!"}}),{c(){n=h("main"),s=h("div"),q(i.$$.fragment),r=d(),q(o.$$.fragment),a=d(),p=h("div"),q(m.$$.fragment),f=d(),q(_.$$.fragment),v=d(),q(y.$$.fragment),w=d(),q(b.$$.fragment),x=d(),q(C.$$.fragment),T=d(),q(A.$$.fragment),S=d(),E=h("div"),q(O.$$.fragment),g(s,"class","flex flex-col w-full items-center"),g(p,"class","flex flex-col w-full items-center"),g(E,"class","flex flex-col w-full items-center"),g(n,"class","bg-dark-background h-full w-full flex flex-col justify-evenly")},m(e,t){l(e,n,t),c(n,s),U(i,s,null),c(s,r),U(o,s,null),c(n,a),c(n,p),U(m,p,null),c(p,f),U(_,p,null),c(p,v),U(y,p,null),c(p,w),U(b,p,null),c(p,x),U(C,p,null),c(p,T),U(A,p,null),c(n,S),c(n,E),U(O,E,null),k=!0},p:e,i(e){k||(G(i.$$.fragment,e),G(o.$$.fragment,e),G(m.$$.fragment,e),G(_.$$.fragment,e),G(y.$$.fragment,e),G(b.$$.fragment,e),G(C.$$.fragment,e),G(A.$$.fragment,e),G(O.$$.fragment,e),k=!0)},o(e){B(i.$$.fragment,e),B(o.$$.fragment,e),B(m.$$.fragment,e),B(_.$$.fragment,e),B(y.$$.fragment,e),B(b.$$.fragment,e),B(C.$$.fragment,e),B(A.$$.fragment,e),B(O.$$.fragment,e),k=!1},d(e){e&&u(n),W(i),W(o),W(m),W(_),W(y),W(b),W(C),W(A),W(O)}}}function je(e){return["Le jeu du clivage est un jeu qui permet aux joueurs de cliver sur un sujet choisi par le maitre du jeu.\n    Le joueur doit choisir si le sujet est de gauche ou de droite.\n    Le joueur peut aussi proposer au maitre du jeu de nouveaux clivages et participer dans le débat (applaudir, huer,...)","Le jeu du clivage est un projet open source et gratuit.","Nous avons besoin de votre soutient pour pouvoir passer plus de temps au développement du jeu. Hésitez pas à nous contacter à l'addresse bbohec.pro[AT]gmail.com si vous souhaitez nous aider.",()=>Te.set(new Q(X.MAIN_MENU))]}class Ge extends z{constructor(e){super(),Y(this,e,je,Ve,r,{})}}class Be extends J{constructor(){super(...arguments),this.eventType=Z.DISCONNECT_CHAT}}class Fe extends J{constructor(){super(...arguments),this.eventType=Z.NEW_CLEAVAGE}}function qe(t){let n,s,i,r,o,a,p,m,f,_,v,y,w,b,x;return i=new we({}),o=new _e({props:{subtitle:"El famoso!\r\n        Le jeu du clivage où on décide ENFIN si quelque chose est finalement de gauche ou de droite.\r\n        Un super jeu politique pour fight entre amis ou en famille. Attention, mamie c'est le boss final...\r\n        Version streamer!\r\n        Tellement digital! Tellement handspinner! Le plaisir.\r\n        Parfait pour préparer l'élection présidentielle de 2022 ou quand on s'emmerde...\r\n        94.99$ seulement! Wouah!"}}),m=new ne({props:{text:"Jouer !",size:"large",onClick:t[0]}}),_=new ne({props:{text:"Options !",size:"large",onClick:t[1]}}),y=new ne({props:{text:"Credits !",size:"large",onClick:t[2]}}),b=new ne({props:{text:"A propos !",size:"large",onClick:t[3]}}),{c(){n=h("main"),s=h("div"),q(i.$$.fragment),r=d(),q(o.$$.fragment),a=d(),p=h("div"),q(m.$$.fragment),f=d(),q(_.$$.fragment),v=d(),q(y.$$.fragment),w=d(),q(b.$$.fragment),g(s,"class","flex flex-col items-center"),g(p,"class","flex flex-col items-center"),g(n,"class","bg-dark-background h-full w-full flex flex-col justify-evenly")},m(e,t){l(e,n,t),c(n,s),U(i,s,null),c(s,r),U(o,s,null),c(n,a),c(n,p),U(m,p,null),c(p,f),U(_,p,null),c(p,v),U(y,p,null),c(p,w),U(b,p,null),x=!0},p:e,i(e){x||(G(i.$$.fragment,e),G(o.$$.fragment,e),G(m.$$.fragment,e),G(_.$$.fragment,e),G(y.$$.fragment,e),G(b.$$.fragment,e),x=!0)},o(e){B(i.$$.fragment,e),B(o.$$.fragment,e),B(m.$$.fragment,e),B(_.$$.fragment,e),B(y.$$.fragment,e),B(b.$$.fragment,e),x=!1},d(e){e&&u(n),W(i),W(o),W(m),W(_),W(y),W(b)}}}function Ue(e){return[()=>Te.set(new Fe),()=>Te.set(new Q(X.SETTINGS)),()=>Te.set(new Q(X.CREDITS)),()=>Te.set(new Q(X.ABOUT))]}class We extends z{constructor(e){super(),Y(this,e,Ue,qe,r,{})}}class He extends J{constructor(e){super(),this.volume=e,this.eventType=Z.CHANGE_MUSIC_VOLUME}}class Ye extends J{constructor(e){super(),this.volume=e,this.eventType=Z.CHANGE_SOUND_VOLUME}}function ze(t){let n,s,r,o,a,m,_,y,w;return{c(){n=h("div"),s=h("label"),r=p(t[1]),o=p(" - "),a=p(t[6]),m=d(),_=h("input"),g(s,"for",t[0]),g(s,"class","form-label text-low-emphasis font-sans mb-2"),g(_,"type","range"),g(_,"class","form-range appearance-none border-2 rounded-md w-full md:w-1/2 xl:w-1/3 h-1 border-low-emphasis accent-high-emphasis "+(t[7]<33?"":t[7]<66?"rotate-1":"-rotate-1")),_.value=t[6],g(_,"min",t[2]),g(_,"max",t[3]),g(_,"step",t[4]),g(_,"id",t[0]),g(n,"class","flex flex-col w-full items-center p-3")},m(e,u){l(e,n,u),c(n,s),c(s,r),c(s,o),c(s,a),c(n,m),c(n,_),y||(w=f(_,"input",(function(){i(t[5])&&t[5].apply(this,arguments)})),y=!0)},p(e,[n]){t=e,2&n&&v(r,t[1]),64&n&&v(a,t[6]),1&n&&g(s,"for",t[0]),64&n&&(_.value=t[6]),4&n&&g(_,"min",t[2]),8&n&&g(_,"max",t[3]),16&n&&g(_,"step",t[4]),1&n&&g(_,"id",t[0])},i:e,o:e,d(e){e&&u(n),y=!1,w()}}}function Xe(e,t,n){let{id:s}=t,{text:i}=t,{min:r=0}=t,{max:o=100}=t,{step:a=1}=t,{onInput:c}=t,{value:l}=t;const u=100*Math.random();return e.$$set=e=>{"id"in e&&n(0,s=e.id),"text"in e&&n(1,i=e.text),"min"in e&&n(2,r=e.min),"max"in e&&n(3,o=e.max),"step"in e&&n(4,a=e.step),"onInput"in e&&n(5,c=e.onInput),"value"in e&&n(6,l=e.value)},[s,i,r,o,a,c,l,u]}class Ze extends z{constructor(e){super(),Y(this,e,Xe,ze,r,{id:0,text:1,min:2,max:3,step:4,onInput:5,value:6})}}function Je(e){let t,n,s,i,r,o,a,p,m,f,_,v,y,w;return s=new we({}),r=new _e({props:{subtitle:"Options"}}),p=new Ze({props:{id:"musicVolume",text:"Volume - Musique",onInput:e[2],value:e[1]}}),f=new Ze({props:{id:"soundVolume",text:"Volume - Sons",onInput:e[3],value:e[0]}}),y=new ne({props:{onClick:e[4],text:"Menu Principal!"}}),{c(){t=h("main"),n=h("div"),q(s.$$.fragment),i=d(),q(r.$$.fragment),o=d(),a=h("div"),q(p.$$.fragment),m=d(),q(f.$$.fragment),_=d(),v=h("div"),q(y.$$.fragment),g(n,"class","flex flex-col w-full items-center"),g(a,"class","flex flex-col w-full items-center"),g(v,"class","flex flex-col w-full items-center"),g(t,"class","bg-dark-background h-full w-full flex flex-col justify-evenly")},m(e,u){l(e,t,u),c(t,n),U(s,n,null),c(n,i),U(r,n,null),c(t,o),c(t,a),U(p,a,null),c(a,m),U(f,a,null),c(t,_),c(t,v),U(y,v,null),w=!0},p(e,[t]){const n={};2&t&&(n.value=e[1]),p.$set(n);const s={};1&t&&(s.value=e[0]),f.$set(s)},i(e){w||(G(s.$$.fragment,e),G(r.$$.fragment,e),G(p.$$.fragment,e),G(f.$$.fragment,e),G(y.$$.fragment,e),w=!0)},o(e){B(s.$$.fragment,e),B(r.$$.fragment,e),B(p.$$.fragment,e),B(f.$$.fragment,e),B(y.$$.fragment,e),w=!1},d(e){e&&u(t),W(s),W(r),W(p),W(f),W(y)}}}function Ke(e,t,n){let s,i;Oe.subscribe((e=>n(0,s=e))),Ee.subscribe((e=>n(1,i=e)));return[s,i,e=>Te.set(new He(parseInt(e.currentTarget.value))),e=>Te.set(new Ye(parseInt(e.currentTarget.value))),()=>Te.set(new Q(X.MAIN_MENU))]}class Qe extends z{constructor(e){super(),Y(this,e,Ke,Je,r,{})}}const et="14.7.77";var tt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function nt(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})})),t}var st,it={exports:{}},rt={exports:{}},ot={exports:{}};(st=ot).exports=function(e){if(Array.isArray(e))return e},st.exports.__esModule=!0,st.exports.default=st.exports;var at={exports:{}};!function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var s,i,r=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(s=n.next()).done)&&(r.push(s.value),!t||r.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return r}},e.exports.__esModule=!0,e.exports.default=e.exports}(at);var ct={exports:{}},lt={exports:{}};!function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s},e.exports.__esModule=!0,e.exports.default=e.exports}(lt),function(e){var t=lt.exports;e.exports=function(e,n){if(e){if("string"==typeof e)return t(e,n);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?t(e,n):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}(ct);var ut={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(ut),function(e){var t=ot.exports,n=at.exports,s=ct.exports,i=ut.exports;e.exports=function(e,r){return t(e)||n(e,r)||s(e,r)||i()},e.exports.__esModule=!0,e.exports.default=e.exports}(rt);var ht={exports:{}};!function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports}(ht);var pt={exports:{}};!function(e){function t(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}e.exports=function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}(pt),function(e,t,n,s){function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=i(t),o=i(n),a=i(s),c=function(e,t,n){return{endTime:t,insertTime:n,type:"exponentialRampToValue",value:e}},l=function(e,t,n){return{endTime:t,insertTime:n,type:"linearRampToValue",value:e}},u=function(e,t){return{startTime:t,type:"setValue",value:e}},h=function(e,t,n){return{duration:n,startTime:t,type:"setValueCurve",values:e}},p=function(e,t,n){var s=n.startTime,i=n.target,r=n.timeConstant;return i+(t-i)*Math.exp((s-e)/r)},d=function(e){return"exponentialRampToValue"===e.type},m=function(e){return"linearRampToValue"===e.type},f=function(e){return d(e)||m(e)},g=function(e){return"setValue"===e.type},_=function(e){return"setValueCurve"===e.type},v=function e(t,n,s,i){var r=t[n];return void 0===r?i:f(r)||g(r)?r.value:_(r)?r.values[r.values.length-1]:p(s,e(t,n-1,r.startTime,i),r)},y=function(e,t,n,s,i){return void 0===n?[s.insertTime,i]:f(n)?[n.endTime,n.value]:g(n)?[n.startTime,n.value]:_(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,v(e,t-1,n.startTime,i)]},w=function(e){return"cancelAndHold"===e.type},b=function(e){return"cancelScheduledValues"===e.type},x=function(e){return w(e)||b(e)?e.cancelTime:d(e)||m(e)?e.endTime:e.startTime},C=function(e,t,n,s){var i=s.endTime,r=s.value;return n===r?r:0<n&&0<r||n<0&&r<0?n*Math.pow(r/n,(e-t)/(i-t)):0},T=function(e,t,n,s){return n+(e-t)/(s.endTime-t)*(s.value-n)},A=function(e,t){var n=Math.floor(t),s=Math.ceil(t);return n===s?e[n]:(1-(t-n))*e[n]+(1-(s-t))*e[s]},S=function(e,t){var n=t.duration,s=t.startTime,i=t.values,r=(e-s)/n*(i.length-1);return A(i,r)},E=function(e){return"setTarget"===e.type},O=function(e){function t(e){o.default(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}return a.default(t,[{key:e,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(e){var t=x(e);if(w(e)||b(e)){var n=this._automationEvents.findIndex((function(n){return b(e)&&_(n)?n.startTime+n.duration>=t:x(n)>=t})),s=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),w(e)){var i=this._automationEvents[this._automationEvents.length-1];if(void 0!==s&&f(s)){if(E(i))throw new Error("The internal list is malformed.");var r=_(i)?i.startTime+i.duration:x(i),o=_(i)?i.values[i.values.length-1]:i.value,a=d(s)?C(t,r,o,s):T(t,r,o,s),p=d(s)?c(a,t,this._currenTime):l(a,t,this._currenTime);this._automationEvents.push(p)}void 0!==i&&E(i)&&this._automationEvents.push(u(this.getValue(t),t)),void 0!==i&&_(i)&&i.startTime+i.duration>t&&(this._automationEvents[this._automationEvents.length-1]=h(new Float32Array([6,7]),i.startTime,t-i.startTime))}}else{var g=this._automationEvents.findIndex((function(e){return x(e)>t})),v=-1===g?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[g-1];if(void 0!==v&&_(v)&&x(v)+v.duration>t)return!1;var y=d(e)?c(e.value,e.endTime,this._currenTime):m(e)?l(e.value,t,this._currenTime):e;if(-1===g)this._automationEvents.push(y);else{if(_(e)&&t+e.duration>x(this._automationEvents[g]))return!1;this._automationEvents.splice(g,0,y)}}return!0}},{key:"flush",value:function(e){var t=this._automationEvents.findIndex((function(t){return x(t)>e}));if(t>1){var n=this._automationEvents.slice(t-1),s=n[0];E(s)&&n.unshift(u(v(this._automationEvents,t-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(e){if(0===this._automationEvents.length)return this._defaultValue;var t=this._automationEvents.findIndex((function(t){return x(t)>e})),n=this._automationEvents[t],s=(-1===t?this._automationEvents.length:t)-1,i=this._automationEvents[s];if(void 0!==i&&E(i)&&(void 0===n||!f(n)||n.insertTime>e))return p(e,v(this._automationEvents,s-1,i.startTime,this._defaultValue),i);if(void 0!==i&&g(i)&&(void 0===n||!f(n)))return i.value;if(void 0!==i&&_(i)&&(void 0===n||!f(n)||i.startTime+i.duration>e))return e<i.startTime+i.duration?S(e,i):i.values[i.values.length-1];if(void 0!==i&&f(i)&&(void 0===n||!f(n)))return i.value;if(void 0!==n&&d(n)){var o=y(this._automationEvents,s,i,n,this._defaultValue),a=r.default(o,2),c=a[0],l=a[1];return C(e,c,l,n)}if(void 0!==n&&m(n)){var u=y(this._automationEvents,s,i,n,this._defaultValue),h=r.default(u,2),w=h[0],b=h[1];return T(e,w,b,n)}return this._defaultValue}}]),t}(Symbol.iterator),k=function(e){return{cancelTime:e,type:"cancelAndHold"}},P=function(e){return{cancelTime:e,type:"cancelScheduledValues"}},$=function(e,t){return{endTime:t,type:"exponentialRampToValue",value:e}},M=function(e,t){return{endTime:t,type:"linearRampToValue",value:e}},R=function(e,t,n){return{startTime:t,target:e,timeConstant:n,type:"setTarget"}};e.AutomationEventList=O,e.createCancelAndHoldAutomationEvent=k,e.createCancelScheduledValuesAutomationEvent=P,e.createExponentialRampToValueAutomationEvent=$,e.createLinearRampToValueAutomationEvent=M,e.createSetTargetAutomationEvent=R,e.createSetValueAutomationEvent=u,e.createSetValueCurveAutomationEvent=h,Object.defineProperty(e,"__esModule",{value:!0})}(it.exports,rt.exports,ht.exports,pt.exports);const dt=new WeakSet,mt=new WeakMap,ft=new WeakMap,gt=new WeakMap,_t=new WeakMap,vt=new WeakMap,yt=new WeakMap,wt=new WeakMap,bt=new WeakMap,xt=new WeakMap,Ct={construct:()=>Ct},Tt=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,At=(e,t)=>{const n=[];let s=e.replace(/^[\s]+/,""),i=s.match(Tt);for(;null!==i;){const e=i[1].slice(1,-1),r=i[0].replace(/([\s]+)?;?$/,"").replace(e,new URL(e,t).toString());n.push(r),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(Tt)}return[n.join(";"),s]},St=e=>{if(void 0!==e&&!Array.isArray(e))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Et=e=>{if(!(e=>{try{new new Proxy(e,Ct)}catch{return!1}return!0})(e))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===e.prototype||"object"!=typeof e.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},Ot=(e,t)=>{const n=e.get(t);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},kt=(e,t)=>{const n=Array.from(e).filter(t);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[s]=n;return e.delete(s),s},Pt=(e,t,n,s)=>{const i=Ot(e,t),r=kt(i,(e=>e[0]===n&&e[1]===s));return 0===i.size&&e.delete(t),r},$t=e=>Ot(yt,e),Mt=e=>{if(dt.has(e))throw new Error("The AudioNode is already stored.");dt.add(e),$t(e).forEach((e=>e(!0)))},Rt=e=>"port"in e,Nt=e=>{if(!dt.has(e))throw new Error("The AudioNode is not stored.");dt.delete(e),$t(e).forEach((e=>e(!1)))},It=(e,t)=>{!Rt(e)&&t.every((e=>0===e.size))&&Nt(e)},Lt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Dt=(e,t)=>e.context===t,Vt=e=>{try{e.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},jt=()=>new DOMException("","IndexSizeError"),Gt=e=>{var t;e.getChannelData=(t=e.getChannelData,n=>{try{return t.call(e,n)}catch(e){if(12===e.code)throw jt();throw e}})},Bt={numberOfChannels:1},Ft=-34028234663852886e22,qt=-Ft,Ut=e=>dt.has(e),Wt={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Ht=e=>Ot(mt,e),Yt=e=>Ot(gt,e),zt=(e,t)=>{const{activeInputs:n}=Ht(e);n.forEach((n=>n.forEach((([n])=>{t.includes(e)||zt(n,[...t,e])}))));const s=(e=>"playbackRate"in e)(e)?[e.playbackRate]:Rt(e)?Array.from(e.parameters.values()):(e=>"frequency"in e&&"gain"in e)(e)?[e.Q,e.detune,e.frequency,e.gain]:(e=>"offset"in e)(e)?[e.offset]:(e=>!("frequency"in e)&&"gain"in e)(e)?[e.gain]:(e=>"detune"in e&&"frequency"in e)(e)?[e.detune,e.frequency]:(e=>"pan"in e)(e)?[e.pan]:[];for(const e of s){const n=Yt(e);void 0!==n&&n.activeInputs.forEach((([e])=>zt(e,t)))}Ut(e)&&Nt(e)},Xt=e=>{zt(e.destination,[])},Zt=e=>"context"in e,Jt=e=>Zt(e[0]),Kt=(e,t,n,s)=>{for(const t of e)if(n(t)){if(s)return!1;throw Error("The set contains at least one similar element.")}return e.add(t),!0},Qt=(e,t,[n,s],i)=>{Kt(e,[t,n,s],(e=>e[0]===t&&e[1]===n),i)},en=(e,[t,n,s],i)=>{const r=e.get(t);void 0===r?e.set(t,new Set([[n,s]])):Kt(r,[n,s],(e=>e[0]===n),i)},tn=e=>"inputs"in e,nn=(e,t,n,s)=>{if(tn(t)){const i=t.inputs[s];return e.connect(i,n,0),[i,n,0]}return e.connect(t,n,s),[t,n,s]},sn=(e,t,n)=>{for(const s of e)if(s[0]===t&&s[1]===n)return e.delete(s),s;return null},rn=(e,t)=>{if(!$t(e).delete(t))throw new Error("Missing the expected event listener.")},on=(e,t,n)=>{const s=Ot(e,t),i=kt(s,(e=>e[0]===n));return 0===s.size&&e.delete(t),i},an=(e,t,n,s)=>{tn(t)?e.disconnect(t.inputs[s],n,0):e.disconnect(t,n,s)},cn=e=>Ot(ft,e),ln=e=>Ot(_t,e),un=e=>wt.has(e),hn=e=>!dt.has(e),pn=(e,t)=>new Promise((n=>{if(null!==t)n(!0);else{const t=e.createScriptProcessor(256,1,1),s=e.createGain(),i=e.createBuffer(1,2,44100),r=i.getChannelData(0);r[0]=1,r[1]=1;const o=e.createBufferSource();o.buffer=i,o.loop=!0,o.connect(t).connect(e.destination),o.connect(s),o.disconnect(s),t.onaudioprocess=s=>{const i=s.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(e=>1===e))?n(!0):n(!1),o.stop(),t.onaudioprocess=null,o.disconnect(t),t.disconnect(e.destination)},o.start()}})),dn=(e,t)=>{const n=new Map;for(const t of e)for(const e of t){const t=n.get(e);n.set(e,void 0===t?1:t+1)}n.forEach(((e,n)=>t(n,e)))},mn=e=>"context"in e,fn=(e,t,n,s)=>{const{activeInputs:i,passiveInputs:r}=Yt(t),{outputs:o}=Ht(e),a=$t(e),c=o=>{const a=cn(e),c=ln(t);if(o){const t=on(r,e,n);Qt(i,e,t,!1),s||un(e)||a.connect(c,n)}else{const t=((e,t,n)=>kt(e,(e=>e[0]===t&&e[1]===n)))(i,e,n);en(r,t,!1),s||un(e)||a.disconnect(c,n)}};return!!Kt(o,[t,n],(e=>e[0]===t&&e[1]===n),!0)&&(a.add(c),Ut(e)?Qt(i,e,[n,c],!0):en(r,[e,n,c],!0),!0)},gn=(e,t,n,s,i)=>{const[r,o]=((e,t,n,s)=>{const{activeInputs:i,passiveInputs:r}=Ht(t),o=sn(i[s],e,n);if(null===o)return[Pt(r,e,n,s)[2],!1];return[o[2],!0]})(e,n,s,i);if(null!==r&&(rn(e,r),!o||t||un(e)||an(cn(e),cn(n),s,i)),Ut(n)){const{activeInputs:e}=Ht(n);It(n,e)}},_n=(e,t,n,s)=>{const[i,r]=((e,t,n)=>{const{activeInputs:s,passiveInputs:i}=Yt(t),r=sn(s,e,n);if(null===r)return[on(i,e,n)[1],!1];return[r[2],!0]})(e,n,s);null!==i&&(rn(e,i),!r||t||un(e)||cn(e).disconnect(ln(n),s))};class vn{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach(((n,s)=>e.call(t,n,s,this)))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const yn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function wn(e,t,n,s,i){if("function"==typeof e.copyFromChannel)0===t[n].byteLength&&(t[n]=new Float32Array(128)),e.copyFromChannel(t[n],s,i);else{const r=e.getChannelData(s);if(0===t[n].byteLength)t[n]=r.slice(i,i+128);else{const e=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);t[n].set(e)}}}const bn=(e,t,n,s,i)=>{"function"==typeof e.copyToChannel?0!==t[n].byteLength&&e.copyToChannel(t[n],s,i):0!==t[n].byteLength&&e.getChannelData(s).set(t[n],i)},xn=(e,t)=>{const n=[];for(let s=0;s<e;s+=1){const e=[],i="number"==typeof t?t:t[s];for(let t=0;t<i;t+=1)e.push(new Float32Array(128));n.push(e)}return n},Cn=async(e,t,n,s,i,r,o)=>{const a=null===t?128*Math.ceil(e.context.length/128):t.length,c=s.channelCount*s.numberOfInputs,l=i.reduce(((e,t)=>e+t),0),u=0===l?null:n.createBuffer(l,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const h=Ht(e),p=await((e,t)=>{const n=Ot(xt,e),s=cn(t);return Ot(n,s)})(n,e),d=xn(s.numberOfInputs,s.channelCount),m=xn(s.numberOfOutputs,i),f=Array.from(e.parameters.keys()).reduce(((e,t)=>({...e,[t]:new Float32Array(128)})),{});for(let l=0;l<a;l+=128){if(s.numberOfInputs>0&&null!==t)for(let e=0;e<s.numberOfInputs;e+=1)for(let n=0;n<s.channelCount;n+=1)wn(t,d[e],n,n,l);void 0!==r.parameterDescriptors&&null!==t&&r.parameterDescriptors.forEach((({name:e},n)=>{wn(t,f,e,c+n,l)}));for(let e=0;e<s.numberOfInputs;e+=1)for(let t=0;t<i[e];t+=1)0===m[e][t].byteLength&&(m[e][t]=new Float32Array(128));try{const e=d.map(((e,t)=>0===h.activeInputs[t].size?[]:e)),t=o(l/n.sampleRate,n.sampleRate,(()=>p.process(e,m,f)));if(null!==u)for(let e=0,t=0;e<s.numberOfOutputs;e+=1){for(let n=0;n<i[e];n+=1)bn(u,m[e],n,t+n,l);t+=i[e]}if(!t)break}catch(t){e.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}));break}}return u},Tn={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},An={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Sn={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},En={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},On={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},kn=e=>{const{port1:t,port2:n}=new MessageChannel;return new Promise((s=>{const i=()=>{n.onmessage=null,t.close(),n.close(),s()};n.onmessage=()=>i();try{t.postMessage(e,[e])}finally{i()}}))},Pn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},$n=(e,t,n)=>{const s=t[n];if(void 0===s)throw e();return s},Mn={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Rn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Nn=()=>new DOMException("","InvalidStateError"),In=()=>new DOMException("","InvalidAccessError"),Ln={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Dn=(e,t,n,s,i,r,o,a,c,l,u)=>{const h=l.length;let p=a;for(let a=0;a<h;a+=1){let h=n[0]*l[a];for(let t=1;t<i;t+=1){const s=p-t&c-1;h+=n[t]*r[s],h-=e[t]*o[s]}for(let e=i;e<s;e+=1)h+=n[e]*r[p-e&c-1];for(let n=i;n<t;n+=1)h-=e[n]*o[p-n&c-1];r[p]=l[a],o[p]=h,p=p+1&c-1,u[a]=h}return p},Vn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},jn=e=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=e.decodeAudioData(t.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch{}return!1},Gn=(e,t,n)=>{const s=t[n];void 0!==s&&s!==e[n]&&(e[n]=s)},Bn=(e,t)=>{Gn(e,t,"channelCount"),Gn(e,t,"channelCountMode"),Gn(e,t,"channelInterpretation")},Fn=e=>"function"==typeof e.getFloatTimeDomainData,qn=(e,t,n)=>{const s=t[n];void 0!==s&&s!==e[n].value&&(e[n].value=s)},Un=e=>{e.start=(t=>(n=0,s=0,i)=>{if("number"==typeof i&&i<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");t.call(e,n,s,i)})(e.start)},Wn=e=>{var t;e.stop=(t=e.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");t.call(e,n)})},Hn=(e,t)=>null===e?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(e*t))))),Yn=async(e,t)=>{const n=await(e=>new Promise(((t,n)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:e})=>{s.close(),i.close(),t(e)},s.onmessageerror=({data:e})=>{s.close(),i.close(),n(e)},i.postMessage(e)})))(t);return new e(n)},zn=(e,t)=>{const n=e.createBiquadFilter();return Bn(n,t),qn(n,t,"Q"),qn(n,t,"detune"),qn(n,t,"frequency"),qn(n,t,"gain"),Gn(n,t,"type"),n},Xn=(e,t)=>{const n=e.createChannelSplitter(t.numberOfOutputs);return Bn(n,t),(e=>{const t=e.numberOfOutputs;Object.defineProperty(e,"channelCount",{get:()=>t,set:e=>{if(e!==t)throw Nn()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:e=>{if("explicit"!==e)throw Nn()}}),Object.defineProperty(e,"channelInterpretation",{get:()=>"discrete",set:e=>{if("discrete"!==e)throw Nn()}})})(n),n},Zn=(e,t)=>(e.connect=t.connect.bind(t),e.disconnect=t.disconnect.bind(t),e),Jn=(e,t)=>{const n=e.createDelay(t.maxDelayTime);return Bn(n,t),qn(n,t,"delayTime"),n},Kn=(e,t)=>{const n=e.createGain();return Bn(n,t),qn(n,t,"gain"),n};function Qn(e,t){const n=t[0]*t[0]+t[1]*t[1];return[(e[0]*t[0]+e[1]*t[1])/n,(e[1]*t[0]-e[0]*t[1])/n]}function es(e,t){let n=[0,0];for(let r=e.length-1;r>=0;r-=1)i=t,n=[(s=n)[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]],n[0]+=e[r];var s,i;return n}const ts=(e,t,n,s)=>e.createScriptProcessor(t,n,s),ns=()=>new DOMException("","NotSupportedError"),ss={numberOfChannels:1},is={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},rs={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},os={disableNormalization:!1},as={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},cs={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},ls=(e,t,n)=>void 0===e.copyFromChannel?e.getChannelData(n)[0]:(e.copyFromChannel(t,n),t[0]),us=e=>{if(null===e)return!1;const t=e.length;return t%2!=0?0!==e[Math.floor(t/2)]:e[t/2-1]+e[t/2]!==0},hs=(e,t,n,s)=>{let i=e;for(;!i.hasOwnProperty(t);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,t);Object.defineProperty(e,t,{get:n(r),set:s(o)})},ps=(e,t,n)=>{try{e.setValueAtTime(t,n)}catch(s){if(9!==s.code)throw s;ps(e,t,n+1e-7)}},ds=e=>{const t=e.createOscillator();try{t.start(-1)}catch(e){return e instanceof RangeError}return!1},ms=e=>{const t=e.createBuffer(1,1,44100),n=e.createBufferSource();n.buffer=t,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},fs=e=>{const t=e.createOscillator();try{t.stop(-1)}catch(e){return e instanceof RangeError}return!1},gs=(e,t)=>{const n=t.createGain();e.connect(n);const s=(t=>()=>{t.call(e,n),e.removeEventListener("ended",s)})(e.disconnect);e.addEventListener("ended",s),Zn(e,n),e.stop=(t=>{let s=!1;return(i=0)=>{if(s)try{t.call(e,i)}catch{n.gain.setValueAtTime(0,i)}else t.call(e,i),s=!0}})(e.stop)},_s=(e,t)=>n=>{const s={value:e};return Object.defineProperties(n,{currentTarget:s,target:s}),"function"==typeof t?t.call(e,n):t.handleEvent.call(e,n)},vs=(e=>(t,n,[s,i,r],o)=>{e(t[i],[n,s,r],(e=>e[0]===n&&e[1]===s),o)})(Kt),ys=(e=>(t,n,[s,i,r],o)=>{const a=t.get(s);void 0===a?t.set(s,new Set([[i,n,r]])):e(a,[i,n,r],(e=>e[0]===i&&e[1]===n),o)})(Kt),ws=(e=>(t,n,s,i)=>e(t[i],(e=>e[0]===n&&e[1]===s)))(kt),bs=new WeakMap,xs=(e=>t=>{var n;return null!==(n=e.get(t))&&void 0!==n?n:0})(bs),Cs=(Ts=new Map,As=new WeakMap,(e,t)=>{const n=As.get(e);if(void 0!==n)return n;const s=Ts.get(e);if(void 0!==s)return s;try{const n=t();return n instanceof Promise?(Ts.set(e,n),n.catch((()=>!1)).then((t=>(Ts.delete(e),As.set(e,t),t)))):(As.set(e,n),n)}catch{return As.set(e,!1),!1}});var Ts,As;const Ss="undefined"==typeof window?null:window,Es=((e,t)=>(n,s)=>{const i=n.createAnalyser();if(Bn(i,s),!(s.maxDecibels>s.minDecibels))throw t();return Gn(i,s,"fftSize"),Gn(i,s,"maxDecibels"),Gn(i,s,"minDecibels"),Gn(i,s,"smoothingTimeConstant"),e(Fn,(()=>Fn(i)))||(e=>{e.getFloatTimeDomainData=t=>{const n=new Uint8Array(t.length);e.getByteTimeDomainData(n);const s=Math.max(n.length,e.fftSize);for(let e=0;e<s;e+=1)t[e]=.0078125*(n[e]-128);return t}})(i),i})(Cs,jt),Os=(e=>t=>{const n=e(t);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer})(Ht),ks=((e,t,n)=>async(s,i,r)=>{const o=e(s);await Promise.all(o.activeInputs.map(((e,o)=>Array.from(e).map((async([e,a])=>{const c=t(e),l=await c.render(e,i),u=s.context.destination;n(e)||s===u&&n(s)||l.connect(r,a,o)})))).reduce(((e,t)=>[...e,...t]),[]))})(Ht,Os,un),Ps=((e,t,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=t(i);if(!Dt(o,r)){const t={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,fftSize:o.fftSize,maxDecibels:o.maxDecibels,minDecibels:o.minDecibels,smoothingTimeConstant:o.smoothingTimeConstant};o=e(r,t)}return s.set(r,o),await n(i,r,o),o})(i,r)}}})(Es,cn,ks),$s=(Ms=vt,e=>{const t=Ms.get(e);if(void 0===t)throw Nn();return t});var Ms;const Rs=(e=>null===e?null:e.hasOwnProperty("OfflineAudioContext")?e.OfflineAudioContext:e.hasOwnProperty("webkitOfflineAudioContext")?e.webkitOfflineAudioContext:null)(Ss),Ns=(e=>t=>null!==e&&t instanceof e)(Rs),Is=new WeakMap,Ls=(e=>class{constructor(e){this._nativeEventTarget=e,this._listeners=new WeakMap}addEventListener(t,n,s){if(null!==n){let i=this._listeners.get(n);void 0===i&&(i=e(this,n),"function"==typeof n&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(t,i,s)}}dispatchEvent(e){return this._nativeEventTarget.dispatchEvent(e)}removeEventListener(e,t,n){const s=null===t?void 0:this._listeners.get(t);this._nativeEventTarget.removeEventListener(e,void 0===s?null:s,n)}})(_s),Ds=(e=>null===e?null:e.hasOwnProperty("AudioContext")?e.AudioContext:e.hasOwnProperty("webkitAudioContext")?e.webkitAudioContext:null)(Ss),Vs=(e=>t=>null!==e&&t instanceof e)(Ds),js=(e=>t=>null!==e&&"function"==typeof e.AudioNode&&t instanceof e.AudioNode)(Ss),Gs=(e=>t=>null!==e&&"function"==typeof e.AudioParam&&t instanceof e.AudioParam)(Ss),Bs=(e=>null===e?null:e.hasOwnProperty("AudioWorkletNode")?e.AudioWorkletNode:null)(Ss),Fs=((e,t,n,s,i,r,o,a,c,l,u,h,p,d,m,f)=>class extends l{constructor(t,s,i,r){super(i),this._context=t,this._nativeAudioNode=i;const o=u(t);h(o)&&!0!==n(pn,(()=>pn(o,f)))&&(e=>{const t=new Map;e.connect=(e=>(n,s=0,i=0)=>{const r=mn(n)?e(n,s,i):e(n,s),o=t.get(n);return void 0===o?t.set(n,[{input:i,output:s}]):o.every((e=>e.input!==i||e.output!==s))&&o.push({input:i,output:s}),r})(e.connect.bind(e)),e.disconnect=(n=>(s,i,r)=>{if(n.apply(e),void 0===s)t.clear();else if("number"==typeof s)for(const[e,n]of t){const i=n.filter((e=>e.output!==s));0===i.length?t.delete(e):t.set(e,i)}else if(t.has(s))if(void 0===i)t.delete(s);else{const e=t.get(s);if(void 0!==e){const n=e.filter((e=>e.output!==i&&(e.input!==r||void 0===r)));0===n.length?t.delete(s):t.set(s,n)}}for(const[n,s]of t)s.forEach((t=>{mn(n)?e.connect(n,t.output,t.input):e.connect(n,t.output)}))})(e.disconnect)})(i),ft.set(this,i),yt.set(this,new Set),"closed"!==t.state&&s&&Mt(this),e(this,r,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(e){this._nativeAudioNode.channelCount=e}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(e){this._nativeAudioNode.channelCountMode=e}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(e){this._nativeAudioNode.channelInterpretation=e}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(e,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const l=u(this._context),h=m(l);if(p(e)||d(e))throw r();if(Zt(e)){const i=cn(e);try{const t=nn(this._nativeAudioNode,i,n,a),s=hn(this);(h||s)&&this._nativeAudioNode.disconnect(...t),"closed"!==this.context.state&&!s&&hn(e)&&Mt(e)}catch(e){if(12===e.code)throw r();throw e}if(t(this,e,n,a,h)){const t=c([this],e);dn(t,s(h))}return e}const f=ln(e);if("playbackRate"===f.name&&1024===f.maxValue)throw o();try{this._nativeAudioNode.connect(f,n),(h||hn(this))&&this._nativeAudioNode.disconnect(f,n)}catch(e){if(12===e.code)throw r();throw e}if(fn(this,e,n,h)){const t=c([this],e);dn(t,s(h))}}disconnect(e,t,n){let s;const o=u(this._context),l=m(o);if(void 0===e)s=((e,t)=>{const n=Ht(e),s=[];for(const i of n.outputs)Jt(i)?gn(e,t,...i):_n(e,t,...i),s.push(i[0]);return n.outputs.clear(),s})(this,l);else if("number"==typeof e){if(e<0||e>=this.numberOfOutputs)throw i();s=((e,t,n)=>{const s=Ht(e),i=[];for(const r of s.outputs)r[1]===n&&(Jt(r)?gn(e,t,...r):_n(e,t,...r),i.push(r[0]),s.outputs.delete(r));return i})(this,l,e)}else{if(void 0!==t&&(t<0||t>=this.numberOfOutputs))throw i();if(Zt(e)&&void 0!==n&&(n<0||n>=e.numberOfInputs))throw i();if(s=((e,t,n,s,i)=>{const r=Ht(e);return Array.from(r.outputs).filter((e=>!(e[0]!==n||void 0!==s&&e[1]!==s||void 0!==i&&e[2]!==i))).map((n=>(Jt(n)?gn(e,t,...n):_n(e,t,...n),r.outputs.delete(n),n[0])))})(this,l,e,t,n),0===s.length)throw r()}for(const e of s){const t=c([this],e);dn(t,a)}}})((qs=mt,(e,t,n)=>{const s=[];for(let e=0;e<n.numberOfInputs;e+=1)s.push(new Set);qs.set(e,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:t})}),((e,t,n,s,i,r,o,a,c,l,u,h,p)=>{const d=new WeakMap;return(m,f,g,_,v)=>{const{activeInputs:y,passiveInputs:w}=r(f),{outputs:b}=r(m),x=a(m),C=r=>{const a=c(f),l=c(m);if(r){const t=Pt(w,m,g,_);e(y,m,t,!1),v||h(m)||n(l,a,g,_),p(f)&&Mt(f)}else{const e=s(y,m,g,_);t(w,_,e,!1),v||h(m)||i(l,a,g,_);const n=o(f);if(0===n)u(f)&&It(f,y);else{const e=d.get(f);void 0!==e&&clearTimeout(e),d.set(f,setTimeout((()=>{u(f)&&It(f,y)}),1e3*n))}}};return!!l(b,[f,g,_],(e=>e[0]===f&&e[1]===g&&e[2]===_),!0)&&(x.add(C),u(m)?e(y,m,[g,_,C],!0):t(w,_,[m,g,C],!0),!0)}})(vs,ys,nn,ws,an,Ht,xs,$t,cn,Kt,Ut,un,hn),Cs,((e,t,n,s,i,r)=>o=>(a,c)=>{const l=e.get(a);if(void 0===l){if(!o&&r(a)){const e=s(a),{outputs:r}=n(a);for(const n of r)if(Jt(n)){const i=s(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.disconnect(t,n[1])}}e.set(a,c)}else e.set(a,l+c)})(wt,an,Ht,cn,ln,Ut),jt,In,ns,((e,t,n,s,i,r,o,a)=>(c,l)=>{const u=t.get(c);if(void 0===u)throw new Error("Missing the expected cycle count.");const h=r(c.context),p=a(h);if(u===l){if(t.delete(c),!p&&o(c)){const t=s(c),{outputs:r}=n(c);for(const n of r)if(Jt(n)){const i=s(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.connect(e,n[1])}}}else t.set(c,u-l)})(nn,wt,Ht,cn,ln,$s,Ut,Ns),((e,t,n)=>function s(i,r){const o=Zt(r)?r:n(e,r);if((e=>"delayTime"in e)(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=t(o);return Array.from(a).map((e=>s([...i,o],e[0]))).reduce(((e,t)=>e.concat(t)),[])})(Is,Ht,Ot),Ls,$s,Vs,js,Gs,Ns,Bs);var qs;const Us=((e,t,n,s,i,r)=>class extends e{constructor(e,n){const o=i(e),a={...Lt,...n},c=s(o,a);super(e,!1,c,r(o)?t():null),this._nativeAnalyserNode=c}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(e){this._nativeAnalyserNode.fftSize=e}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(e){const t=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=e,!(e>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=t,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(e){const t=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=e,!(this._nativeAnalyserNode.maxDecibels>e))throw this._nativeAnalyserNode.minDecibels=t,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(e){this._nativeAnalyserNode.smoothingTimeConstant=e}getByteFrequencyData(e){this._nativeAnalyserNode.getByteFrequencyData(e)}getByteTimeDomainData(e){this._nativeAnalyserNode.getByteTimeDomainData(e)}getFloatFrequencyData(e){this._nativeAnalyserNode.getFloatFrequencyData(e)}getFloatTimeDomainData(e){this._nativeAnalyserNode.getFloatTimeDomainData(e)}})(Fs,Ps,jt,Es,$s,Ns),Ws=new WeakSet,Hs=(e=>null===e?null:e.hasOwnProperty("AudioBuffer")?e.AudioBuffer:null)(Ss),Ys=(zs=new Uint32Array(1),e=>(zs[0]=e,zs[0]));var zs;const Xs=((e,t)=>n=>{n.copyFromChannel=(s,i,r=0)=>{const o=e(r),a=e(i);if(a>=n.numberOfChannels)throw t();const c=n.length,l=n.getChannelData(a),u=s.length;for(let e=o<0?-o:0;e+o<c&&e<u;e+=1)s[e]=l[e+o]},n.copyToChannel=(s,i,r=0)=>{const o=e(r),a=e(i);if(a>=n.numberOfChannels)throw t();const c=n.length,l=n.getChannelData(a),u=s.length;for(let e=o<0?-o:0;e+o<c&&e<u;e+=1)l[e+o]=s[e]}})(Ys,jt),Zs=(e=>t=>{t.copyFromChannel=(n=>(s,i,r=0)=>{const o=e(r),a=e(i);if(o<t.length)return n.call(t,s,a,o)})(t.copyFromChannel),t.copyToChannel=(n=>(s,i,r=0)=>{const o=e(r),a=e(i);if(o<t.length)return n.call(t,s,a,o)})(t.copyToChannel)})(Ys),Js=((e,t,n,s,i,r,o,a)=>{let c=null;return class l{constructor(l){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:h,sampleRate:p}={...Bt,...l};null===c&&(c=new i(1,1,44100));const d=null!==s&&t(r,r)?new s({length:u,numberOfChannels:h,sampleRate:p}):c.createBuffer(h,u,p);if(0===d.numberOfChannels)throw n();return"function"!=typeof d.copyFromChannel?(o(d),Gt(d)):t(Vt,(()=>Vt(d)))||a(d),e.add(d),d}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===l.prototype||e.has(t)}}})(Ws,Cs,ns,Hs,Rs,(e=>()=>{if(null===e)return!1;try{new e({length:1,sampleRate:44100})}catch{return!1}return!0})(Hs),Xs,Zs),Ks=(e=>(t,n)=>{const s=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(s).connect(t.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(s),s.disconnect()};n.addEventListener("ended",i)})(Kn),Qs=((e,t,n)=>async(s,i,r)=>{const o=t(s);await Promise.all(Array.from(o.activeInputs).map((async([t,s])=>{const o=e(t),a=await o.render(t,i);n(t)||a.connect(r,s)})))})(Os,Yt,un),ei=(e=>(t,n,s)=>e(n,t,s))(Qs),ti=((e,t,n,s,i,r,o,a,c,l,u)=>(h,p)=>{const d=h.createBufferSource();return Bn(d,p),qn(d,p,"playbackRate"),Gn(d,p,"buffer"),Gn(d,p,"loop"),Gn(d,p,"loopEnd"),Gn(d,p,"loopStart"),t(n,(()=>n(h)))||(e=>{e.start=(t=>{let n=!1;return(s=0,i=0,r)=>{if(n)throw Nn();t.call(e,s,i,r),n=!0}})(e.start)})(d),t(s,(()=>s(h)))||c(d),t(i,(()=>i(h)))||l(d,h),t(r,(()=>r(h)))||Un(d),t(o,(()=>o(h)))||u(d,h),t(a,(()=>a(h)))||Wn(d),e(h,d),d})(Ks,Cs,(e=>{const t=e.createBufferSource();t.start();try{t.start()}catch{return!0}return!1}),(e=>{const t=e.createBufferSource(),n=e.createBuffer(1,1,44100);t.buffer=n;try{t.start(0,1)}catch{return!1}return!0}),(e=>{const t=e.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0}),ds,ms,fs,(e=>{e.start=(t=>(n=0,s=0,i)=>{const r=e.buffer,o=null===r?s:Math.min(r.duration,s);null!==r&&o>r.duration-.5/e.context.sampleRate?t.call(e,n,0,0):t.call(e,n,o,i)})(e.start)}),(e=>(t,n)=>{const s=n.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=s),e(t,"buffer",(e=>()=>{const n=e.call(t);return n===s?null:n}),(e=>n=>e.call(t,null===n?s:n)))})(hs),gs),ni=((e,t)=>(n,s,i)=>(e(s).replay(i),t(s,n,i)))((e=>t=>{const n=e(t);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(Yt),Qs),si=((e,t,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(e){o=e},set stop(e){a=e},render(c,l){const u=r.get(l);return void 0!==u?Promise.resolve(u):(async(c,l)=>{let u=n(c);const h=Dt(u,l);if(!h){const e={buffer:u.buffer,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,loop:u.loop,loopEnd:u.loopEnd,loopStart:u.loopStart,playbackRate:u.playbackRate.value};u=t(l,e),null!==o&&u.start(...o),null!==a&&u.stop(a)}return r.set(l,u),h?await e(l,c.playbackRate,u.playbackRate):await s(l,c.playbackRate,u.playbackRate),await i(c,l,u),u})(c,l)}}})(ei,ti,cn,ni,ks),ii=((e,t,n,s,i,r,o,a,c,l,u,h,p)=>(d,m,f,g=null,_=null)=>{const v=new it.exports.AutomationEventList(f.defaultValue),y=m?s(v):null,w={get defaultValue(){return f.defaultValue},get maxValue(){return null===g?f.maxValue:g},get minValue(){return null===_?f.minValue:_},get value(){return f.value},set value(e){f.value=e,w.setValueAtTime(e,d.context.currentTime)},cancelAndHoldAtTime(e){if("function"==typeof f.cancelAndHoldAtTime)null===y&&v.flush(d.context.currentTime),v.add(i(e)),f.cancelAndHoldAtTime(e);else{const t=Array.from(v).pop();null===y&&v.flush(d.context.currentTime),v.add(i(e));const n=Array.from(v).pop();f.cancelScheduledValues(e),t!==n&&void 0!==n&&("exponentialRampToValue"===n.type?f.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?f.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?f.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&f.setValueCurveAtTime(n.values,n.startTime,n.duration))}return w},cancelScheduledValues:e=>(null===y&&v.flush(d.context.currentTime),v.add(r(e)),f.cancelScheduledValues(e),w),exponentialRampToValueAtTime(e,t){if(0===e)throw new RangeError;if(!Number.isFinite(t)||t<0)throw new RangeError;return null===y&&v.flush(d.context.currentTime),v.add(o(e,t)),f.exponentialRampToValueAtTime(e,t),w},linearRampToValueAtTime:(e,t)=>(null===y&&v.flush(d.context.currentTime),v.add(a(e,t)),f.linearRampToValueAtTime(e,t),w),setTargetAtTime:(e,t,n)=>(null===y&&v.flush(d.context.currentTime),v.add(c(e,t,n)),f.setTargetAtTime(e,t,n),w),setValueAtTime:(e,t)=>(null===y&&v.flush(d.context.currentTime),v.add(l(e,t)),f.setValueAtTime(e,t),w),setValueCurveAtTime(e,t,n){const s=e instanceof Float32Array?e:new Float32Array(e);if(null!==h&&"webkitAudioContext"===h.name){const e=t+n,i=d.context.sampleRate,r=Math.ceil(t*i),o=Math.floor(e*i),a=o-r,c=new Float32Array(a);for(let e=0;e<a;e+=1){const o=(s.length-1)/n*((r+e)/i-t),a=Math.floor(o),l=Math.ceil(o);c[e]=a===l?s[a]:(1-(o-a))*s[a]+(1-(l-o))*s[l]}null===y&&v.flush(d.context.currentTime),v.add(u(c,t,n)),f.setValueCurveAtTime(c,t,n);const l=o/i;l<e&&p(w,c[c.length-1],l),p(w,s[s.length-1],e)}else null===y&&v.flush(d.context.currentTime),v.add(u(s,t,n)),f.setValueCurveAtTime(s,t,n);return w}};return n.set(w,f),t.set(w,d),e(w,y),w})((ri=gt,(e,t)=>{ri.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})}),Is,_t,(e=>({replay(t){for(const n of e)if("exponentialRampToValue"===n.type){const{endTime:e,value:s}=n;t.exponentialRampToValueAtTime(s,e)}else if("linearRampToValue"===n.type){const{endTime:e,value:s}=n;t.linearRampToValueAtTime(s,e)}else if("setTarget"===n.type){const{startTime:e,target:s,timeConstant:i}=n;t.setTargetAtTime(s,e,i)}else if("setValue"===n.type){const{startTime:e,value:s}=n;t.setValueAtTime(s,e)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:e,startTime:s,values:i}=n;t.setValueCurveAtTime(i,s,e)}}}})),it.exports.createCancelAndHoldAutomationEvent,it.exports.createCancelScheduledValuesAutomationEvent,it.exports.createExponentialRampToValueAutomationEvent,it.exports.createLinearRampToValueAutomationEvent,it.exports.createSetTargetAutomationEvent,it.exports.createSetValueAutomationEvent,it.exports.createSetValueCurveAutomationEvent,Ds,ps);var ri;const oi=((e,t,n,s,i,r,o,a)=>class extends e{constructor(e,s){const a=r(e),c={...Wt,...s},l=i(a,c),u=o(a),h=u?t():null;super(e,!1,l,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==c.buffer,this._nativeAudioBufferSourceNode=l,this._onended=null,this._playbackRate=n(this,u,l.playbackRate,qt,Ft)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(e){if(this._nativeAudioBufferSourceNode.buffer=e,null!==e){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(e){this._nativeAudioBufferSourceNode.loop=e}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(e){this._nativeAudioBufferSourceNode.loopEnd=e}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(e){this._nativeAudioBufferSourceNode.loopStart=e}get onended(){return this._onended}set onended(e){const t="function"==typeof e?a(this,e):null;this._nativeAudioBufferSourceNode.onended=t;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===t?e:n}get playbackRate(){return this._playbackRate}start(e=0,t=0,n){if(this._nativeAudioBufferSourceNode.start(e,t,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[e,t]:[e,t,n]),"closed"!==this.context.state){Mt(this);const e=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",e),Ut(this)&&Nt(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",e)}}stop(e=0){this._nativeAudioBufferSourceNode.stop(e),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=e)}})(Fs,si,ii,Nn,ti,$s,Ns,_s),ai=((e,t,n,s,i,r,o,a)=>class extends e{constructor(e,n){const s=r(e),c=o(s),l=i(s,n,c);super(e,!1,l,c?t(a):null),this._isNodeOfNativeOfflineAudioContext=c,this._nativeAudioDestinationNode=l}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(e){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(e>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=e}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(e){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=e}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Fs,(e=>{const t=new WeakMap;return{render(n,s){const i=t.get(s);return void 0!==i?Promise.resolve(i):(async(n,s)=>{const i=s.destination;return t.set(s,i),await e(n,s,i),i})(n,s)}}}),jt,Nn,((e,t)=>(n,s,i)=>{const r=n.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=e(n,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return t(o,"channelCount",(e=>()=>e.call(o)),(e=>t=>{e.call(o,t);try{r.channelCount=t}catch(e){if(t>r.maxChannelCount)throw e}})),t(o,"channelCountMode",(e=>()=>e.call(o)),(e=>t=>{e.call(o,t),r.channelCountMode=t})),t(o,"channelInterpretation",(e=>()=>e.call(o)),(e=>t=>{e.call(o,t),r.channelInterpretation=t})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(Kn,hs),$s,Ns,ks),ci=((e,t,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const l=Dt(c,a);if(!l){const e={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=t(a,e)}return r.set(a,c),l?(await e(a,o.Q,c.Q),await e(a,o.detune,c.detune),await e(a,o.frequency,c.frequency),await e(a,o.gain,c.gain)):(await s(a,o.Q,c.Q),await s(a,o.detune,c.detune),await s(a,o.frequency,c.frequency),await s(a,o.gain,c.gain)),await i(o,a,c),c})(o,a)}}})(ei,zn,cn,ni,ks),li=(e=>(t,n)=>e.set(t,n))(bs),ui=((e,t,n,s,i,r,o,a)=>class extends e{constructor(e,s){const c=r(e),l={...Tn,...s},u=i(c,l),h=o(c);super(e,!1,u,h?n():null),this._Q=t(this,h,u.Q,qt,Ft),this._detune=t(this,h,u.detune,1200*Math.log2(qt),-1200*Math.log2(qt)),this._frequency=t(this,h,u.frequency,e.sampleRate/2,0),this._gain=t(this,h,u.gain,40*Math.log10(qt),Ft),this._nativeBiquadFilterNode=u,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(e){this._nativeBiquadFilterNode.type=e}getFrequencyResponse(e,t,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(e,t,n)}catch(e){if(11===e.code)throw s();throw e}if(e.length!==t.length||t.length!==n.length)throw s()}})(Fs,ii,ci,In,zn,$s,Ns,li),hi=((e,t)=>(n,s,i)=>{const r=new Set;return n.connect=(i=>(o,a=0,c=0)=>{const l=0===r.size;if(t(o))return i.call(n,o,a,c),e(r,[o,a,c],(e=>e[0]===o&&e[1]===a&&e[2]===c),!0),l&&s(),o;i.call(n,o,a),e(r,[o,a],(e=>e[0]===o&&e[1]===a),!0),l&&s()})(n.connect),n.disconnect=(e=>(s,o,a)=>{const c=r.size>0;if(void 0===s)e.apply(n),r.clear();else if("number"==typeof s){e.call(n,s);for(const e of r)e[1]===s&&r.delete(e)}else{t(s)?e.call(n,s,o,a):e.call(n,s,o);for(const e of r)e[0]!==s||void 0!==o&&e[1]!==o||void 0!==a&&e[2]!==a||r.delete(e)}const l=0===r.size;c&&l&&i()})(n.disconnect),n})(Kt,js),pi=((e,t)=>(n,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw e()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw e()}});const i=n.createBufferSource();t(s,(()=>{const e=s.numberOfInputs;for(let t=0;t<e;t+=1)i.connect(s,0,t)}),(()=>i.disconnect(s)))})(Nn,hi),di=((e,t)=>(n,s)=>{const i=n.createChannelMerger(s.numberOfInputs);return null!==e&&"webkitAudioContext"===e.name&&t(n,i),Bn(i,s),i})(Ds,pi),mi=((e,t,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=t(i);if(!Dt(o,r)){const t={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs};o=e(r,t)}return s.set(r,o),await n(i,r,o),o})(i,r)}}})(di,cn,ks),fi=((e,t,n,s,i)=>class extends e{constructor(e,r){const o=s(e),a={...An,...r};super(e,!1,n(o,a),i(o)?t():null)}})(Fs,mi,di,$s,Ns),gi=((e,t,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=t(i);if(!Dt(o,r)){const t={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs};o=e(r,t)}return s.set(r,o),await n(i,r,o),o})(i,r)}}})(Xn,cn,ks),_i=((e,t,n,s,i,r)=>class extends e{constructor(e,o){const a=s(e),c=r({...Sn,...o});super(e,!1,n(a,c),i(a)?t():null)}})(Fs,gi,Xn,$s,Ns,(e=>({...e,channelCount:e.numberOfOutputs}))),vi=((e,t,n,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=t(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=n(i,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(e){l.channelCount=e},get channelCountMode(){return l.channelCountMode},set channelCountMode(e){l.channelCountMode=e},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(e){l.channelInterpretation=e},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(e){c.onended=e},addEventListener:(...e)=>c.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>c.dispatchEvent(e[0]),removeEventListener:(...e)=>c.removeEventListener(e[0],e[1],e[2]),start(e=0){c.start.call(c,e)},stop(e=0){c.stop.call(c,e)}};return e(i,c),s(Zn(h,l),(()=>c.connect(l)),(()=>c.disconnect(l)))})(Ks,ti,Kn,hi),yi=((e,t,n,s,i)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return Bn(a,o),qn(a,o,"offset"),t(s,(()=>s(r)))||Un(a),t(i,(()=>i(r)))||Wn(a),e(r,a),a})(Ks,Cs,vi,ds,fs),wi=((e,t,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(e){o=e},set stop(e){a=e},render(c,l){const u=r.get(l);return void 0!==u?Promise.resolve(u):(async(c,l)=>{let u=n(c);const h=Dt(u,l);if(!h){const e={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,offset:u.offset.value};u=t(l,e),null!==o&&u.start(o),null!==a&&u.stop(a)}return r.set(l,u),h?await e(l,c.offset,u.offset):await s(l,c.offset,u.offset),await i(c,l,u),u})(c,l)}}})(ei,yi,cn,ni,ks),bi=((e,t,n,s,i,r,o)=>class extends e{constructor(e,o){const a=i(e),c={...En,...o},l=s(a,c),u=r(a),h=u?n():null;super(e,!1,l,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=l,this._offset=t(this,u,l.offset,qt,Ft),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(e){const t="function"==typeof e?o(this,e):null;this._nativeConstantSourceNode.onended=t;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===t?e:n}start(e=0){if(this._nativeConstantSourceNode.start(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=e),"closed"!==this.context.state){Mt(this);const e=()=>{this._nativeConstantSourceNode.removeEventListener("ended",e),Ut(this)&&Nt(this)};this._nativeConstantSourceNode.addEventListener("ended",e)}}stop(e=0){this._nativeConstantSourceNode.stop(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=e)}})(Fs,ii,wi,yi,$s,Ns,_s),xi=((e,t)=>(n,s)=>{const i=n.createConvolver();if(Bn(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),Gn(i,s,"buffer"),s.channelCount>2)throw e();if(t(i,"channelCount",(e=>()=>e.call(i)),(t=>n=>{if(n>2)throw e();return t.call(i,n)})),"max"===s.channelCountMode)throw e();return t(i,"channelCountMode",(e=>()=>e.call(i)),(t=>n=>{if("max"===n)throw e();return t.call(i,n)})),i})(ns,hs),Ci=((e,t,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=t(i);if(!Dt(o,r)){const t={buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize};o=e(r,t)}return s.set(r,o),tn(o)?await n(i,r,o.inputs[0]):await n(i,r,o),o})(i,r)}}})(xi,cn,ks),Ti=((e,t,n,s,i,r)=>class extends e{constructor(e,o){const a=s(e),c={...On,...o},l=n(a,c);super(e,!1,l,i(a)?t():null),this._isBufferNullified=!1,this._nativeConvolverNode=l,null!==c.buffer&&r(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(e){if(this._nativeConvolverNode.buffer=e,null===e&&null!==this._nativeConvolverNode.buffer){const e=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=e.createBuffer(1,1,44100),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(e){this._nativeConvolverNode.normalize=e}})(Fs,Ci,xi,$s,Ns,li),Ai=((e,t,n,s,i)=>r=>{const o=new WeakMap;return{render(a,c){const l=o.get(c);return void 0!==l?Promise.resolve(l):(async(a,c)=>{let l=n(a);const u=Dt(l,c);if(!u){const e={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,delayTime:l.delayTime.value,maxDelayTime:r};l=t(c,e)}return o.set(c,l),u?await e(c,a.delayTime,l.delayTime):await s(c,a.delayTime,l.delayTime),await i(a,c,l),l})(a,c)}}})(ei,Jn,cn,ni,ks),Si=((e,t,n,s,i,r,o)=>class extends e{constructor(e,a){const c=i(e),l={...Pn,...a},u=s(c,l),h=r(c);super(e,!1,u,h?n(l.maxDelayTime):null),this._delayTime=t(this,h,u.delayTime),o(this,l.maxDelayTime)}get delayTime(){return this._delayTime}})(Fs,ii,Ai,Jn,$s,Ns,li),Ei=(e=>(t,n)=>{const s=t.createDynamicsCompressor();if(Bn(s,n),n.channelCount>2)throw e();if("max"===n.channelCountMode)throw e();return qn(s,n,"attack"),qn(s,n,"knee"),qn(s,n,"ratio"),qn(s,n,"release"),qn(s,n,"threshold"),s})(ns),Oi=((e,t,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const l=Dt(c,a);if(!l){const e={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=t(a,e)}return r.set(a,c),l?(await e(a,o.attack,c.attack),await e(a,o.knee,c.knee),await e(a,o.ratio,c.ratio),await e(a,o.release,c.release),await e(a,o.threshold,c.threshold)):(await s(a,o.attack,c.attack),await s(a,o.knee,c.knee),await s(a,o.ratio,c.ratio),await s(a,o.release,c.release),await s(a,o.threshold,c.threshold)),await i(o,a,c),c})(o,a)}}})(ei,Ei,cn,ni,ks),ki=((e,t,n,s,i,r,o,a)=>class extends e{constructor(e,i){const c=r(e),l={...Mn,...i},u=s(c,l),h=o(c);super(e,!1,u,h?n():null),this._attack=t(this,h,u.attack),this._knee=t(this,h,u.knee),this._nativeDynamicsCompressorNode=u,this._ratio=t(this,h,u.ratio),this._release=t(this,h,u.release),this._threshold=t(this,h,u.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(e){const t=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=e,e>2)throw this._nativeDynamicsCompressorNode.channelCount=t,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(e){const t=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=e,"max"===e)throw this._nativeDynamicsCompressorNode.channelCountMode=t,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Fs,ii,Oi,Ei,ns,$s,Ns,li),Pi=((e,t,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const l=Dt(c,a);if(!l){const e={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=t(a,e)}return r.set(a,c),l?await e(a,o.gain,c.gain):await s(a,o.gain,c.gain),await i(o,a,c),c})(o,a)}}})(ei,Kn,cn,ni,ks),$i=((e,t,n,s,i,r)=>class extends e{constructor(e,o){const a=i(e),c={...Rn,...o},l=s(a,c),u=r(a);super(e,!1,l,u?n():null),this._gain=t(this,u,l.gain,qt,Ft)}get gain(){return this._gain}})(Fs,ii,Pi,Kn,$s,Ns),Mi=((e,t,n,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=Hn(r,i.sampleRate),p=l instanceof Float64Array?l:new Float64Array(l),d=u instanceof Float64Array?u:new Float64Array(u),m=p.length,f=d.length,g=Math.min(m,f);if(0===m||m>20)throw s();if(0===p[0])throw t();if(0===f||f>20)throw s();if(0===d[0])throw t();if(1!==p[0]){for(let e=0;e<f;e+=1)d[e]/=p[0];for(let e=1;e<m;e+=1)p[e]/=p[0]}const _=n(i,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=c;const v=[],y=[],w=[];for(let e=0;e<o;e+=1){v.push(0);const e=new Float32Array(32),t=new Float32Array(32);e.fill(0),t.fill(0),y.push(e),w.push(t)}_.onaudioprocess=e=>{const t=e.inputBuffer,n=e.outputBuffer,s=t.numberOfChannels;for(let e=0;e<s;e+=1){const s=t.getChannelData(e),i=n.getChannelData(e);v[e]=Dn(p,m,d,f,g,y[e],w[e],v[e],32,s,i)}};const b=i.sampleRate/2,x={get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(e){_.channelCount=e},get channelCountMode(){return _.channelCountMode},set channelCountMode(e){_.channelCountMode=e},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(e){_.channelInterpretation=e},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...e)=>_.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>_.dispatchEvent(e[0]),getFrequencyResponse(t,n,s){if(t.length!==n.length||n.length!==s.length)throw e();const i=t.length;for(let e=0;e<i;e+=1){const i=-Math.PI*(t[e]/b),r=[Math.cos(i),Math.sin(i)],o=Qn(es(d,r),es(p,r));n[e]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),s[e]=Math.atan2(o[1],o[0])}},removeEventListener:(...e)=>_.removeEventListener(e[0],e[1],e[2])};return Zn(x,_)})(In,Nn,ts,ns),Ri=((e,t,n,s)=>i=>e(jn,(()=>jn(i)))?Promise.resolve(e(s,s)).then((e=>{if(!e){const e=n(i,512,0,1);i.oncomplete=()=>{e.onaudioprocess=null,e.disconnect()},e.onaudioprocess=()=>i.currentTime,e.connect(i.destination)}return i.startRendering()})):new Promise((e=>{const n=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=t=>{n.disconnect(),e(t.renderedBuffer)},n.connect(i.destination),i.startRendering()})))(Cs,Kn,ts,((e,t)=>()=>{if(null===t)return Promise.resolve(!1);const n=new t(1,1,44100),s=e(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((e=>{n.oncomplete=()=>{s.disconnect(),e(0!==n.currentTime)},n.startRendering()}))})(Kn,Rs)),Ni=((e,t,n,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;const l=async(l,u)=>{let h=null,p=t(l);const d=Dt(p,u);if(void 0===u.createIIRFilter?h=e(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):d||(p=u.createIIRFilter(o,r)),a.set(u,null===h?p:h),null!==h){if(null===c){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new n(l.context.destination.channelCount,l.context.length,u.sampleRate);c=(async()=>{await s(l,e,e.destination);return((e,t,n,s)=>{const i=n instanceof Float64Array?n:new Float64Array(n),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(1!==i[0]){for(let e=0;e<o;e+=1)r[e]/=i[0];for(let e=1;e<a;e+=1)i[e]/=i[0]}const l=new Float32Array(32),u=new Float32Array(32),h=t.createBuffer(e.numberOfChannels,e.length,e.sampleRate),p=e.numberOfChannels;for(let t=0;t<p;t+=1){const n=e.getChannelData(t),s=h.getChannelData(t);l.fill(0),u.fill(0),Dn(i,o,r,a,c,l,u,0,32,n,s)}return h})(await i(e),u,r,o)})()}const e=await c;return h.buffer=e,h.start(0),h}return await s(l,u,p),p};return{render(e,t){const n=a.get(t);return void 0!==n?Promise.resolve(n):l(e,t)}}})(ti,cn,Rs,ks,Ri),Ii=(e=>(t,n,s)=>{if(void 0===t.createIIRFilter)return e(t,n,s);const i=t.createIIRFilter(s.feedforward,s.feedback);return Bn(i,s),i})(Mi),Li=((e,t,n,s,i,r)=>class extends e{constructor(e,o){const a=s(e),c=i(a),l={...Ln,...o},u=t(a,c?null:e.baseLatency,l);super(e,!1,u,c?n(l.feedback,l.feedforward):null),(e=>{var t;e.getFrequencyResponse=(t=e.getFrequencyResponse,(n,s,i)=>{if(n.length!==s.length||s.length!==i.length)throw In();return t.call(e,n,s,i)})})(u),this._nativeIIRFilterNode=u,r(this,1)}getFrequencyResponse(e,t,n){return this._nativeIIRFilterNode.getFrequencyResponse(e,t,n)}})(Fs,Ii,Ni,$s,Ns,li),Di=((e,t,n,s,i,r,o,a)=>(c,l)=>{const u=l.listener,{forwardX:h,forwardY:p,forwardZ:d,positionX:m,positionY:f,positionZ:g,upX:_,upY:v,upZ:y}=void 0===u.forwardX?(()=>{const h=new Float32Array(1),p=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),d=o(l);let m=!1,f=[0,0,-1,0,1,0],g=[0,0,0];const _=()=>{if(m)return;m=!0;const e=s(l,256,9,0);e.onaudioprocess=({inputBuffer:e})=>{const t=[r(e,h,0),r(e,h,1),r(e,h,2),r(e,h,3),r(e,h,4),r(e,h,5)];t.some(((e,t)=>e!==f[t]))&&(u.setOrientation(...t),f=t);const n=[r(e,h,6),r(e,h,7),r(e,h,8)];n.some(((e,t)=>e!==g[t]))&&(u.setPosition(...n),g=n)},p.connect(e)},v=e=>t=>{t!==f[e]&&(f[e]=t,u.setOrientation(...f))},y=e=>t=>{t!==g[e]&&(g[e]=t,u.setPosition(...g))},w=(t,s,r)=>{const o=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:s});o.connect(p,0,t),o.start(),Object.defineProperty(o.offset,"defaultValue",{get:()=>s});const u=e({context:c},d,o.offset,qt,Ft);var h,m,f,g,v,y,w;return a(u,"value",(e=>()=>e.call(u)),(e=>t=>{try{e.call(u,t)}catch(e){if(9!==e.code)throw e}_(),d&&r(t)})),u.cancelAndHoldAtTime=(h=u.cancelAndHoldAtTime,d?()=>{throw i()}:(...e)=>{const t=h.apply(u,e);return _(),t}),u.cancelScheduledValues=(m=u.cancelScheduledValues,d?()=>{throw i()}:(...e)=>{const t=m.apply(u,e);return _(),t}),u.exponentialRampToValueAtTime=(f=u.exponentialRampToValueAtTime,d?()=>{throw i()}:(...e)=>{const t=f.apply(u,e);return _(),t}),u.linearRampToValueAtTime=(g=u.linearRampToValueAtTime,d?()=>{throw i()}:(...e)=>{const t=g.apply(u,e);return _(),t}),u.setTargetAtTime=(v=u.setTargetAtTime,d?()=>{throw i()}:(...e)=>{const t=v.apply(u,e);return _(),t}),u.setValueAtTime=(y=u.setValueAtTime,d?()=>{throw i()}:(...e)=>{const t=y.apply(u,e);return _(),t}),u.setValueCurveAtTime=(w=u.setValueCurveAtTime,d?()=>{throw i()}:(...e)=>{const t=w.apply(u,e);return _(),t}),u};return{forwardX:w(0,0,v(0)),forwardY:w(1,0,v(1)),forwardZ:w(2,-1,v(2)),positionX:w(6,0,y(0)),positionY:w(7,0,y(1)),positionZ:w(8,0,y(2)),upX:w(3,0,v(3)),upY:w(4,1,v(4)),upZ:w(5,0,v(5))}})():u;return{get forwardX(){return h},get forwardY(){return p},get forwardZ(){return d},get positionX(){return m},get positionY(){return f},get positionZ(){return g},get upX(){return _},get upY(){return v},get upZ(){return y}}})(ii,di,yi,ts,ns,ls,Ns,hs),Vi=new WeakMap,ji=((e,t,n,s,i,r)=>class extends n{constructor(n,r){super(n),this._nativeContext=n,vt.set(this,n),s(n)&&i.set(n,new Set),this._destination=new e(this,r),this._listener=t(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(e){const t="function"==typeof e?r(this,e):null;this._nativeContext.onstatechange=t;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===t?e:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(ai,Di,Ls,Ns,Vi,_s),Gi=((e,t,n,s,i,r)=>(o,a)=>{const c=o.createOscillator();return Bn(c,a),qn(c,a,"detune"),qn(c,a,"frequency"),void 0!==a.periodicWave?c.setPeriodicWave(a.periodicWave):Gn(c,a,"type"),t(n,(()=>n(o)))||Un(c),t(s,(()=>s(o)))||r(c,o),t(i,(()=>i(o)))||Wn(c),e(o,c),c})(Ks,Cs,ds,ms,fs,gs),Bi=((e,t,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;return{set periodicWave(e){o=e},set start(e){a=e},set stop(e){c=e},render(l,u){const h=r.get(u);return void 0!==h?Promise.resolve(h):(async(l,u)=>{let h=n(l);const p=Dt(h,u);if(!p){const e={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:null===o?void 0:o,type:h.type};h=t(u,e),null!==a&&h.start(a),null!==c&&h.stop(c)}return r.set(u,h),p?(await e(u,l.detune,h.detune),await e(u,l.frequency,h.frequency)):(await s(u,l.detune,h.detune),await s(u,l.frequency,h.frequency)),await i(l,u,h),h})(l,u)}}})(ei,Gi,cn,ni,ks),Fi=((e,t,n,s,i,r,o)=>class extends e{constructor(e,o){const a=i(e),c={...is,...o},l=n(a,c),u=r(a),h=u?s():null,p=e.sampleRate/2;super(e,!1,l,h),this._detune=t(this,u,l.detune,153600,-153600),this._frequency=t(this,u,l.frequency,p,-p),this._nativeOscillatorNode=l,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==c.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=c.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(e){const t="function"==typeof e?o(this,e):null;this._nativeOscillatorNode.onended=t;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===t?e:n}get type(){return this._nativeOscillatorNode.type}set type(e){this._nativeOscillatorNode.type=e,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(e){this._nativeOscillatorNode.setPeriodicWave(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=e)}start(e=0){if(this._nativeOscillatorNode.start(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=e),"closed"!==this.context.state){Mt(this);const e=()=>{this._nativeOscillatorNode.removeEventListener("ended",e),Ut(this)&&Nt(this)};this._nativeOscillatorNode.addEventListener("ended",e)}}stop(e=0){this._nativeOscillatorNode.stop(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=e)}})(Fs,ii,Gi,Bi,$s,Ns,_s),qi=(e=>(t,n)=>{const s=e(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=t.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(n),s.start(),()=>{s.stop(),s.disconnect(n)}})(ti),Ui=((e,t,n,s,i)=>(r,{curve:o,oversample:a,...c})=>{const l=r.createWaveShaper(),u=r.createWaveShaper();Bn(l,c),Bn(u,c);const h=n(r,{...c,gain:1}),p=n(r,{...c,gain:-1}),d=n(r,{...c,gain:1}),m=n(r,{...c,gain:-1});let f=null,g=!1,_=null;const v={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(e){h.channelCount=e,p.channelCount=e,l.channelCount=e,d.channelCount=e,u.channelCount=e,m.channelCount=e},get channelCountMode(){return l.channelCountMode},set channelCountMode(e){h.channelCountMode=e,p.channelCountMode=e,l.channelCountMode=e,d.channelCountMode=e,u.channelCountMode=e,m.channelCountMode=e},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(e){h.channelInterpretation=e,p.channelInterpretation=e,l.channelInterpretation=e,d.channelInterpretation=e,u.channelInterpretation=e,m.channelInterpretation=e},get context(){return l.context},get curve(){return _},set curve(n){if(null!==n&&n.length<2)throw t();if(null===n)l.curve=n,u.curve=n;else{const e=n.length,t=new Float32Array(e+2-e%2),s=new Float32Array(e+2-e%2);t[0]=n[0],s[0]=-n[e-1];const i=Math.ceil((e+1)/2),r=(e+1)/2-1;for(let o=1;o<i;o+=1){const a=o/i*r,c=Math.floor(a),l=Math.ceil(a);t[o]=c===l?n[c]:(1-(a-c))*n[c]+(1-(l-a))*n[l],s[o]=c===l?-n[e-1-c]:-(1-(a-c))*n[e-1-c]-(1-(l-a))*n[e-1-l]}t[i]=e%2==1?n[i-1]:(n[i-2]+n[i-1])/2,l.curve=t,u.curve=s}_=n,g&&(s(_)&&null===f?f=e(r,h):null!==f&&(f(),f=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(e){l.oversample=e,u.oversample=e},addEventListener:(...e)=>h.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>h.dispatchEvent(e[0]),removeEventListener:(...e)=>h.removeEventListener(e[0],e[1],e[2])};null!==o&&(v.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==v.oversample&&(v.oversample=a);return i(Zn(v,d),(()=>{h.connect(l).connect(d),h.connect(p).connect(u).connect(m).connect(d),g=!0,s(_)&&(f=e(r,h))}),(()=>{h.disconnect(l),l.disconnect(d),h.disconnect(p),p.disconnect(u),u.disconnect(m),m.disconnect(d),g=!1,null!==f&&(f(),f=null)}))})(qi,Nn,Kn,us,hi),Wi=((e,t,n,s,i,r,o)=>(a,c)=>{const l=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,c);Bn(l,c);const u=null===c.curve||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(null!==u&&u.length<2)throw t();Gn(l,{curve:u},"curve"),Gn(l,c,"oversample");let h=null,p=!1;o(l,"curve",(e=>()=>e.call(l)),(t=>n=>(t.call(l,n),p&&(s(n)&&null===h?h=e(a,l):s(n)||null===h||(h(),h=null)),n)));return i(l,(()=>{p=!0,s(l.curve)&&(h=e(a,l))}),(()=>{p=!1,null!==h&&(h(),h=null)}))})(qi,Nn,Ui,us,hi,Ds,hs),Hi=((e,t,n,s,i,r,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:p,coneOuterGain:d,distanceModel:m,maxDistance:f,orientationX:g,orientationY:_,orientationZ:v,panningModel:y,positionX:w,positionY:b,positionZ:x,refDistance:C,rolloffFactor:T,...A})=>{const S=u.createPanner();if(A.channelCount>2)throw o();if("max"===A.channelCountMode)throw o();Bn(S,A);const E={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},O=n(u,{...E,channelInterpretation:"speakers",numberOfInputs:6}),k=s(u,{...A,gain:1}),P=s(u,{...E,gain:1}),$=s(u,{...E,gain:0}),M=s(u,{...E,gain:0}),R=s(u,{...E,gain:0}),N=s(u,{...E,gain:0}),I=s(u,{...E,gain:0}),L=i(u,256,6,1),D=r(u,{...E,curve:new Float32Array([1,1]),oversample:"none"});let V=[g,_,v],j=[w,b,x];const G=new Float32Array(1);L.onaudioprocess=({inputBuffer:e})=>{const t=[c(e,G,0),c(e,G,1),c(e,G,2)];t.some(((e,t)=>e!==V[t]))&&(S.setOrientation(...t),V=t);const n=[c(e,G,3),c(e,G,4),c(e,G,5)];n.some(((e,t)=>e!==j[t]))&&(S.setPosition(...n),j=n)},Object.defineProperty($.gain,"defaultValue",{get:()=>0}),Object.defineProperty(M.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0});const B={get bufferSize(){},get channelCount(){return S.channelCount},set channelCount(e){if(e>2)throw o();k.channelCount=e,S.channelCount=e},get channelCountMode(){return S.channelCountMode},set channelCountMode(e){if("max"===e)throw o();k.channelCountMode=e,S.channelCountMode=e},get channelInterpretation(){return S.channelInterpretation},set channelInterpretation(e){k.channelInterpretation=e,S.channelInterpretation=e},get coneInnerAngle(){return S.coneInnerAngle},set coneInnerAngle(e){S.coneInnerAngle=e},get coneOuterAngle(){return S.coneOuterAngle},set coneOuterAngle(e){S.coneOuterAngle=e},get coneOuterGain(){return S.coneOuterGain},set coneOuterGain(e){if(e<0||e>1)throw t();S.coneOuterGain=e},get context(){return S.context},get distanceModel(){return S.distanceModel},set distanceModel(e){S.distanceModel=e},get inputs(){return[k]},get maxDistance(){return S.maxDistance},set maxDistance(e){if(e<0)throw new RangeError;S.maxDistance=e},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get orientationX(){return P.gain},get orientationY(){return $.gain},get orientationZ(){return M.gain},get panningModel(){return S.panningModel},set panningModel(e){S.panningModel=e},get positionX(){return R.gain},get positionY(){return N.gain},get positionZ(){return I.gain},get refDistance(){return S.refDistance},set refDistance(e){if(e<0)throw new RangeError;S.refDistance=e},get rolloffFactor(){return S.rolloffFactor},set rolloffFactor(e){if(e<0)throw new RangeError;S.rolloffFactor=e},addEventListener:(...e)=>k.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>k.dispatchEvent(e[0]),removeEventListener:(...e)=>k.removeEventListener(e[0],e[1],e[2])};h!==B.coneInnerAngle&&(B.coneInnerAngle=h),p!==B.coneOuterAngle&&(B.coneOuterAngle=p),d!==B.coneOuterGain&&(B.coneOuterGain=d),m!==B.distanceModel&&(B.distanceModel=m),f!==B.maxDistance&&(B.maxDistance=f),g!==B.orientationX.value&&(B.orientationX.value=g),_!==B.orientationY.value&&(B.orientationY.value=_),v!==B.orientationZ.value&&(B.orientationZ.value=v),y!==B.panningModel&&(B.panningModel=y),w!==B.positionX.value&&(B.positionX.value=w),b!==B.positionY.value&&(B.positionY.value=b),x!==B.positionZ.value&&(B.positionZ.value=x),C!==B.refDistance&&(B.refDistance=C),T!==B.rolloffFactor&&(B.rolloffFactor=T),1===V[0]&&0===V[1]&&0===V[2]||S.setOrientation(...V),0===j[0]&&0===j[1]&&0===j[2]||S.setPosition(...j);return l(Zn(B,S),(()=>{k.connect(S),e(k,D,0,0),D.connect(P).connect(O,0,0),D.connect($).connect(O,0,1),D.connect(M).connect(O,0,2),D.connect(R).connect(O,0,3),D.connect(N).connect(O,0,4),D.connect(I).connect(O,0,5),O.connect(L).connect(u.destination)}),(()=>{k.disconnect(S),a(k,D,0,0),D.disconnect(P),P.disconnect(O),D.disconnect($),$.disconnect(O),D.disconnect(M),M.disconnect(O),D.disconnect(R),R.disconnect(O),D.disconnect(N),N.disconnect(O),D.disconnect(I),I.disconnect(O),O.disconnect(L),L.disconnect(u.destination)}))})(nn,Nn,di,Kn,ts,Wi,ns,an,ls,hi),Yi=(e=>(t,n)=>{const s=t.createPanner();return void 0===s.orientationX?e(t,n):(Bn(s,n),qn(s,n,"orientationX"),qn(s,n,"orientationY"),qn(s,n,"orientationZ"),qn(s,n,"positionX"),qn(s,n,"positionY"),qn(s,n,"positionZ"),Gn(s,n,"coneInnerAngle"),Gn(s,n,"coneOuterAngle"),Gn(s,n,"coneOuterGain"),Gn(s,n,"distanceModel"),Gn(s,n,"maxDistance"),Gn(s,n,"panningModel"),Gn(s,n,"refDistance"),Gn(s,n,"rolloffFactor"),s)})(Hi),zi=((e,t,n,s,i,r,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;return{render(p,d){const m=u.get(d);return void 0!==m?Promise.resolve(m):(async(p,d)=>{let m=null,f=r(p);const g={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation},_={...g,coneInnerAngle:f.coneInnerAngle,coneOuterAngle:f.coneOuterAngle,coneOuterGain:f.coneOuterGain,distanceModel:f.distanceModel,maxDistance:f.maxDistance,panningModel:f.panningModel,refDistance:f.refDistance,rolloffFactor:f.rolloffFactor},v=Dt(f,d);if("bufferSize"in f)m=s(d,{...g,gain:1});else if(!v){const e={..._,orientationX:f.orientationX.value,orientationY:f.orientationY.value,orientationZ:f.orientationZ.value,positionX:f.positionX.value,positionY:f.positionY.value,positionZ:f.positionZ.value};f=i(d,e)}if(u.set(d,null===m?f:m),null!==m){if(null===h){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new o(6,p.context.length,d.sampleRate),s=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});s.connect(e.destination),h=(async()=>{const t=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map((async(t,s)=>{const i=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===s?1:0});return await a(e,t,i.offset),i})));for(let e=0;e<6;e+=1)t[e].connect(s,0,e),t[e].start(0);return l(e)})()}const e=await h,r=s(d,{...g,gain:1});await c(p,d,r);const u=[];for(let t=0;t<e.numberOfChannels;t+=1)u.push(e.getChannelData(t));let f=[u[0][0],u[1][0],u[2][0]],v=[u[3][0],u[4][0],u[5][0]],y=s(d,{...g,gain:1}),w=i(d,{..._,orientationX:f[0],orientationY:f[1],orientationZ:f[2],positionX:v[0],positionY:v[1],positionZ:v[2]});r.connect(y).connect(w.inputs[0]),w.connect(m);for(let t=128;t<e.length;t+=128){const e=[u[0][t],u[1][t],u[2][t]],n=[u[3][t],u[4][t],u[5][t]];if(e.some(((e,t)=>e!==f[t]))||n.some(((e,t)=>e!==v[t]))){f=e,v=n;const o=t/d.sampleRate;y.gain.setValueAtTime(0,o),y=s(d,{...g,gain:0}),w=i(d,{..._,orientationX:f[0],orientationY:f[1],orientationZ:f[2],positionX:v[0],positionY:v[1],positionZ:v[2]}),y.gain.setValueAtTime(1,o),r.connect(y).connect(w.inputs[0]),w.connect(m)}}return m}return v?(await e(d,p.orientationX,f.orientationX),await e(d,p.orientationY,f.orientationY),await e(d,p.orientationZ,f.orientationZ),await e(d,p.positionX,f.positionX),await e(d,p.positionY,f.positionY),await e(d,p.positionZ,f.positionZ)):(await a(d,p.orientationX,f.orientationX),await a(d,p.orientationY,f.orientationY),await a(d,p.orientationZ,f.orientationZ),await a(d,p.positionX,f.positionX),await a(d,p.positionY,f.positionY),await a(d,p.positionZ,f.positionZ)),tn(f)?await c(p,d,f.inputs[0]):await c(p,d,f),f})(p,d)}}})(ei,di,yi,Kn,Yi,cn,Rs,ni,ks,Ri),Xi=((e,t,n,s,i,r,o)=>class extends e{constructor(e,a){const c=i(e),l={...rs,...a},u=n(c,l),h=r(c);super(e,!1,u,h?s():null),this._nativePannerNode=u,this._orientationX=t(this,h,u.orientationX,qt,Ft),this._orientationY=t(this,h,u.orientationY,qt,Ft),this._orientationZ=t(this,h,u.orientationZ,qt,Ft),this._positionX=t(this,h,u.positionX,qt,Ft),this._positionY=t(this,h,u.positionY,qt,Ft),this._positionZ=t(this,h,u.positionZ,qt,Ft),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(e){this._nativePannerNode.coneInnerAngle=e}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(e){this._nativePannerNode.coneOuterAngle=e}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(e){this._nativePannerNode.coneOuterGain=e}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(e){this._nativePannerNode.distanceModel=e}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(e){this._nativePannerNode.maxDistance=e}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(e){this._nativePannerNode.panningModel=e}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(e){this._nativePannerNode.refDistance=e}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(e){this._nativePannerNode.rolloffFactor=e}})(Fs,ii,Yi,zi,$s,Ns,li),Zi=(e=>(t,{disableNormalization:n,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=t.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(s).length<2)throw e();return a})(jt),Ji=((e,t,n,s)=>class i{constructor(i,r){const o=t(i),a=s({...os,...r}),c=e(o,a);return n.add(c),c}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===i.prototype||n.has(e)}})(Zi,$s,new WeakSet,(e=>{const{imag:t,real:n}=e;return void 0===t?void 0===n?{...e,imag:[0,0],real:[0,0]}:{...e,imag:Array.from(n,(()=>0)),real:n}:void 0===n?{...e,imag:t,real:Array.from(t,(()=>0))}:{...e,imag:t,real:n}})),Ki=((e,t,n,s,i,r)=>{const o=16385,a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(e,r,h,p,d)=>{if(1===r)return((e,t,i,r)=>{const h=new Float32Array(o),p=new Float32Array(o);for(let e=0;e<o;e+=1){const t=e/16384*c;h[e]=Math.cos(t),p[e]=Math.sin(t)}const d=n(e,{...l,gain:0}),m=s(e,{...u,curve:h}),f=s(e,{...u,curve:a}),g=n(e,{...l,gain:0}),_=s(e,{...u,curve:p});return{connectGraph(){t.connect(d),t.connect(void 0===f.inputs?f:f.inputs[0]),t.connect(g),f.connect(i),i.connect(void 0===m.inputs?m:m.inputs[0]),i.connect(void 0===_.inputs?_:_.inputs[0]),m.connect(d.gain),_.connect(g.gain),d.connect(r,0,0),g.connect(r,0,1)},disconnectGraph(){t.disconnect(d),t.disconnect(void 0===f.inputs?f:f.inputs[0]),t.disconnect(g),f.disconnect(i),i.disconnect(void 0===m.inputs?m:m.inputs[0]),i.disconnect(void 0===_.inputs?_:_.inputs[0]),m.disconnect(d.gain),_.disconnect(g.gain),d.disconnect(r,0,0),g.disconnect(r,0,1)}}})(e,h,p,d);if(2===r)return((e,i,r,h)=>{const p=new Float32Array(o),d=new Float32Array(o),m=new Float32Array(o),f=new Float32Array(o),g=Math.floor(8192.5);for(let e=0;e<o;e+=1)if(e>g){const t=(e-g)/(16384-g)*c;p[e]=Math.cos(t),d[e]=Math.sin(t),m[e]=0,f[e]=1}else{const t=e/(16384-g)*c;p[e]=1,d[e]=0,m[e]=Math.cos(t),f[e]=Math.sin(t)}const _=t(e,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=n(e,{...l,gain:0}),y=s(e,{...u,curve:p}),w=n(e,{...l,gain:0}),b=s(e,{...u,curve:d}),x=s(e,{...u,curve:a}),C=n(e,{...l,gain:0}),T=s(e,{...u,curve:m}),A=n(e,{...l,gain:0}),S=s(e,{...u,curve:f});return{connectGraph(){i.connect(_),i.connect(void 0===x.inputs?x:x.inputs[0]),_.connect(v,0),_.connect(w,0),_.connect(C,1),_.connect(A,1),x.connect(r),r.connect(void 0===y.inputs?y:y.inputs[0]),r.connect(void 0===b.inputs?b:b.inputs[0]),r.connect(void 0===T.inputs?T:T.inputs[0]),r.connect(void 0===S.inputs?S:S.inputs[0]),y.connect(v.gain),b.connect(w.gain),T.connect(C.gain),S.connect(A.gain),v.connect(h,0,0),C.connect(h,0,0),w.connect(h,0,1),A.connect(h,0,1)},disconnectGraph(){i.disconnect(_),i.disconnect(void 0===x.inputs?x:x.inputs[0]),_.disconnect(v,0),_.disconnect(w,0),_.disconnect(C,1),_.disconnect(A,1),x.disconnect(r),r.disconnect(void 0===y.inputs?y:y.inputs[0]),r.disconnect(void 0===b.inputs?b:b.inputs[0]),r.disconnect(void 0===T.inputs?T:T.inputs[0]),r.disconnect(void 0===S.inputs?S:S.inputs[0]),y.disconnect(v.gain),b.disconnect(w.gain),T.disconnect(C.gain),S.disconnect(A.gain),v.disconnect(h,0,0),C.disconnect(h,0,0),w.disconnect(h,0,1),A.disconnect(h,0,1)}}})(e,h,p,d);throw i()};return(t,{channelCount:s,channelCountMode:o,pan:a,...c})=>{if("max"===o)throw i();const l=e(t,{...c,channelCount:1,channelCountMode:o,numberOfInputs:2}),u=n(t,{...c,channelCount:s,channelCountMode:o,gain:1}),p=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:d,disconnectGraph:m}=h(t,s,u,p,l);Object.defineProperty(p.gain,"defaultValue",{get:()=>0}),Object.defineProperty(p.gain,"maxValue",{get:()=>1}),Object.defineProperty(p.gain,"minValue",{get:()=>-1});const f={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(e){u.channelCount!==e&&(g&&m(),({connectGraph:d,disconnectGraph:m}=h(t,e,u,p,l)),g&&d()),u.channelCount=e},get channelCountMode(){return u.channelCountMode},set channelCountMode(e){if("clamped-max"===e||"max"===e)throw i();u.channelCountMode=e},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(e){u.channelInterpretation=e},get context(){return u.context},get inputs(){return[u]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get pan(){return p.gain},addEventListener:(...e)=>u.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>u.dispatchEvent(e[0]),removeEventListener:(...e)=>u.removeEventListener(e[0],e[1],e[2])};let g=!1;return r(Zn(f,l),(()=>{d(),g=!0}),(()=>{m(),g=!1}))}})(di,Xn,Kn,Wi,ns,hi),Qi=((e,t)=>(n,s)=>{const i=s.channelCountMode;if("clamped-max"===i)throw t();if(void 0===n.createStereoPanner)return e(n,s);const r=n.createStereoPanner();return Bn(r,s),qn(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:e=>{if(e!==i)throw t()}}),r})(Ki,ns),er=((e,t,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const l=Dt(c,a);if(!l){const e={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=t(a,e)}return r.set(a,c),l?await e(a,o.pan,c.pan):await s(a,o.pan,c.pan),tn(c)?await i(o,a,c.inputs[0]):await i(o,a,c),c})(o,a)}}})(ei,Qi,cn,ni,ks),tr=((e,t,n,s,i,r)=>class extends e{constructor(e,o){const a=i(e),c={...as,...o},l=n(a,c),u=r(a);super(e,!1,l,u?s():null),this._pan=t(this,u,l.pan)}get pan(){return this._pan}})(Fs,ii,Qi,er,$s,Ns),nr=((e,t,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=t(i);if(!Dt(o,r)){const t={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample};o=e(r,t)}return s.set(r,o),tn(o)?await n(i,r,o.inputs[0]):await n(i,r,o),o})(i,r)}}})(Wi,cn,ks),sr=((e,t,n,s,i,r,o)=>class extends e{constructor(e,t){const a=i(e),c={...cs,...t},l=n(a,c);super(e,!0,l,r(a)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=l,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(e){if(null===e)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(e.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=e}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(e){this._nativeWaveShaperNode.oversample=e}})(Fs,Nn,Wi,nr,$s,Ns,li),ir=(e=>null!==e&&e.isSecureContext)(Ss),rr=(e=>(t,n,s)=>{Object.defineProperties(e,{currentFrame:{configurable:!0,get:()=>Math.round(t*n)},currentTime:{configurable:!0,get:()=>t}});try{return s()}finally{null!==e&&(delete e.currentFrame,delete e.currentTime)}})(Ss),or=new WeakMap,ar=((e,t)=>n=>{let s=e.get(n);if(void 0!==s)return s;if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new t(1,1,44100),e.set(n,s),s})(or,Rs),cr=ir?((e,t,n,s,i,r,o,a,c,l,u,h,p)=>{let d=0;return(m,f,g={credentials:"omit"})=>{const _=u.get(m);if(void 0!==_&&_.has(f))return Promise.resolve();const v=l.get(m);if(void 0!==v){const e=v.get(f);if(void 0!==e)return e}const y=r(m),w=void 0===y.audioWorklet?i(f).then((([e,t])=>{const[s,i]=At(e,t);return n(`${s};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const e=p._AWGS.pop();if(void 0===e)throw new SyntaxError;s(y.currentTime,y.sampleRate,(()=>e(class{},void 0,((e,n)=>{if(""===e.trim())throw t();const s=bt.get(y);if(void 0!==s){if(s.has(e))throw t();Et(n),St(n.parameterDescriptors),s.set(e,n)}else Et(n),St(n.parameterDescriptors),bt.set(y,new Map([[e,n]]))}),y.sampleRate,void 0,void 0)))})):Promise.all([i(f),Promise.resolve(e(h,h))]).then((([[e,t],n])=>{const s=d+1;d=s;const[i,r]=At(e,t),l=new Blob([`${i};((AudioWorkletProcessor,registerProcessor)=>{${r}\n})(${n?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${s}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),u=URL.createObjectURL(l);return y.audioWorklet.addModule(u,g).then((()=>{if(a(y))return y;const e=o(y);return e.audioWorklet.addModule(u,g).then((()=>e))})).then((e=>{if(null===c)throw new SyntaxError;try{new c(e,`__sac${s}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(u)))}));return void 0===v?l.set(m,new Map([[f,w]])):v.set(f,w),w.then((()=>{const e=u.get(m);void 0===e?u.set(m,new Set([f])):e.add(f)})).finally((()=>{const e=l.get(m);void 0!==e&&e.delete(f)})),w}})(Cs,ns,(e=>t=>new Promise(((n,s)=>{if(null===e)return void s(new SyntaxError);const i=e.document.head;if(null===i)s(new SyntaxError);else{const r=e.document.createElement("script"),o=new Blob([t],{type:"application/javascript"}),a=URL.createObjectURL(o),c=e.onerror,l=()=>{e.onerror=c,URL.revokeObjectURL(a)};e.onerror=(t,n,i,r,o)=>n===a||n===e.location.href&&1===i&&1===r?(l(),s(o),!1):null!==c?c(t,n,i,r,o):void 0,r.onerror=()=>{l(),s(new SyntaxError)},r.onload=()=>{l(),n()},r.src=a,r.type="module",i.appendChild(r)}})))(Ss),rr,(e=>async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw e()})((()=>new DOMException("","AbortError"))),$s,ar,Ns,Bs,new WeakMap,new WeakMap,((e,t)=>async()=>{if(null===e)return!0;if(null===t)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new t(1,128,44100),i=URL.createObjectURL(n);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const t=new e(s,"a",{numberOfOutputs:0}),n=s.createOscillator();t.port.onmessage=()=>r=!0,t.onprocessorerror=()=>o=!0,n.connect(t),n.start(0),await s.startRendering()}catch{}finally{URL.revokeObjectURL(i)}return r&&!o})(Bs,Rs),Ss):void 0,lr=((e,t)=>n=>e(n)||t(n))(Vs,Ns),ur=((e,t,n,s,i,r,o,a,c,l,u)=>(h,p)=>{const d=o(h)?h:r(h);if(i.has(p)){const e=n();return Promise.reject(e)}try{i.add(p)}catch{}return t(c,(()=>c(d)))?d.decodeAudioData(p).then((n=>(kn(p).catch((()=>{})),t(a,(()=>a(n)))||u(n),e.add(n),n))):new Promise(((t,n)=>{const i=async()=>{try{await kn(p)}catch{}},r=e=>{n(e),i()};try{d.decodeAudioData(p,(n=>{"function"!=typeof n.copyFromChannel&&(l(n),Gt(n)),e.add(n),i().then((()=>t(n)))}),(e=>{r(null===e?s():e)}))}catch(e){r(e)}}))})(Ws,Cs,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,$s,lr,Vt,jn,Xs,Zs),hr=((e,t,n,s,i,r,o,a,c,l,u,h,p,d,m,f,g,_,v,y)=>class extends m{constructor(t,n){super(t,n),this._nativeContext=t,this._audioWorklet=void 0===e?void 0:{addModule:(t,n)=>e(this,t,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new i(this)}createBuffer(e,t,s){return new n({length:t,numberOfChannels:e,sampleRate:s})}createBufferSource(){return new s(this)}createChannelMerger(e=6){return new r(this,{numberOfInputs:e})}createChannelSplitter(e=6){return new o(this,{numberOfOutputs:e})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(e=1){return new u(this,{maxDelayTime:e})}createDynamicsCompressor(){return new h(this)}createGain(){return new p(this)}createIIRFilter(e,t){return new d(this,{feedback:t,feedforward:e})}createOscillator(){return new f(this)}createPanner(){return new g(this)}createPeriodicWave(e,t,n={disableNormalization:!1}){return new _(this,{...n,imag:t,real:e})}createStereoPanner(){return new v(this)}createWaveShaper(){return new y(this)}decodeAudioData(e,t,n){return l(this._nativeContext,e).then((e=>("function"==typeof t&&t(e),e)),(e=>{throw"function"==typeof n&&n(e),e}))}})(cr,Us,Js,oi,ui,fi,_i,bi,Ti,ur,Si,ki,$i,Li,ji,Fi,Xi,Ji,tr,sr),pr=((e,t,n,s)=>class extends e{constructor(e,i){const r=n(e),o=t(r,i);if(s(r))throw TypeError();super(e,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Fs,((e,t)=>e.createMediaElementSource(t.mediaElement)),$s,Ns),dr=((e,t,n,s)=>class extends e{constructor(e,i){const r=n(e);if(s(r))throw new TypeError;const o={...Vn,...i},a=t(r,o);super(e,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Fs,((e,t)=>{const n=e.createMediaStreamDestination();return Bn(n,t),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),$s,Ns),mr=((e,t,n,s)=>class extends e{constructor(e,i){const r=n(e),o=t(r,i);if(s(r))throw new TypeError;super(e,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Fs,((e,{mediaStream:t})=>{const n=t.getAudioTracks();n.sort(((e,t)=>e.id<t.id?-1:e.id>t.id?1:0));const s=n.slice(0,1),i=e.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:t}),i}),$s,Ns),fr=((e,t)=>(n,{mediaStreamTrack:s})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=n.createMediaStreamSource(i);if("audio"!==s.kind)throw e();if(t(n))throw new TypeError;return r})(Nn,Ns),gr=((e,t,n)=>class extends e{constructor(e,s){const i=n(e);super(e,!0,t(i,s),null)}})(Fs,fr,$s),_r=((e,t,n,s,i,r,o,a,c)=>class extends e{constructor(e={}){if(null===c)throw new Error("Missing the native AudioContext constructor.");let t;try{t=new c(e)}catch(e){if(12===e.code&&"sampleRate is not in range"===e.message)throw n();throw e}if(null===t)throw s();if(!(e=>void 0===e||"number"==typeof e||"string"==typeof e&&("balanced"===e||"interactive"===e||"playback"===e))(e.latencyHint))throw new TypeError(`The provided value '${e.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==e.sampleRate&&t.sampleRate!==e.sampleRate)throw n();super(t,2);const{latencyHint:i}=e,{sampleRate:r}=t;if(this._baseLatency="number"==typeof t.baseLatency?t.baseLatency:"balanced"===i?512/r:"interactive"===i||void 0===i?256/r:"playback"===i?1024/r:128*Math.max(2,Math.min(128,Math.round(i*r/128)))/r,this._nativeAudioContext=t,"webkitAudioContext"===c.name?(this._nativeGainNode=t.createGain(),this._nativeOscillatorNode=t.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(t.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===t.state){this._state="suspended";const e=()=>{"suspended"===this._state&&(this._state=null),t.removeEventListener("statechange",e)};t.addEventListener("statechange",e)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw t()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Xt(this)})))}createMediaElementSource(e){return new i(this,{mediaElement:e})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(e){return new o(this,{mediaStream:e})}createMediaStreamTrackSource(e){return new a(this,{mediaStreamTrack:e})}resume(){return"suspended"===this._state?new Promise(((e,t)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?e():this.resume().then(e,t)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((e=>{if(void 0===e||15===e.code)throw t();throw e}))}suspend(){return this._nativeAudioContext.suspend().catch((e=>{if(void 0===e)throw t();throw e}))}})(hr,Nn,ns,(()=>new DOMException("","UnknownError")),pr,dr,mr,gr,Ds),vr=(e=>t=>{const n=e.get(t);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n})(Vi),yr=(e=>(t,n)=>{e(t).add(n)})(vr),wr=(e=>(t,n,s=0,i=0)=>{const r=t[s];if(void 0===r)throw e();return mn(n)?r.connect(n,0,i):r.connect(n,0)})(jt),br=(e=>(t,n)=>{e(t).delete(n)})(vr),xr=(e=>(t,n,s,i=0)=>void 0===n?t.forEach((e=>e.disconnect())):"number"==typeof n?$n(e,t,n).disconnect():mn(n)?void 0===s?t.forEach((e=>e.disconnect(n))):void 0===i?$n(e,t,s).disconnect(n,0):$n(e,t,s).disconnect(n,0,i):void 0===s?t.forEach((e=>e.disconnect(n))):$n(e,t,s).disconnect(n,0))(jt),Cr=new WeakMap,Tr=((e,t)=>n=>t(e,n))(Cr,Ot),Ar=((e,t,n,s,i,r,o,a,c,l,u,h,p)=>(d,m,f,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw c();const _=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(_.some((e=>e<1)))throw c();if(_.length!==g.numberOfOutputs)throw t();if("explicit"!==g.channelCountMode)throw c();const v=g.channelCount*g.numberOfInputs,y=_.reduce(((e,t)=>e+t),0),w=void 0===f.parameterDescriptors?0:f.parameterDescriptors.length;if(v+w>6||y>6)throw c();const b=new MessageChannel,x=[],C=[];for(let e=0;e<g.numberOfInputs;e+=1)x.push(o(d,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),C.push(i(d,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const T=[];if(void 0!==f.parameterDescriptors)for(const{defaultValue:e,maxValue:t,minValue:n,name:s}of f.parameterDescriptors){const i=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[s]?g.parameterData[s]:void 0===e?0:e});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===e?0:e},maxValue:{get:()=>void 0===t?qt:t},minValue:{get:()=>void 0===n?Ft:n}}),T.push(i)}const A=s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,v+w)}),S=Hn(m,d.sampleRate),E=a(d,S,v+w,Math.max(1,y)),O=i(d,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),k=[];for(let e=0;e<g.numberOfOutputs;e+=1)k.push(s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[e]}));for(let e=0;e<g.numberOfInputs;e+=1){x[e].connect(C[e]);for(let t=0;t<g.channelCount;t+=1)C[e].connect(A,t,e*g.channelCount+t)}const P=new vn(void 0===f.parameterDescriptors?[]:f.parameterDescriptors.map((({name:e},t)=>{const n=T[t];return n.connect(A,0,v+t),n.start(0),[e,n.offset]})));A.connect(E);let $=g.channelInterpretation,M=null;const R=0===g.numberOfOutputs?[E]:k,N={get bufferSize(){return S},get channelCount(){return g.channelCount},set channelCount(e){throw n()},get channelCountMode(){return g.channelCountMode},set channelCountMode(e){throw n()},get channelInterpretation(){return $},set channelInterpretation(e){for(const t of x)t.channelInterpretation=e;$=e},get context(){return E.context},get inputs(){return x},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return M},set onprocessorerror(e){"function"==typeof M&&N.removeEventListener("processorerror",M),M="function"==typeof e?e:null,"function"==typeof M&&N.addEventListener("processorerror",M)},get parameters(){return P},get port(){return b.port2},addEventListener:(...e)=>E.addEventListener(e[0],e[1],e[2]),connect:e.bind(null,R),disconnect:l.bind(null,R),dispatchEvent:(...e)=>E.dispatchEvent(e[0]),removeEventListener:(...e)=>E.removeEventListener(e[0],e[1],e[2])},I=new Map;var L,D;b.port1.addEventListener=(L=b.port1.addEventListener,(...e)=>{if("message"===e[0]){const t="function"==typeof e[1]?e[1]:"object"==typeof e[1]&&null!==e[1]&&"function"==typeof e[1].handleEvent?e[1].handleEvent:null;if(null!==t){const n=I.get(e[1]);void 0!==n?e[1]=n:(e[1]=e=>{u(d.currentTime,d.sampleRate,(()=>t(e)))},I.set(t,e[1]))}}return L.call(b.port1,e[0],e[1],e[2])}),b.port1.removeEventListener=(D=b.port1.removeEventListener,(...e)=>{if("message"===e[0]){const t=I.get(e[1]);void 0!==t&&(I.delete(e[1]),e[1]=t)}return D.call(b.port1,e[0],e[1],e[2])});let V=null;Object.defineProperty(b.port1,"onmessage",{get:()=>V,set:e=>{"function"==typeof V&&b.port1.removeEventListener("message",V),V="function"==typeof e?e:null,"function"==typeof V&&(b.port1.addEventListener("message",V),b.port1.start())}}),f.prototype.port=b.port1;let j=null;const G=((e,t,n,s)=>{let i=xt.get(e);void 0===i&&(i=new WeakMap,xt.set(e,i));const r=Yn(n,s);return i.set(t,r),r})(d,N,f,g);G.then((e=>j=e));const B=xn(g.numberOfInputs,g.channelCount),F=xn(g.numberOfOutputs,_),q=void 0===f.parameterDescriptors?[]:f.parameterDescriptors.reduce(((e,{name:t})=>({...e,[t]:new Float32Array(128)})),{});let U=!0;const W=()=>{g.numberOfOutputs>0&&E.disconnect(O);for(let e=0,t=0;e<g.numberOfOutputs;e+=1){const n=k[e];for(let s=0;s<_[e];s+=1)O.disconnect(n,t+s,s);t+=_[e]}},H=new Map;E.onaudioprocess=({inputBuffer:e,outputBuffer:t})=>{if(null!==j){const n=h(N);for(let s=0;s<S;s+=128){for(let t=0;t<g.numberOfInputs;t+=1)for(let n=0;n<g.channelCount;n+=1)wn(e,B[t],n,n,s);void 0!==f.parameterDescriptors&&f.parameterDescriptors.forEach((({name:t},n)=>{wn(e,q,t,v+n,s)}));for(let e=0;e<g.numberOfInputs;e+=1)for(let t=0;t<_[e];t+=1)0===F[e][t].byteLength&&(F[e][t]=new Float32Array(128));try{const e=B.map(((e,t)=>{if(n[t].size>0)return H.set(t,S/128),e;const s=H.get(t);return void 0===s?[]:(e.every((e=>e.every((e=>0===e))))&&(1===s?H.delete(t):H.set(t,s-1)),e)})),i=u(d.currentTime+s/d.sampleRate,d.sampleRate,(()=>j.process(e,F,q)));U=i;for(let e=0,n=0;e<g.numberOfOutputs;e+=1){for(let i=0;i<_[e];i+=1)bn(t,F[e],i,n+i,s);n+=_[e]}}catch(e){U=!1,N.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}))}if(!U){for(let e=0;e<g.numberOfInputs;e+=1){x[e].disconnect(C[e]);for(let t=0;t<g.channelCount;t+=1)C[s].disconnect(A,t,e*g.channelCount+t)}if(void 0!==f.parameterDescriptors){const e=f.parameterDescriptors.length;for(let t=0;t<e;t+=1){const e=T[t];e.disconnect(A,0,v+t),e.stop()}}A.disconnect(E),E.onaudioprocess=null,Y?W():Z();break}}}};let Y=!1;const z=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),X=()=>E.connect(z).connect(d.destination),Z=()=>{E.disconnect(z),z.disconnect()};return X(),p(N,(()=>{if(U){Z(),g.numberOfOutputs>0&&E.connect(O);for(let e=0,t=0;e<g.numberOfOutputs;e+=1){const n=k[e];for(let s=0;s<_[e];s+=1)O.connect(n,t+s,s);t+=_[e]}}Y=!0}),(()=>{U&&(X(),W()),Y=!1}))})(wr,jt,Nn,di,Xn,yi,Kn,ts,ns,xr,rr,Tr,hi),Sr=((e,t,n,s,i)=>(r,o,a,c,l,u)=>{if(null!==a)try{const t=new a(r,c,u),s=new Map;let o=null;if(Object.defineProperties(t,{channelCount:{get:()=>u.channelCount,set:()=>{throw e()}},channelCountMode:{get:()=>"explicit",set:()=>{throw e()}},onprocessorerror:{get:()=>o,set:e=>{"function"==typeof o&&t.removeEventListener("processorerror",o),o="function"==typeof e?e:null,"function"==typeof o&&t.addEventListener("processorerror",o)}}}),t.addEventListener=(p=t.addEventListener,(...e)=>{if("processorerror"===e[0]){const t="function"==typeof e[1]?e[1]:"object"==typeof e[1]&&null!==e[1]&&"function"==typeof e[1].handleEvent?e[1].handleEvent:null;if(null!==t){const n=s.get(e[1]);void 0!==n?e[1]=n:(e[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),t(n)):t(new ErrorEvent(e[0],{...n}))},s.set(t,e[1]))}}return p.call(t,"error",e[1],e[2]),p.call(t,...e)}),t.removeEventListener=(h=t.removeEventListener,(...e)=>{if("processorerror"===e[0]){const t=s.get(e[1]);void 0!==t&&(s.delete(e[1]),e[1]=t)}return h.call(t,"error",e[1],e[2]),h.call(t,e[0],e[1],e[2])}),0!==u.numberOfOutputs){const e=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(e).connect(r.destination);return i(t,(()=>e.disconnect()),(()=>e.connect(r.destination)))}return t}catch(e){if(11===e.code)throw s();throw e}var h,p;if(void 0===l)throw s();return(e=>{const{port1:t}=new MessageChannel;try{t.postMessage(e)}finally{t.close()}})(u),t(r,o,l,u)})(Nn,Ar,Kn,ns,hi),Er=((e,t,n,s,i,r,o,a,c,l,u,h,p,d,m,f)=>(g,_,v)=>{const y=new WeakMap;let w=null;return{render(b,x){a(x,b);const C=y.get(x);return void 0!==C?Promise.resolve(C):(async(a,b)=>{let x=u(a),C=null;const T=Dt(x,b),A=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(null===h){const e=A.reduce(((e,t)=>e+t),0),n=i(b,{channelCount:Math.max(1,e),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,e)}),r=[];for(let e=0;e<a.numberOfOutputs;e+=1)r.push(s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:A[e]}));const l=o(b,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});l.connect=t.bind(null,r),l.disconnect=c.bind(null,r),C=[n,r,l]}else T||(x=new h(b,g));if(y.set(b,null===C?x:C[2]),null!==C){if(null===w){if(void 0===v)throw new Error("Missing the processor constructor.");if(null===p)throw new Error("Missing the native OfflineAudioContext constructor.");const e=a.channelCount*a.numberOfInputs,t=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length,n=e+t,c=async()=>{const c=new p(n,128*Math.ceil(a.context.length/128),b.sampleRate),l=[],u=[];for(let e=0;e<_.numberOfInputs;e+=1)l.push(o(c,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),u.push(i(c,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const h=await Promise.all(Array.from(a.parameters.values()).map((async e=>{const t=r(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:e.value});return await d(c,e,t.offset),t}))),g=s(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,e+t)});for(let e=0;e<_.numberOfInputs;e+=1){l[e].connect(u[e]);for(let t=0;t<_.channelCount;t+=1)u[e].connect(g,t,e*_.channelCount+t)}for(const[t,n]of h.entries())n.connect(g,0,e+t),n.start(0);return g.connect(c.destination),await Promise.all(l.map((e=>m(a,c,e)))),f(c)};w=Cn(a,0===n?null:await c(),b,_,A,v,l)}const e=await w,t=n(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[c,u,h]=C;null!==e&&(t.buffer=e,t.start(0)),t.connect(c);for(let e=0,t=0;e<a.numberOfOutputs;e+=1){const n=u[e];for(let s=0;s<A[e];s+=1)c.connect(n,t+s,s);t+=A[e]}return h}if(T)for(const[t,n]of a.parameters.entries())await e(b,n,x.parameters.get(t));else for(const[e,t]of a.parameters.entries())await d(b,t,x.parameters.get(e));return await m(a,b,x),x})(b,x)}}})(ei,wr,ti,di,Xn,yi,Kn,br,xr,rr,cn,Bs,Rs,ni,ks,Ri),Or=(e=>t=>e.get(t))(or),kr=(e=>(t,n)=>{e.set(t,n)})(Cr),Pr=ir?((e,t,n,s,i,r,o,a,c,l,u,h,p,d)=>class extends t{constructor(t,d,m){var f;const g=a(t),_=c(g),v=u({...yn,...m});p(v);const y=bt.get(g),w=null==y?void 0:y.get(d),b=_||"closed"!==g.state?g:null!==(f=o(g))&&void 0!==f?f:g,x=i(b,_?null:t.baseLatency,l,d,w,v);super(t,!0,x,_?s(d,v,w):null);const C=[];x.parameters.forEach(((e,t)=>{const s=n(this,_,e);C.push([t,s])})),this._nativeAudioWorkletNode=x,this._onprocessorerror=null,this._parameters=new vn(C),_&&e(g,this);const{activeInputs:T}=r(this);h(x,T)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(e){const t="function"==typeof e?d(this,e):null;this._nativeAudioWorkletNode.onprocessorerror=t;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===t?e:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(yr,Fs,ii,Er,Sr,Ht,Or,$s,Ns,Bs,(e=>({...e,outputChannelCount:void 0!==e.outputChannelCount?e.outputChannelCount:1===e.numberOfInputs&&1===e.numberOfOutputs?[e.channelCount]:Array.from({length:e.numberOfOutputs},(()=>1))})),kr,(e=>{const{port1:t,port2:n}=new MessageChannel;try{t.postMessage(e)}finally{t.close(),n.close()}}),_s):void 0,$r=((e,t)=>(n,s,i)=>{if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(n,s,i)}catch(t){if("SyntaxError"===t.name)throw e();throw t}})(ns,Rs),Mr=((e,t,n,s,i,r,o,a)=>(c,l)=>n(c).render(c,l).then((()=>Promise.all(Array.from(s(l)).map((e=>n(e).render(e,l)))))).then((()=>i(l))).then((n=>("function"!=typeof n.copyFromChannel?(o(n),Gt(n)):t(r,(()=>r(n)))||a(n),e.add(n),n))))(Ws,Cs,Os,vr,Ri,Vt,Xs,Zs),Rr=((e,t,n,s,i)=>class extends e{constructor(e,n,i){let r;if("number"==typeof e&&void 0!==n&&void 0!==i)r={length:n,numberOfChannels:e,sampleRate:i};else{if("object"!=typeof e)throw new Error("The given parameters are not valid.");r=e}const{length:o,numberOfChannels:a,sampleRate:c}={...ss,...r},l=s(a,o,c);t(jn,(()=>jn(l)))||l.addEventListener("statechange",(()=>{let e=0;const t=n=>{"running"===this._state&&(e>0?(l.removeEventListener("statechange",t),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):e+=1)};return t})()),super(l,a),this._length=o,this._nativeOfflineAudioContext=l,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,Xt(this)})))}_waitForThePromiseToSettle(e){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(e):setTimeout((()=>this._waitForThePromiseToSettle(e)))}})(hr,Cs,Nn,$r,Mr),Nr=((e,t)=>n=>{const s=e.get(n);return t(s)||t(n)})(vt,Vs),Ir=((e,t)=>n=>e.has(n)||t(n))(ft,js),Lr=((e,t)=>n=>e.has(n)||t(n))(_t,Gs),Dr=((e,t)=>n=>{const s=e.get(n);return t(s)||t(n)})(vt,Ns);function Vr(e,t){if(!e)throw new Error(t)}function jr(e,t,n=1/0){if(!(t<=e&&e<=n))throw new RangeError(`Value must be within [${t}, ${n}], got: ${e}`)}function Gr(e){e.isOffline||"running"===e.state||Fr('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Br=console;function Fr(...e){Br.warn(...e)}function qr(e){return void 0===e}function Ur(e){return!qr(e)}function Wr(e){return"number"==typeof e}function Hr(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object}function Yr(e){return Array.isArray(e)}function zr(e){return"string"==typeof e}function Xr(e){return zr(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)}const Zr="object"==typeof self?self:null,Jr=Zr&&(Zr.hasOwnProperty("AudioContext")||Zr.hasOwnProperty("webkitAudioContext"));
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function Kr(e,t,n,s){var i,r=arguments.length,o=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r<3?i(o):r>3?i(t,n,o):i(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o}function Qr(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))}class eo{constructor(e,t,n){this._callback=e,this._type=t,this._updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(e){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*e,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function to(e){return Lr(e)}function no(e){return Ir(e)}function so(e){return Dr(e)}function io(e){return Nr(e)}function ro(e){return e instanceof AudioBuffer}function oo(e,t){return"value"===e||to(t)||no(t)||ro(t)}function ao(e,...t){if(!t.length)return e;const n=t.shift();if(Hr(e)&&Hr(n))for(const t in n)oo(t,n[t])?e[t]=n[t]:Hr(n[t])?(e[t]||Object.assign(e,{[t]:{}}),ao(e[t],n[t])):Object.assign(e,{[t]:n[t]});return ao(e,...t)}function co(e,t,n=[],s){const i={},r=Array.from(t);if(Hr(r[0])&&s&&!Reflect.has(r[0],s)){Object.keys(r[0]).some((t=>Reflect.has(e,t)))||(ao(i,{[s]:r[0]}),n.splice(n.indexOf(s),1),r.shift())}if(1===r.length&&Hr(r[0]))ao(i,r[0]);else for(let e=0;e<n.length;e++)Ur(r[e])&&(i[n[e]]=r[e]);return ao(e,i)}function lo(e,t){return qr(e)?t:e}function uo(e,t){return t.forEach((t=>{Reflect.has(e,t)&&delete e[t]})),e}
/**
     * Tone.js
     * @author Yotam Mann
     * @license http://opensource.org/licenses/MIT MIT License
     * @copyright 2014-2019 Yotam Mann
     */class ho{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Zr&&this.toString()===Zr.TONE_DEBUG_CLASS)&&function(...e){Br.log(...e)}(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}ho.version=et;const po=1e-6;function mo(e,t){return e>t+po}function fo(e,t){return mo(e,t)||_o(e,t)}function go(e,t){return e+po<t}function _o(e,t){return Math.abs(e-t)<po}class vo extends ho{constructor(){super(),this.name="Timeline",this._timeline=[];const e=co(vo.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(Vr(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];Vr(fo(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(e){const t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(_o(this._timeline[t].time,e)){for(let n=t;n>=0&&_o(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&fo(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(0===this._timeline.length)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][t]<=e)return s-1;for(;n<i;){let s=Math.floor(n+(i-n)/2);const r=this._timeline[s],o=this._timeline[s+1];if(_o(r[t],e)){for(let n=s;n<this._timeline.length;n++){if(!_o(this._timeline[n][t],e))break;s=n}return s}if(go(r[t],e)&&mo(o[t],e))return s;mo(r[t],e)?i=s:n=s+1}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return-1!==n&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let s=this._search(e),i=this._search(t);return-1!==s&&-1!==i?(this._timeline[s].time!==e&&(s+=1),this._timeline[i].time===t&&(i-=1),this._iterate(n,s,i)):-1===s&&this._iterate(n,0,i),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(-1!==n&&_o(this._timeline[n].time,e)){let s=n;for(let t=n;t>=0&&_o(this._timeline[t].time,e);t--)s=t;this._iterate((e=>{t(e)}),s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const yo=[];function wo(e){yo.push(e)}const bo=[];function xo(e){bo.push(e)}class Co extends ho{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach((e=>{qr(this._events)&&(this._events={}),this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events[e].push(t)})),this}once(e,t){const n=(...s)=>{t(...s),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach((n=>{if(qr(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(qr(t))this._events[e]=[];else{const n=this._events[e];for(let e=n.length-1;e>=0;e--)n[e]===t&&n.splice(e,1)}})),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let e=0,s=n.length;e<s;e++)n[e].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach((t=>{const n=Object.getOwnPropertyDescriptor(Co.prototype,t);Object.defineProperty(e.prototype,t,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class To extends Co{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Ao extends To{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new vo,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=co(Ao.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=function(e){return new _r(e)}({latencyHint:e.latencyHint}),this._ticker=new eo(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var e;return this._initialized||(e=this,yo.forEach((t=>t(e))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){Vr(io(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(e)}createMediaElementSource(e){Vr(io(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(e)}createMediaStreamDestination(){Vr(io(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){Vr(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){Vr(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){Vr(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){Vr(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return function(e,t,n){return Vr(Ur(Pr),"This node only works in a secure context (https or localhost)"),new Pr(e,t,n)}(this.rawContext,e,t)}addAudioWorkletModule(e,t){return Qr(this,void 0,void 0,(function*(){Vr(Ur(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(t)}))}workletsAreReady(){return Qr(this,void 0,void 0,(function*(){const e=[];this._workletModules.forEach((t=>e.push(t))),yield Promise.all(e)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let t=0;if(this._latencyHint=e,zr(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25}this.lookAhead=t,this.updateInterval=t/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return io(this._context)?this._context.resume():Promise.resolve()}close(){return Qr(this,void 0,void 0,(function*(){var e;io(this._context)&&(yield this._context.close()),this._initialized&&(e=this,bo.forEach((t=>t(e))))}))}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let t=0;t<n.length;t++)n[t]=e;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=t,s.loop=!0,s.start(0),this._constants.set(e,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((e=>this._constants[e].disconnect())),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach((t=>{t.id===e&&this._timeouts.remove(t)})),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{e(),s()},id:n,time:i+t})};return s(),n}}function So(e,t){Yr(t)?t.forEach((t=>So(e,t))):Object.defineProperty(e,t,{enumerable:!0,writable:!1})}function Eo(e,t){Yr(t)?t.forEach((t=>Eo(e,t))):Object.defineProperty(e,t,{writable:!0})}const Oo=()=>{};class ko extends ho{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Oo;const e=co(ko.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&ro(e.url)||e.url instanceof ko?this.set(e.url):zr(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:Oo,onload:Oo,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Ro().sampleRate}set(e){return e instanceof ko?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Qr(this,void 0,void 0,(function*(){const t=ko.load(e).then((e=>{this.set(e),this.onload(this)}));ko.downloads.push(t);try{yield t}finally{const e=ko.downloads.indexOf(t);ko.downloads.splice(e,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Yr(e)&&e[0].length>0,n=t?e.length:1,s=t?e[0].length:e.length,i=Ro(),r=i.createBuffer(n,s,i.sampleRate),o=t||1!==n?e:[e];for(let e=0;e<n;e++)r.copyToChannel(o[e],e);return this._buffer=r,this}toMono(e){if(Wr(e))this.fromArray(this.toArray(e));else{let e=new Float32Array(this.length);const t=this.numberOfChannels;for(let n=0;n<t;n++){const t=this.toArray(n);for(let n=0;n<t.length;n++)e[n]+=t[n]}e=e.map((e=>e/t)),this.fromArray(e)}return this}toArray(e){if(Wr(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);{const e=[];for(let t=0;t<this.numberOfChannels;t++)e[t]=this.getChannelData(t);return e}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){const n=Math.floor(e*this.sampleRate),s=Math.floor(t*this.sampleRate);Vr(n<s,"The start time must be less than the end time");const i=s-n,r=Ro().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let e=0;e<this.numberOfChannels;e++)r.copyToChannel(this.getChannelData(e).subarray(n,s),e);return new ko(r)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return(new ko).fromArray(e)}static fromUrl(e){return Qr(this,void 0,void 0,(function*(){const t=new ko;return yield t.load(e)}))}static load(e){return Qr(this,void 0,void 0,(function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const n=t[1].split("|");let s=n[0];for(const e of n)if(ko.supportsType(e)){s=e;break}e=e.replace(t[0],s)}const n=""===ko.baseUrl||ko.baseUrl.endsWith("/")?ko.baseUrl:ko.baseUrl+"/",s=yield fetch(n+e);if(!s.ok)throw new Error(`could not load url: ${e}`);const i=yield s.arrayBuffer();return yield Ro().decodeAudioData(i)}))}static supportsType(e){const t=e.split("."),n=t[t.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return Qr(this,void 0,void 0,(function*(){for(yield Promise.resolve();ko.downloads.length;)yield ko.downloads[0]}))}}ko.baseUrl="",ko.downloads=[];class Po extends Ao{constructor(){var e,t,n;super({clockSource:"offline",context:so(arguments[0])?arguments[0]:(e=arguments[0],t=arguments[1]*arguments[2],n=arguments[2],new Rr(e,t,n)),lookAhead:0,updateInterval:so(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=so(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Qr(this,void 0,void 0,(function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n==0&&(yield new Promise((e=>setTimeout(e,1))))}}))}render(e=!0){return Qr(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new ko(t)}))}close(){return Promise.resolve()}}const $o=new class extends To{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e,t){return Qr(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}};let Mo=$o;function Ro(){var e;return Mo===$o&&Jr&&(e=new Ao,Mo=io(e)?new Ao(e):so(e)?new Po(e):e),Mo}if(Zr&&!Zr.TONE_SILENCE_LOGGING){const e=` * Tone.js ${"v"}14.7.77 * `;console.log(`%c${e}`,"background: #000; color: #fff")}function No(e){return Math.log(e)/Math.LN10*20}function Io(e){return Math.pow(2,e/12)}let Lo=440;function Do(e){return Math.round(Vo(e))}function Vo(e){return 69+12*Math.log2(e/Lo)}class jo extends ho{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),s="."===t?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(3*Math.floor(t)))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let s=0;return e&&"0"!==e&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(s+=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof jo&&this.fromType(this._val),qr(this._val))return this._noArg();if(zr(this._val)&&qr(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Hr(this._val)){let e=0;for(const t in this._val)if(Ur(this._val[t])){const n=this._val[t];e+=new this.constructor(this.context,t).valueOf()*n}return e}if(Ur(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}return zr(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Go extends jo{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new Go(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),s=this.valueOf();return s+(Math.round(s/n)*n-s)*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let e=1;e<9;e++){const n=Math.pow(2,e);t.push(n+"n."),t.push(n+"n"),t.push(n+"t")}t.push("0");let n=t[0],s=new Go(this.context,t[0]).toSeconds();return t.forEach((t=>{const i=new Go(this.context,t).toSeconds();Math.abs(i-e)<Math.abs(s-e)&&(n=t,s=i)})),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let s=t%1*4;t=Math.floor(t)%this._getTimeSignature();const i=s.toString();i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3)));return[n,t,s].join(":")}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Do(this.toFrequency())}_now(){return this.context.now()}}class Bo extends Go{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Lo}static set A4(e){!function(e){Lo=e}(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return"midi"===this.defaultUnits?e:Bo.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,t){const n=Fo[e.toLowerCase()]+12*(parseInt(t,10)+1);return"midi"===this.defaultUnits?n:Bo.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let s=1;return e&&"0"!==e&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(s*=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(e){return new Bo(this.context,this.valueOf()*Io(e))}harmonize(e){return e.map((e=>this.transpose(e)))}toMidi(){return Do(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Bo.A4);let n=Math.round(12*t)+57;const s=Math.floor(n/12);s<0&&(n+=-12*s);return qo[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(60*e/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return function(e){return Lo*Math.pow(2,(e-69)/12)}(e)}static ftom(e){return Do(e)}}const Fo={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},qo=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Uo extends Go{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Wo extends ho{constructor(){super();const e=co(Wo.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Ro()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new Go(this.context,e).toSeconds()}toFrequency(e){return new Bo(this.context,e).toFrequency()}toTicks(e){return new Uo(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach((n=>{qr(e[n])&&delete t[n]})),t}get(){const e=function(e){return e.constructor.getDefaults()}(this);return Object.keys(e).forEach((t=>{if(Reflect.has(this,t)){const n=this[t];Ur(n)&&Ur(n.value)&&Ur(n.setValueAtTime)?e[t]=n.value:n instanceof Wo?e[t]=n._getPartialProperties(e[t]):Yr(n)||Wr(n)||zr(n)||"boolean"==typeof n?e[t]=n:delete e[t]}})),e}set(e){return Object.keys(e).forEach((t=>{Reflect.has(this,t)&&Ur(this[t])&&(this[t]&&Ur(this[t].value)&&Ur(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof Wo?this[t].set(e[t]):this[t]=e[t])})),this}}class Ho extends vo{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return null!==t?t.state:this._initial}setStateAtTime(e,t,n){return jr(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){for(let n=this._search(t);n>=0;n--){const t=this._timeline[n];if(t.state===e)return t}}getNextState(e,t){const n=this._search(t);if(-1!==n)for(let t=n;t<this._timeline.length;t++){const n=this._timeline[t];if(n.state===e)return n}}}class Yo extends Wo{constructor(){super(co(Yo.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=co(Yo.getDefaults(),arguments,["param","units","convert"]);for(Vr(Ur(e.param)&&(to(e.param)||e.param instanceof Yo),"param must be an AudioParam");!to(e.param);)e.param=e.param._param;this._swappable=!!Ur(e.swappable)&&e.swappable,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new vo(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,Ur(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Wo.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return Ur(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Ur(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return Ur(this.maxValue)&&Ur(this.minValue)&&jr(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?(t=e,Math.pow(10,t/20)):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e;var t}_toType(e){return this.convert&&"decibels"===this.units?No(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),s=this._fromType(e);return Vr(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),s=this._events.get(t);let i=this._initialValue;if(null===s)i=this._initialValue;else if("setTargetAtTime"!==s.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=s.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let e=s.value;if("setTargetAtTime"===s.type){const t=this._events.getBefore(s.time);e=null===t?this._initialValue:t.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(s.time,e,n.time,n.value,t):this._exponentialInterpolate(s.time,e,n.time,n.value,t)}else i=s.value;else{const e=this._events.getBefore(s.time);let n;n=null===e?this._initialValue:e.value,"setTargetAtTime"===s.type&&(i=this._exponentialApproach(s.time,n,s.value,s.constant,t))}return this._toType(i)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===this._fromType(t)&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),s=this.toSeconds(t);return Vr(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=_o(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(t);return Vr(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,s),this.cancelAndHoldAtTime(t+.9*n),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const s=this._fromType(e);Vr(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(t);return this._assertRange(s),Vr(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",e,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(e,t,n,s=1){n=this.toSeconds(n),t=this.toSeconds(t);const i=this._fromType(e[0])*s;this.setValueAtTime(this._toType(i),t);const r=n/(e.length-1);for(let n=1;n<e.length;n++){const i=this._fromType(e[n])*s;this.linearRampToValueAtTime(this._toType(i),t+n*r)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return Vr(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));Vr(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const s=this._events.get(t),i=this._events.getAfter(t);return s&&_o(s.time,t)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),t):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&"setTargetAtTime"===n.type){const s=this._events.getAfter(n.time),i=s?s.time:t+2,r=(i-t)/10;for(let n=t;n<i;n+=r)e.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(t=>{"cancelScheduledValues"===t.type?e.cancelScheduledValues(t.time):"setTargetAtTime"===t.type?e.setTargetAtTime(t.value,t.time,t.constant):e[t.type](t.value,t.time)})),this}setParam(e){Vr(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,s,i){return n+(t-n)*Math.exp(-(i-e)/s)}_linearInterpolate(e,t,n,s,i){return t+(i-e)/(n-e)*(s-t)}_exponentialInterpolate(e,t,n,s,i){return t*Math.pow(s/t,(i-e)/(n-e))}}class zo extends Wo{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Ur(this.input)?to(this.input)||this.input instanceof Yo?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Ur(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return Ur(e)&&(e instanceof zo||no(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach((t=>{t.channelCount=e.channelCount,t.channelCountMode=e.channelCountMode,t.channelInterpretation=e.channelInterpretation}))}_getChannelProperties(){const e=this._getInternalNodes();Vr(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return Zo(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Fr("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return function(e,t,n=0,s=0){if(Ur(t))for(;t instanceof zo;)t=t.input;for(;!no(e);)Ur(e.output)&&(e=e.output);to(t)?e.disconnect(t,n):no(t)?e.disconnect(t,n,s):e.disconnect()}(this,e,t,n),this}chain(...e){return Xo(this,...e),this}fan(...e){return e.forEach((e=>this.connect(e))),this}dispose(){return super.dispose(),Ur(this.input)&&(this.input instanceof zo?this.input.dispose():no(this.input)&&this.input.disconnect()),Ur(this.output)&&(this.output instanceof zo?this.output.dispose():no(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Xo(...e){const t=e.shift();e.reduce(((e,t)=>(e instanceof zo?e.connect(t):no(e)&&Zo(e,t),t)),t)}function Zo(e,t,n=0,s=0){for(Vr(Ur(e),"Cannot connect from undefined node"),Vr(Ur(t),"Cannot connect to undefined node"),(t instanceof zo||no(t))&&Vr(t.numberOfInputs>0,"Cannot connect to node with no inputs"),Vr(e.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof zo||t instanceof Yo;)Ur(t.input)&&(t=t.input);for(;e instanceof zo;)Ur(e.output)&&(e=e.output);to(t)?e.connect(t,n):e.connect(t,n,s)}class Jo extends zo{constructor(){super(co(Jo.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=co(Jo.getDefaults(),arguments,["gain","units"]);this.gain=new Yo({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),So(this,"gain")}static getDefaults(){return Object.assign(zo.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Ko extends zo{constructor(e){super(e),this.onended=Oo,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Jo({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const t=this.toSeconds(e);return-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(zo.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Oo})}_startGain(e,t=1){Vr(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){Vr(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const e="exponential"===this._curve?2*t:0;this._stopSource(this.now()+e),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Oo&&(this.onended(this),this.onended=Oo,!this.context.isOffline)){const e=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Vr(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Qo extends Ko{constructor(){super(co(Qo.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=co(Qo.getDefaults(),arguments,["offset"]);Zo(this._source,this._gainNode),this.offset=new Yo({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Ko.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ea extends zo{constructor(){super(co(ea.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=co(ea.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Qo({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(zo.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return ta(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,s){return this._param.setValueCurveAtTime(e,t,n,s),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function ta(e,t,n,s){(t instanceof Yo||to(t)||t instanceof ea&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof ea&&(t.overridden=!0)),Zo(e,t,n,s)}class na extends Yo{constructor(){super(co(na.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new vo(1/0),this._multiplier=1;const e=co(na.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Yo.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const s=this._fromType(e),i=this._events.get(t),r=Math.round(Math.max(1/n,1));for(let e=0;e<=r;e++){const r=n*e+t,o=this._exponentialApproach(i.time,i.value,s,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),s=this._events.get(t),i=Math.round(Math.max(10*(t-s.time),1)),r=(t-s.time)/i;for(let e=0;e<=i;e++){const i=r*e+s.time,o=this._exponentialInterpolate(s.time,s.value,t,n,i);this.linearRampToValueAtTime(this._toType(o),i)}return this}_getTicksUntilEvent(e,t){if(null===e)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(qr(e.ticks)){const t=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(t,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let s=this._fromType(this.getValueAtTime(t));const i=this._events.get(t);return i&&i.time===t&&"setValueAtTime"===i.type&&(s=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+s)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(t);return this.getTimeOfTick(s+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&"linearRampToValueAtTime"===n.type&&t.value!==n.value){const s=this._fromType(this.getValueAtTime(t.time)),i=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-t.time),r=Math.sqrt(Math.pow(s,2)-2*i*(t.ticks-e)),o=(-s+r)/i,a=(-s-r)/i;return(o>0?o:a)+t.time}return t?0===t.value?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),s=this.toSeconds(e),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(e){return"bpm"===this.units&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return"bpm"===this.units&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class sa extends ea{constructor(){super(co(sa.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=co(sa.getDefaults(),arguments,["value"]);this.input=this._param=new na({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(ea.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class ia extends Wo{constructor(){super(co(ia.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new Ho,this._tickOffset=new vo;const e=co(ia.getDefaults(),arguments,["frequency"]);this.frequency=new sa({context:this.context,units:e.units,value:e.frequency}),So(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Wo.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),Ur(t)&&this.setTicksAtTime(t,n)),this}stop(e){const t=this.toSeconds(e);if("stopped"===this._state.getValueAtTime(t)){const e=this._state.get(t);e&&e.time>0&&(this._tickOffset.cancel(e.time),this._state.cancel(e.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&this._state.setStateAtTime("paused",t),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);let i=n,r=0;return this._state.forEachBetween(n.time,t+this.sampleTime,(e=>{let t=i.time;const n=this._tickOffset.get(e.time);n&&n.time>=i.time&&(r=n.ticks,t=n.time),"started"===i.state&&"started"!==e.state&&(r+=this.frequency.getTicksAtTime(e.time)-this.frequency.getTicksAtTime(t)),i=e})),this._state.remove(s),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let s=t,i=0;return this._state.forEachBetween(t.time,e+this.sampleTime,(e=>{let t=s.time;const n=this._tickOffset.get(e.time);n&&n.time>=s.time&&(i=n.seconds,t=n.time),"started"===s.state&&"started"!==e.state&&(i+=e.time-t),s=e})),this._state.remove(n),i}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),s=this._state.get(t),i=Math.max(n.time,s.time),r=this.frequency.getTicksAtTime(i)+e-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(e,t,n){let s=this._state.get(e);this._state.forEachBetween(e,t,(t=>{s&&"started"===s.state&&"started"!==t.state&&this.forEachTickBetween(Math.max(s.time,e),t.time-this.sampleTime,n),s=t}));let i=null;if(s&&"started"===s.state){const r=Math.max(s.time,e),o=this.frequency.getTicksAtTime(r),a=o-this.frequency.getTicksAtTime(s.time);let c=Math.ceil(a)-a;c=_o(c,1)?0:c;let l=this.frequency.getTimeOfTick(o+c);for(;l<t;){try{n(l,Math.round(this.getTicksAtTime(l)))}catch(e){i=e;break}l+=this.frequency.getDurationOfTicks(1,l)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class ra extends Wo{constructor(){super(co(ra.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Oo,this._lastUpdate=0,this._state=new Ho("stopped"),this._boundLoop=this._loop.bind(this);const e=co(ra.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new ia({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,So(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Wo.getDefaults(),{callback:Oo,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){Gr(this.context);const n=this.toSeconds(e);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,(e=>{switch(e.state){case"started":const t=this._tickSource.getTicksAtTime(e.time);this.emit("start",e.time,t);break;case"stopped":0!==e.time&&this.emit("stop",e.time);break;case"paused":this.emit("pause",e.time)}})),this._tickSource.forEachTickBetween(e,t,((e,t)=>{this.callback(e,t)})))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Co.mixin(ra);class oa extends ho{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=co(oa.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach((t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:Oo,onload:Oo,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return Vr(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,0===this._loadingCount&&e&&e()}get loaded(){return Array.from(this._buffers).every((([e,t])=>t.loaded))}add(e,t,n=Oo,s=Oo){return zr(t)?this._buffers.set(e.toString(),new ko(this.baseUrl+t,n,s)):this._buffers.set(e.toString(),new ko(t,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this}}class aa extends Uo{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class ca extends Wo{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new vo,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}wo((e=>{e.draw=new ca({context:e})})),xo((e=>{e.draw.dispose()}));class la extends ho{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){Vr(Ur(e.time),"Events must have a time property"),Vr(Ur(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new ua(e.time,e.time+e.duration,e);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(null!==this._root){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,(e=>this.remove(e))),this}_setRoot(e){this._root=e,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{let t,n=null;if(e.getBalance()>0)if(null===e.left.right)t=e.left,t.right=e.right,n=t;else{for(t=e.left.right;null!==t.right;)t=t.right;t.parent&&(t.parent.right=t.left,n=t.parent,t.left=e.left,t.right=e.right)}else if(null===e.right.left)t=e.right,t.left=e.left,n=t;else{for(t=e.right.left;null!==t.left;)t=t.left;t.parent&&(t.parent.left=t.right,n=t.parent,t.left=e.left,t.right=e.right)}null!==e.parent?e.isLeftChild()?e.parent.left=t:e.parent.right=t:this._setRoot(t),n&&this._rebalance(n)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),s=e.right;s&&(e.right=s.left,s.left=e),null!==t?n?t.left=s:t.right=s:this._setRoot(s)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),s=e.left;s&&(e.left=s.right,s.right=e),null!==t?n?t.left=s:t.right=s:this._setRoot(s)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(null!==this._root){const t=[];if(this._root.search(e,t),t.length>0){let e=t[0];for(let n=1;n<t.length;n++)t[n].low>e.low&&(e=t[n]);return e.event}}return null}forEach(e){if(null!==this._root){const t=[];this._root.traverse((e=>t.push(e))),t.forEach((t=>{t.event&&e(t.event)}))}return this}forEachAtTime(e,t){if(null!==this._root){const n=[];this._root.search(e,n),n.forEach((e=>{e.event&&t(e.event)}))}return this}forEachFrom(e,t){if(null!==this._root){const n=[];this._root.searchAfter(e,n),n.forEach((e=>{e.event&&t(e.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((e=>e.dispose())),this._root=null,this}}class ua{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),this.low>e||null!==this.right&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)}traverse(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class ha extends zo{constructor(){super(co(ha.getDefaults(),arguments,["volume"])),this.name="Volume";const e=co(ha.getDefaults(),arguments,["volume"]);this.input=this.output=new Jo({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,So(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(zo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class pa extends zo{constructor(){super(co(pa.getDefaults(),arguments)),this.name="Destination",this.input=new ha({context:this.context}),this.output=new Jo({context:this.context}),this.volume=this.input.volume;const e=co(pa.getDefaults(),arguments);Xo(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(zo.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),Xo(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}wo((e=>{e.destination=new pa({context:e})})),xo((e=>{e.destination.dispose()}));class da extends ho{constructor(e){super(),this.name="TimelineValue",this._timeline=new vo({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class ma{constructor(e,t){this.id=ma._eventId++;const n=Object.assign(ma.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:Oo,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}ma._eventId=0;class fa extends ma{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(fa.getDefaults(),t);this.duration=new aa(e.context,n.duration).valueOf(),this._interval=new aa(e.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},ma.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){const t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new aa(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new aa(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new aa(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class ga extends Wo{constructor(){super(co(ga.getDefaults(),arguments)),this.name="Transport",this._loop=new da(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new vo,this._repeatedEvents=new la,this._syncedSignals=[],this._swingAmount=0;const e=co(ga.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new ra({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),So(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Wo.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!=0&&t%(2*this._swingTicks)!=0){const n=t%(2*this._swingTicks)/(2*this._swingTicks),s=Math.sin(n*Math.PI)*this._swingAmount;e+=new aa(this.context,2*this._swingTicks/3).toSeconds()*s}this._timeline.forEachAtTime(t,(t=>t.invoke(e)))}schedule(e,t){const n=new ma(this,{callback:e,time:new Uo(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,s=1/0){const i=new fa(this,{callback:e,duration:new Go(this.context,s).toTicks(),interval:new Go(this.context,t).toTicks(),time:new Uo(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(e,t){const n=new ma(this,{callback:e,once:!0,time:new Uo(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,(e=>this.clear(e.id))),this._repeatedEvents.forEachFrom(t,(e=>this.clear(e.id))),this}_bindClockEvents(){this._clock.on("start",((e,t)=>{t=new aa(this.context,t).toSeconds(),this.emit("start",e,t)})),this._clock.on("stop",(e=>{this.emit("stop",e)})),this._clock.on("pause",(e=>{this.emit("pause",e)}))}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let n;return Ur(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),"started"!==this._clock.getStateAtTime(e)?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Yr(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Go(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Go(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new aa(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new aa(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(t),s=t+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t);this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),"started"!==this.state)return 0;{const t=this.now(),n=e-this.getTicksAtTime(t)%e;return this._clock.nextTickTime(n,t)}}syncSignal(e,t){if(!t){const n=this.now();if(0!==e.getValueAtTime(n)){const s=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);t=e.getValueAtTime(n)/s}else t=0}const n=new Jo(t);return this.bpm.connect(n),n.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:n,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Eo(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Co.mixin(ga),wo((e=>{e.transport=new ga({context:e})})),xo((e=>{e.transport.dispose()}));class _a extends zo{constructor(e){super(e),this.input=void 0,this._state=new Ho("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Oo,this._syncedStop=Oo,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new ha({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,So(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(zo.getDefaults(),{mute:!1,onstop:Oo,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let s=qr(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(s=this._clampToCurrentTime(s),this._synced||"started"!==this._state.getValueAtTime(s))if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const e=this._state.get(s);e&&(e.offset=this.toSeconds(lo(t,0)),e.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule((e=>{this._start(e,t,n)}),s);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else Gr(this.context),this._start(s,t,n);else Vr(mo(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,t,n);return this}stop(e){let t=qr(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),"started"===this._state.getValueAtTime(t)||Ur(this._state.getNextState("started",t))){if(this.log("stop",t),this._synced){const e=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(e)}else this._stop(t);this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),"started"===this._state.getValueAtTime(e)&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(t>0){const n=this._state.get(t);if(n&&"started"===n.state&&n.time!==t){const s=t-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(e,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));"started"===this._state.getValueAtTime(t)&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((e=>this.context.transport.clear(e))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Oo,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class va extends Ko{constructor(){super(co(va.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=co(va.getDefaults(),arguments,["url","onload"]);Zo(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Yo({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ko(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Ko.getDefaults(),{url:new ko,loop:!1,loopEnd:0,loopStart:0,onload:Oo,onerror:Oo,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,s=1){Vr(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(e);this._startGain(i,s),t=this.loop?lo(t,this.loopStart):lo(t,0);let r=Math.max(this.toSeconds(t),0);if(this.loop){const e=this.toSeconds(this.loopEnd)||this.buffer.duration,t=this.toSeconds(this.loopStart),n=e-t;fo(r,e)&&(r=(r-t)%n+t),_o(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,go(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,r)),Ur(n)){let e=this.toSeconds(n);e=Math.max(e,0),this.stop(i+e)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function ya(e,t){return Qr(this,void 0,void 0,(function*(){const n=t/e.context.sampleRate,s=new Po(1,n,e.context.sampleRate);new e.constructor(Object.assign(e.get(),{frequency:2/n,detune:0,context:s})).toDestination().start(0);return(yield s.render()).getChannelData(0)}))}class wa extends Ko{constructor(){super(co(wa.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=co(wa.getDefaults(),arguments,["frequency","type"]);Zo(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Yo({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Yo({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),So(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ko.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ba extends _a{constructor(){super(co(ba.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=co(ba.getDefaults(),arguments,["frequency","type"]);this.frequency=new ea({context:this.context,units:"frequency",value:e.frequency}),So(this,"frequency"),this.detune=new ea({context:this.context,units:"cents",value:e.detune}),So(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&"custom"!==e.type&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(_a.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new wa({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){const e=ba._periodicWaveCache.find((e=>{return e.phase===this._phase&&(t=e.partials,n=this._partials,t.length===n.length&&t.every(((e,t)=>n[t]===e)));var t,n}));return e}{const e=ba._periodicWaveCache.find((e=>e.type===this._type&&e.phase===this._phase));return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=-1!==["sine","square","sawtooth","triangle"].indexOf(e);if(0===this._phase&&t)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=e);else{const t=this._getCachedPeriodicWave();if(Ur(t)){const{partials:e,wave:n}=t;this._wave=n,this._partials=e,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[t,n]=this._getRealImaginary(e,this._phase),s=this.context.createPeriodicWave(t,n);this._wave=s,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),ba._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:t,type:this._type,wave:this._wave}),ba._periodicWaveCache.length>100&&ba._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&"custom"!==this._type&&"custom"!==e?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){jr(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),"custom"!==this._type)this.type=0===e?t:t+e.toString();else{const t=new Float32Array(e);this._partials.forEach(((e,n)=>t[n]=e)),this._partials=Array.from(t),this.type=this._type}}_getRealImaginary(e,t){let n=2048;const s=new Float32Array(n),i=new Float32Array(n);let r=1;if("custom"===e){if(r=this._partials.length+1,this._partialCount=this._partials.length,n=r,0===this._partials.length)return[s,i]}else{const t=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);t?(r=parseInt(t[2],10)+1,this._partialCount=parseInt(t[2],10),e=t[1],r=Math.max(r,2),n=r):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(e){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}0!==a?(s[o]=-a*Math.sin(t*o),i[o]=a*Math.cos(t*o)):(s[o]=0,i[o]=0)}return[s,i]}_inverseFFT(e,t,n){let s=0;const i=e.length;for(let r=0;r<i;r++)s+=e[r]*Math.cos(r*n)+t[r]*Math.sin(r*n);return s}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const s=2*Math.PI;for(let i=0;i<32;i++)n=Math.max(this._inverseFFT(e,t,i/32*s),n);return i=-this._inverseFFT(e,t,this._phase)/n,r=-1,o=1,Math.max(Math.min(i,o),r);var i,r,o}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return Qr(this,void 0,void 0,(function*(){return ya(this,e)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ba._periodicWaveCache=[];class xa extends zo{constructor(){super(Object.assign(co(xa.getDefaults(),arguments,["context"])))}connect(e,t=0,n=0){return ta(this,e,t,n),this}}class Ca extends xa{constructor(){super(Object.assign(co(Ca.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=co(Ca.getDefaults(),arguments,["mapping","length"]);Yr(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):"function"==typeof e.mapping&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(ea.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let s=0,i=t;s<i;s++){const t=s/(i-1)*2-1;n[s]=e(t,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){Vr(["none","2x","4x"].some((t=>t.includes(e))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Ta extends xa{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Ca({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Aa extends ea{constructor(){super(Object.assign(co(Aa.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=co(Aa.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Jo({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ea.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Sa extends _a{constructor(){super(co(Sa.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new Ta({context:this.context}),this._modulationNode=new Jo({context:this.context});const e=co(Sa.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ba({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ba({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Aa({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),So(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ba.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Qr(this,void 0,void 0,(function*(){return ya(this,e)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Ea extends _a{constructor(){super(co(Ea.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Jo({context:this.context,gain:0});const e=co(Ea.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ba({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new ea({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new ba({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Aa({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Aa({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),So(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ba.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Qr(this,void 0,void 0,(function*(){return ya(this,e)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Oa extends _a{constructor(){super(co(Oa.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Jo({context:this.context,gain:0}),this._thresh=new Ca({context:this.context,mapping:e=>e<=0?-1:1});const e=co(Oa.getDefaults(),arguments,["frequency","width"]);this.width=new ea({context:this.context,units:"audioRange",value:e.width}),this._triangle=new ba({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),So(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(_a.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return Qr(this,void 0,void 0,(function*(){return ya(this,e)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class ka extends _a{constructor(){super(co(ka.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=co(ka.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new ea({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ea({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,So(this,["frequency","detune"])}static getDefaults(){return Object.assign(ba.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach((t=>t.start(e)))}_stop(e){e=this.toSeconds(e),this._forEach((t=>t.stop(e)))}_restart(e){this._forEach((t=>t.restart(e)))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach((t=>t.type=e))}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach(((e,s)=>e.detune.value=t+n*s))}}get count(){return this._oscillators.length}set count(e){if(jr(e,1),this._oscillators.length!==e){this._forEach((e=>e.dispose())),this._oscillators=[];for(let t=0;t<e;t++){const n=new ba({context:this.context,volume:-6-1.1*e,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:0===t?()=>this.onstop(this):Oo});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,"started"===this.state&&this._forEach((e=>e.start()))}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach(((e,t)=>e.phase=this._phase+t/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach((t=>t.baseType=e)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach((t=>t.partials=e)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach((t=>t.partialCount=e)),this._type=this._oscillators[0].type}asArray(e=1024){return Qr(this,void 0,void 0,(function*(){return ya(this,e)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((e=>e.dispose())),this}}class Pa extends _a{constructor(){super(co(Pa.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Aa({context:this.context,value:2});const e=co(Pa.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Oa({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ba({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),So(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(_a.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return Qr(this,void 0,void 0,(function*(){return ya(this,e)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const $a={am:Sa,fat:ka,fm:Ea,oscillator:ba,pulse:Oa,pwm:Pa};class Ma extends _a{constructor(){super(co(Ma.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=co(Ma.getDefaults(),arguments,["frequency","type"]);this.frequency=new ea({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ea({context:this.context,units:"cents",value:e.detune}),So(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(ba.getDefaults(),Ea.getDefaults(),Sa.getDefaults(),ka.getDefaults(),Oa.getDefaults(),Pa.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some((e=>this._sourceType===e))&&(e=this._sourceType),e+this._oscillator.type}set type(e){"fm"===e.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"am"===e.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"fat"===e.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):"pwm"===e?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===e?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=$a[e],n=this.now();if(this._oscillator){const e=this._oscillator;e.stop(n),this.context.setTimeout((()=>e.dispose()),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(t=this._oscillator.type),"fm"===e?this.type="fm"+t:"am"===e?this.type="am"+t:"fat"===e?this.type="fat"+t:"oscillator"===e?this.type=t:"pulse"===e?this.type="pulse":"pwm"===e&&(this.type="pwm")}_getOscType(e,t){return e instanceof $a[t]}get baseType(){return this._oscillator.baseType}set baseType(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===e||"pwm"===e||(this._oscillator.baseType=e)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(e){this._getOscType(this._oscillator,"fat")&&Wr(e)&&(this._oscillator.count=e)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(e){this._getOscType(this._oscillator,"fat")&&Wr(e)&&(this._oscillator.spread=e)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&zr(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(e=1024){return Qr(this,void 0,void 0,(function*(){return ya(this,e)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function Ra(e,t=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){jr(s,e,t),n.set(this,s)}})}}function Na(e,t=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){jr(this.toSeconds(s),e,t),n.set(this,s)}})}}class Ia extends _a{constructor(){super(co(Ia.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=co(Ia.getDefaults(),arguments,["url","onload"]);this._buffer=new ko({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(_a.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Oo,onerror:Oo,playbackRate:1,reverse:!1})}load(e){return Qr(this,void 0,void 0,(function*(){return yield this._buffer.load(e),this._onload(),this}))}_onload(e=Oo){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){t=this._loop?lo(t,this._loopStart):lo(t,0);const s=this.toSeconds(t),i=n;n=lo(n,Math.max(this._buffer.duration-s,0));let r=this.toSeconds(n);r/=this._playbackRate,e=this.toSeconds(e);const o=new va({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(e+r),this._state.setStateAtTime("stopped",e+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&qr(i)?o.start(e,s):o.start(e,s,r-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach((e=>e.stop(t)))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){this._stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if("started"===this._state.getValueAtTime(n)){const t=this.toSeconds(e);this._stop(n),this._start(n,t)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&jr(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopStart=e}))}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&jr(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopEnd=e}))}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach((t=>{t.loop=e})),e)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((e=>e.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(e,t)}))}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((e=>e.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}Kr([Na(0)],Ia.prototype,"fadeIn",void 0),Kr([Na(0)],Ia.prototype,"fadeOut",void 0);class La extends zo{constructor(){super(co(La.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new ea({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=co(La.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(zo.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(zr(e))return e;{let n;for(n in Da)if(Da[n][t]===e)return n;return e}}_setCurve(e,t,n){if(zr(n)&&Reflect.has(Da,n)){const s=Da[n];Hr(s)?"_decayCurve"!==e&&(this[e]=s[t]):this[e]=s}else{if(!Yr(n)||"_decayCurve"===e)throw new Error("Envelope: invalid curve: "+n);this[e]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){Vr(["linear","exponential"].some((t=>t===e)),`Invalid envelope curve: ${e}`),this._decayCurve=e}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let n=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),i=this.getValueAtTime(e);if(i>0){n=(1-i)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if("linear"===this._attackCurve)this._sig.linearRampTo(t,n,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,n,e);else{this._sig.cancelAndHoldAtTime(e);let s=this._attackCurve;for(let e=1;e<s.length;e++)if(s[e-1]<=i&&i<=s[e]){s=this._attackCurve.slice(e),s[0]=i;break}this._sig.setValueCurveAtTime(s,e,n,t)}if(s&&this.sustain<1){const i=t*this.sustain,r=e+n;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,s+r):this._sig.exponentialApproachValueAtTime(i,r,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,e):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,e):(Vr(Yr(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return ta(this,e,t,n),this}asArray(e=1024){return Qr(this,void 0,void 0,(function*(){const t=e/this.context.sampleRate,n=new Po(1,t,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),r=.1*i,o=i+r,a=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/o,decay:t*this.toSeconds(this.decay)/o,release:t*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(t*(s+r)/o,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}Kr([Na(0)],La.prototype,"attack",void 0),Kr([Na(0)],La.prototype,"decay",void 0),Kr([Ra(0,1)],La.prototype,"sustain",void 0),Kr([Na(0)],La.prototype,"release",void 0);const Da=(()=>{const e=128;let t,n;const s=[];for(t=0;t<e;t++)s[t]=Math.sin(t/127*(Math.PI/2));const i=[];for(t=0;t<127;t++){n=t/127;const e=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;i[t]=e/10+.83*n}i[127]=1;const r=[];for(t=0;t<e;t++)r[t]=Math.ceil(t/127*5)/5;const o=[];for(t=0;t<e;t++)n=t/127,o[t]=.5*(1-Math.cos(Math.PI*n));const a=[];for(t=0;t<e;t++){n=t/127;const e=4*Math.pow(n,3)+.2,s=Math.cos(e*Math.PI*2*n);a[t]=Math.abs(s*(1-n))}function c(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=1-e[n];return t}return{bounce:{In:c(a),Out:a},cosine:{In:s,Out:(l=s,l.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:c(i)},sine:{In:o,Out:c(o)},step:{In:r,Out:c(r)}};var l})();class Va extends zo{constructor(){super(co(Va.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const e=co(Va.getDefaults(),arguments);this._volume=this.output=new ha({context:this.context,volume:e.volume}),this.volume=this._volume.volume,So(this,"volume")}static getDefaults(){return Object.assign(zo.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...e)=>{const s=e[t],i=this.context.transport.schedule((s=>{e[t]=s,n.apply(this,e)}),s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((e=>this.context.transport.clear(e))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,t,n,s){const i=this.toSeconds(n),r=this.toSeconds(t);return this.triggerAttack(e,i,s),this.triggerRelease(i+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class ja extends Va{constructor(){super(co(ja.getDefaults(),arguments));const e=co(ja.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Va.getDefaults(),{detune:0,onsilence:Oo,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);const s=this.toSeconds(t);return this._triggerEnvelopeAttack(s,n),this.setNote(e,s),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),s=e instanceof Bo?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const e=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,e,n)}else this.frequency.setValueAtTime(s,n);return this}}Kr([Na(0)],ja.prototype,"portamento",void 0);class Ga extends La{constructor(){super(co(Ga.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Jo({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Ba extends ja{constructor(){super(co(Ba.getDefaults(),arguments)),this.name="Synth";const e=co(Ba.getDefaults(),arguments);this.oscillator=new Ma(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Ga(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),So(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(ja.getDefaults(),{envelope:Object.assign(uo(La.getDefaults(),Object.keys(zo.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(uo(Ma.getDefaults(),[...Object.keys(_a.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),0===this.envelope.sustain){const t=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+t+n)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Fa extends Ba{constructor(){super(co(Fa.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=co(Fa.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,So(this,["oscillator","envelope"])}static getDefaults(){return ao(ja.getDefaults(),Ba.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),s=this.toFrequency(e instanceof Bo?e.toFrequency():e),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Kr([Ra(0)],Fa.prototype,"octaves",void 0),Kr([Na(0)],Fa.prototype,"pitchDecay",void 0);const qa=new Set;function Ua(e){qa.add(e)}function Wa(e,t){const n=`registerProcessor("${e}", ${t})`;qa.add(n)}Ua('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');Ua("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");Ua("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");Wa("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Ha extends Va{constructor(){super(co(Ha.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=co(Ha.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach((n=>{const s=parseInt(n,10);if(Vr(Xr(n)||Wr(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),Xr(n)){const s=new Bo(this.context,n).toMidi();t[s]=e.urls[n]}else Wr(s)&&isFinite(s)&&(t[s]=e.urls[s])})),this._buffers=new oa({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Va.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Oo,onerror:Oo,release:.1,urls:{}})}_findClosest(e){let t=0;for(;t<96;){if(this._buffers.has(e+t))return-t;if(this._buffers.has(e-t))return t;t++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach((e=>{const s=Vo(new Bo(this.context,e).toFrequency()),i=Math.round(s),r=s-i,o=this._findClosest(i),a=i-o,c=this._buffers.get(a),l=Io(o+r),u=new va({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:l}).connect(this.output);u.start(t,0,c.duration/l,n),Yr(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(u),u.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const e=this._activeSources.get(i),t=e.indexOf(u);-1!==t&&e.splice(t,1)}}})),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach((e=>{const n=new Bo(this.context,e).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const e=this._activeSources.get(n);t=this.toSeconds(t),e.forEach((e=>{e.stop(t)})),this._activeSources.set(n,[])}})),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach((e=>{for(;e.length;){e.shift().stop(t)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(e,i,s),Yr(t)?(Vr(Yr(e),"notes must be an array when duration is array"),e.forEach(((e,n)=>{const s=t[Math.min(n,t.length-1)];this.triggerRelease(e,i+this.toSeconds(s))}))):this.triggerRelease(e,i+this.toSeconds(t)),this}add(e,t,n){if(Vr(Xr(e)||isFinite(e),`note must be a pitch or midi: ${e}`),Xr(e)){const s=new Bo(this.context,e).toMidi();this._buffers.add(s,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((e=>{e.forEach((e=>e.dispose()))})),this._activeSources.clear(),this}}Kr([Na(0)],Ha.prototype,"attack",void 0),Kr([Na(0)],Ha.prototype,"release",void 0);class Ya extends zo{constructor(){super(Object.assign(co(Ya.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=co(Ya.getDefaults(),arguments,["pan"]);this.pan=new Yo({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",So(this,"pan")}static getDefaults(){return Object.assign(zo.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}Wa("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class za extends zo{constructor(){super(co(za.getDefaults(),arguments,["solo"])),this.name="Solo";const e=co(za.getDefaults(),arguments,["solo"]);this.input=this.output=new Jo({context:this.context}),za._allSolos.has(this.context)||za._allSolos.set(this.context,new Set),za._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(zo.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),za._allSolos.get(this.context).forEach((e=>e._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){za._soloed.has(this.context)||za._soloed.set(this.context,new Set),za._soloed.get(this.context).add(this)}_removeSolo(){za._soloed.has(this.context)&&za._soloed.get(this.context).delete(this)}_isSoloed(){return za._soloed.has(this.context)&&za._soloed.get(this.context).has(this)}_noSolos(){return!za._soloed.has(this.context)||za._soloed.has(this.context)&&0===za._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),za._allSolos.get(this.context).delete(this),this._removeSolo(),this}}za._allSolos=new Map,za._soloed=new Map;class Xa extends zo{constructor(){super(co(Xa.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=co(Xa.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Ya({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new ha({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,So(this,["pan","volume"])}static getDefaults(){return Object.assign(zo.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Za extends zo{constructor(){super(co(Za.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=co(Za.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new za({solo:e.solo,context:this.context}),this._panVol=this.output=new Xa({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),So(this,["pan","volume"])}static getDefaults(){return Object.assign(zo.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Za.buses.has(e)||Za.buses.set(e,new Jo({context:this.context})),Za.buses.get(e)}send(e,t=0){const n=this._getBus(e),s=new Jo({context:this.context,units:"decibels",gain:t});return this.connect(s),s.connect(n),s}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Za.buses=new Map;class Ja extends zo{constructor(){super(...arguments),this.name="Listener",this.positionX=new Yo({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Yo({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Yo({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Yo({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Yo({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Yo({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Yo({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Yo({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Yo({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(zo.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}var Ka,Qa,ec;wo((e=>{e.listener=new Ja({context:e})})),xo((e=>{e.listener.dispose()})),Ro().transport,Ro().destination,Ro().destination,Ro().listener,Ro().draw,Ro(),function(e){e.MAIN="MAIN"}(Ka||(Ka={}));class tc{constructor(e,t){this.autoplayRepository=e,this.dateGateway=t}hasAutoplay(){return this.autoplayRepository.hasAutoplay()}isTimeForNextCleavage(){return Promise.all([this.autoplayRepository.retrieveNextAutoPlayDate(),this.dateGateway.retrieveCurrentDate()]).then((([e,t])=>Promise.resolve(t>=e))).catch((e=>Promise.reject(e)))}configureNextAutoPlay(e){return 0===e?this.onDisableAutoplay(e):this.dateGateway.retrieveCurrentDate().then((t=>e?this.onAutoplayMinutes(t,e):this.onNoAutoplayMinutes(t))).catch((e=>Promise.reject(e)))}onDisableAutoplay(e){return Promise.all([this.autoplayRepository.configureAutoplayInterval(e),this.autoplayRepository.configureNextAutoPlay(null)]).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}onAutoplayMinutes(e,t){return Promise.all([this.autoplayRepository.configureNextAutoPlay(this.addMinutes(new Date(e),t)),this.autoplayRepository.configureAutoplayInterval(t)]).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}onNoAutoplayMinutes(e){return this.autoplayRepository.retreiveAutoplayInterval().then((t=>this.autoplayRepository.configureNextAutoPlay(this.addMinutes(new Date(e),t)))).catch((e=>Promise.reject(e)))}addMinutes(e,t){return e.setMinutes(e.getMinutes()+t),e}}class nc extends J{constructor(){super(...arguments),this.eventType=Z.INSTALL_NEW_STOOLS_ON_BAR}}class sc extends J{constructor(e,t){super(),this.id=e,this.interfaceEntityState=t,this.eventType=Z.DRAW}}class ic extends J{constructor(){super(...arguments),this.eventType=Z.INSTALL_NEW_TABLE}}class rc extends J{constructor(e,t){super(),this.username=e,this.position=t,this.eventType=Z.PLAYER_MOVE}}class oc extends J{constructor(e){super(),this.username=e,this.eventType=Z.PLAYER_QUIT}}class ac extends J{constructor(){super(...arguments),this.eventType=Z.TABLE_STOOL_AVAILABLE}}!function(e){e.LEFT="LEFT",e.RIGHT="RIGHT",e.DOWN="DOWN",e.UP="UP"}(Qa||(Qa={})),function(e){e.PLAYER="PLAYER",e.BAR="BAR",e.STOOL="STOOL"}(ec||(ec={}));class cc extends J{constructor(e){super(),this.gamePhase=e,this.eventType=Z.CHANGE_GAME_PHASE}}class lc extends J{constructor(e){super(),this.tableId=e,this.eventType=Z.INSTALL_NEW_STOOLS_ON_TABLE}}class uc{constructor(e,t,n){this.barRepository=e,this.eventGateway=t,this.uuidGateway=n,this.stoolRowsPerTables=2,this.stoolsPerStoolRow=3,this.stoolDiameter=.4,this.defaultTableHorizontalOffset=3.1,this.defaultTableVerticalOffset=2,this.tableSize={height:.8,width:2.4},this.firstTablePosition={x:-.2,y:-2},this.defaultBarPosition={x:0,y:0},this.defaultBarSize={width:8.2,height:6.8},this.firstStoolOffset={x:.6,y:-.4}}installStoolForBar(){const e=this.makeBarStools();return Promise.all(e.map((e=>this.uuidGateway.nextId()))).then((t=>(t.forEach(((t,n)=>{e[n].id=t})),Promise.all(e.map((e=>this.barRepository.addAvailableBarStool(e))))))).then((t=>this.eventGateway.sendEvents(e.map((e=>new sc(e.id,{position:e.position,sprite:ec.STOOL})))))).catch((e=>Promise.reject(e)))}makeBarStools(){const e=[];for(let t=0;t<2;t++)for(let n=0;n<9;n++){0!==t&&(3===n||4===n)||e.push({id:"",size:{width:this.stoolDiameter,height:this.stoolDiameter},position:{x:this.precisionRound(this.firstStoolOffset.x+.8*n,3),y:this.precisionRound(this.firstStoolOffset.y+(0===t?0:7.2),3)}})}return e}installBar(){return this.uuidGateway.nextId().then((e=>this.onBarUuid(e))).catch((e=>Promise.reject(e)))}onBarUuid(e){return this.barRepository.installBar({position:this.defaultBarPosition,size:this.defaultBarSize,id:e}).then((()=>this.eventGateway.sendEvents([new nc,new sc(e,{position:this.defaultBarPosition,sprite:ec.BAR}),new Q(X.GAME),new cc(Ce.NEW_CLEAVAGE)]))).catch((e=>Promise.reject(e)))}askForNewTable(){return this.eventGateway.sendEvent(new ic)}installPlayerFromBarStoolToTableStool(e){return this.barRepository.freeBarStool(e.username).then((()=>this.barRepository.nextAvailableTableStool())).then((t=>this.occupyTableStool(t,e.username))).catch((e=>Promise.reject(e)))}occupyTableStool(e,t){return this.barRepository.setOccupiedTableStool(t,e).then((()=>this.eventGateway.sendEvent(new rc(t,e.position)))).catch((e=>Promise.reject(e)))}nextOccupiedBarStool(){return this.barRepository.nextOccupiedBarStool()}installStoolForTable(e){return this.barRepository.retrieveTableById(e).then((e=>this.stoolsForTable(e))).then((e=>this.onStoolsForTable(e))).catch((e=>Promise.reject(e)))}installNewTable(){return Promise.all([this.barRepository.retrieveTables(),this.barRepository.retrieveBar(),this.barRepository.retreiveTableDirection(),this.uuidGateway.nextId()]).then((([e,t,n,s])=>e.length>0?this.onTables(s,e,t,n):this.installTable({id:s,size:this.tableSize,position:this.firstTablePosition}))).catch((e=>Promise.reject(e)))}onStoolsForTable(e){return Promise.all(e.map((e=>this.barRepository.addAvailableTableStool(e)))).then((e=>this.eventGateway.sendEvent(new ac))).catch((e=>Promise.reject(e)))}stoolsForTable(e){const t=[];for(let n=1;n<=this.stoolRowsPerTables;n++)for(let s=0;s<this.stoolsPerStoolRow;s++)t.push(this.makeStool(e,n,s));return Promise.all(t)}makeStool(e,t,n){return this.uuidGateway.nextId().then((s=>({id:s,size:{width:this.stoolDiameter,height:this.stoolDiameter},position:this.stoolPosition(e,t,n)}))).catch((e=>Promise.reject(e)))}stoolPosition(e,t,n){return{x:this.precisionRound(e.position.x+(this.stoolDiameter/2+n*this.stoolDiameter*2),3),y:this.precisionRound(e.position.y+(t%2==0?2*this.stoolDiameter:-this.stoolDiameter),3)}}onTables(e,t,n,s){return this.newTablePositionAndDirection(t,n,s).then((({position:t,direction:n})=>Promise.all([this.installTable({id:e,position:t,size:this.tableSize}),this.barRepository.updateTableDirection(n)]))).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}newTablePositionAndDirection(e,t,n){const s=e[e.length-1],i=new Map([[Qa.UP,{isNoCollision:()=>this.isNoCollision(s,[t,...e],this.defaultTableHorizontalOffset,0),direction:Qa.RIGHT}],[Qa.RIGHT,{isNoCollision:()=>this.isNoCollision(s,[t,...e],0,this.defaultTableVerticalOffset),direction:Qa.DOWN}],[Qa.DOWN,{isNoCollision:()=>this.isNoCollision(s,[t,...e],-this.defaultTableHorizontalOffset,0),direction:Qa.LEFT}],[Qa.LEFT,{isNoCollision:()=>this.isNoCollision(s,[t,...e],0,-this.defaultTableVerticalOffset),direction:Qa.UP}]]),r=new Map([[Qa.UP,{x:s.position.x+0,y:s.position.y-this.defaultTableVerticalOffset}],[Qa.RIGHT,{x:s.position.x+this.defaultTableHorizontalOffset,y:s.position.y+0}],[Qa.DOWN,{x:s.position.x+0,y:s.position.y+this.defaultTableVerticalOffset}],[Qa.LEFT,{x:s.position.x-this.defaultTableHorizontalOffset,y:s.position.y+0}]]),o=i.get(n);if(!o)return Promise.reject(new Error(`Unsupported change direction strategy with direction ${n}`));n=o.isNoCollision()?o.direction:n;const a=r.get(n);return a?Promise.resolve({position:{x:this.precisionRound(a.x,3),y:this.precisionRound(a.y,3)},direction:n}):Promise.reject(new Error("Position undefined."))}precisionRound(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}isNoCollision(e,t,n,s){e.id;const i=e.size,r={x:this.precisionRound(e.position.x+n,3),y:this.precisionRound(e.position.y+s,3)};for(const e of t){const t=r.x<=e.position.x+e.size.width&&r.x+i.width>=e.position.x;if(r.y<=e.position.y+e.size.height&&r.y+i.height>=e.position.y&&t)return!1}return!0}installTable(e){return console.log(JSON.stringify(e)),this.barRepository.addTable(e).then((()=>this.eventGateway.sendEvent(new lc(e.id)))).catch((e=>Promise.reject(e)))}playerQuit(e){return this.eventGateway.sendEvent(new oc(e))}installPlayerOnBarStool(e){return this.barRepository.nextAvailableBarStool().then((t=>Promise.all([this.barRepository.setOccupiedBarStool(e,t),this.eventGateway.sendEvent(new rc(e,t.position)),this.eventGateway.sendEvent(new ic)]))).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}installPlayerOnTableStool(e){return this.barRepository.nextAvailableTableStool().then((t=>Promise.all([this.barRepository.setOccupiedTableStool(e,t),this.eventGateway.sendEvent(new rc(e,t.position))]))).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}hasAvailableTableStool(){return this.barRepository.hasAvailableTableStool()}hasAvailableBarStool(){return this.barRepository.hasAvailableBarStool()}}const hc={message:"You are already connected to chat."},pc={message:"You are already disconnected to chat."},dc={message:"There is no cleavage available."};class mc{constructor(e,t){this.chatGateway=e,this.interfaceGateway=t}sendMessageToPlayer(e){return this.chatGateway.sendMessageToPlayer(e)}sendMessage(e){return this.chatGateway.sendMessage(e)}isConnected(){return this.chatGateway.isConnected()}connectChat(e,t,n){return this.chatGateway.connect(e,t,n)}disconnectChat(){return this.isConnected().then((e=>e?this.chatGateway.disconnect():this.interfaceGateway.notify(pc)))}}class fc{constructor(e){this.username=e.username,this.position=e.position}toDto(){return{username:this.username,position:this.position}}}class gc{constructor(e){this.name=e.name,this.players=e.players.map((e=>new fc(e)))}toDTO(){return{name:this.name,players:this.players.map((e=>e.toDto()))}}}class _c{constructor(e){this.title=e.title,this.leftChoice=new gc(e.leftChoice),this.rightChoice=new gc(e.rightChoice),this.players=e.players.map((e=>new fc(e)))}toDto(){return{title:this.title,leftChoice:this.leftChoice.toDTO(),rightChoice:this.rightChoice.toDTO(),players:this.players.map((e=>e.toDto()))}}}class vc{constructor(e,t){this.player=e,this.message=t}}var yc;!function(e){e.LEFT="LEFT",e.RIGHT="RIGHT",e.NOTHING="NOTHING"}(yc||(yc={}));class wc{constructor(e,t,n,s,i){this.publicCleavageDrawPileRepository=e,this.globalCleavageDrawPileGateway=t,this.currentCleavageRepository=n,this.chatGateway=s,this.gamePhaseRepository=i}changeGamePhase(e){return this.gamePhaseRepository.changeGamePhase(e)}retrieveCurrentGamePhase(){return this.gamePhaseRepository.retrieveCurrentGamePhase()}saveGlobalCleavage(e){const t=e.toDto();return t.players=[],this.globalCleavageDrawPileGateway.save(new _c(t))}removePlayerOnCleavage(e){return this.loadCleavage().then((t=>(t.leftChoice.players=t.leftChoice.players.filter((t=>t.username!==e.username)),t.rightChoice.players=t.rightChoice.players.filter((t=>t.username!==e.username)),t.players=t.players.filter((t=>t.username!==e.username)),this.saveCleavage(t)))).catch((e=>Promise.reject(e)))}addPlayerOnCleavage(e){return this.loadCleavage().then((t=>(t.players.push(e),this.saveCleavage(t)))).catch((e=>Promise.reject(e)))}isPublicCleavageExist(e){return this.publicCleavageDrawPileRepository.isCleavageExistByTitle(e)}addPublicCleavage(e){return this.publicCleavageDrawPileRepository.addCleavage(e)}loadCleavage(){return this.currentCleavageRepository.load()}hasCleavage(){return this.currentCleavageRepository.hasCleavage()}playerCleave(e){return this.currentCleavageRepository.load().then((t=>this.onCleave(t,e))).catch((e=>Promise.reject(e)))}saveCleavage(e){return this.currentCleavageRepository.save(e)}onCleave(e,t){e.players.some((e=>e.username===t.player.username))||e.players.push(t.player);const n=this.previousPlayerCleave(e,t);return n!==yc.NOTHING?this.onPlayerAlreadyCleave(t,n,e):this.cleave(t,e)}previousPlayerCleave(e,t){return e.leftChoice.players.some((e=>e.username===t.player.username))?yc.LEFT:e.rightChoice.players.some((e=>e.username===t.player.username))?yc.RIGHT:yc.NOTHING}cleave(e,t){return e.playerCleave===yc.LEFT&&t.leftChoice.players.push(e.player),e.playerCleave===yc.RIGHT&&t.rightChoice.players.push(e.player),this.saveCleavage(t)}onPlayerAlreadyCleave(e,t,n){return e.playerCleave===t?this.chatGateway.sendMessageToPlayer(new vc(e.player,`You have still cleave ${t}`)):this.uncleave(e,t,n).then((t=>this.cleave(e,t))).catch((e=>Promise.reject(e)))}uncleave(e,t,n){return t===yc.LEFT&&(n.leftChoice.players=n.leftChoice.players.filter((t=>t.username!==e.player.username))),t===yc.RIGHT&&(n.rightChoice.players=n.rightChoice.players.filter((t=>t.username!==e.player.username))),Promise.resolve(n)}nextPublicCleavage(){return this.publicCleavageDrawPileRepository.nextCleavage()}randomGlobalCleavage(){return this.globalCleavageDrawPileGateway.drawGlobalCleavage()}}class bc{constructor(e){this.eventGateway=e}sentEvent(e){return this.eventGateway.sendEvent(e)}sentEvents(e){return Promise.all(e.map((e=>this.sentEvent(e)))).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}}class xc{constructor(e){this.interfaceGateway=e}changeGamePhase(e){return this.interfaceGateway.changeGamePhase(e)}removeEntityInterfaceState(e){return this.interfaceGateway.removeEntityInterfaceState(e)}updateEntityInterfaceState(e,t){return this.interfaceGateway.updateEntityInterfaceState(e,t)}disableAutoplay(){return this.interfaceGateway.disableAutoplay()}enableAutoplay(){return this.interfaceGateway.enableAutoplay()}changeMusicVolumeLevel(e){return this.interfaceGateway.changeMusicVolumeLevel(e)}changeSoundVolumeLevel(e){return this.interfaceGateway.changeSoundVolumeLevel(e)}playMusic(e){return this.interfaceGateway.playMusic(e)}onNoCleavageAvailable(){return Promise.all([this.clearCleavage(),this.notify(dc)]).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}playSound(e){return this.interfaceGateway.playSound(e)}retrieveCurrentView(){return this.interfaceGateway.retrieveCurrentView()}notify(e){return this.interfaceGateway.notify(e)}updateCleavage(e){return this.interfaceGateway.updateCleavage(e)}changeView(e){return this.interfaceGateway.changeView(e)}newCleavage(){return this.clearCleavage()}clearCleavage(){return this.interfaceGateway.updateCleavage(void 0)}}class Cc extends J{constructor(e){super(),this.username=e,this.eventType=Z.PLAYER_JOIN_BAR}}class Tc{constructor(e,t){this.playerRepository=e,this.eventGateway=t}updatePosition(e,t){return this.playerRepository.playerByUsername(e).then((e=>(e.position=t,this.playerRepository.save(e)))).then((()=>this.eventGateway.sendEvent(new sc(e,{position:t,sprite:ec.PLAYER})))).catch((e=>Promise.reject(e)))}players(){return this.playerRepository.loadAllPlayers()}removePlayer(e){return this.playerRepository.remove(e)}addPlayer(e){return this.playerRepository.hasPlayer(e).then((t=>t?Promise.resolve():this.onNewPlayer(e))).catch((e=>Promise.reject(e)))}onNewPlayer(e){return this.playerRepository.save(e).then((()=>this.eventGateway.sendEvent(new Cc(e.username)))).catch((e=>Promise.reject(e)))}}class Ac extends J{constructor(){super(...arguments),this.eventType=Z.APPLICATION_START}}class Sc extends J{constructor(){super(...arguments),this.eventType=Z.CHECK_AUTOPLAY}}class Ec{}class Oc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.event.sentEvent(new Q(X.MAIN_MENU))}}const kc="!";var Pc;!function(e){e.LEFT="g",e.RIGHT="d",e.UNSUPPORTED="UNSUPPORTED",e.SUGGEST_CLEAVAGE="c",e.HELP="help",e.SHORT_HELP="h",e.SHORT_APPLAUSE="a",e.SHORT_SHOOT="s",e.SHORT_HYPERLIKE="l",e.SHORT_WHISTLE="w"}(Pc||(Pc={}));const $c=`Le jeu du clivage!\nUn jeu pour tout la famille.\nEn tant que joueur tu peux:\n- [ ${kc+Pc.HELP} ] Afficher l'aide (tu viens de le faire XD).\n- [ ${kc+Pc.SHORT_HELP} ] Afficher l'aide (tu viens de le faire XD).\n- [ ${kc+Pc.SUGGEST_CLEAVAGE} {Nom du clivage} ] Proposer un clivage.\n- [ ${kc+Pc.LEFT} ] Cliver à Gôche.\n- [ ${kc+Pc.RIGHT} ] Cliver à Drouate.\n- [ ${kc+Pc.SHORT_APPLAUSE} ] Applaudir.\n- [ ${kc+Pc.SHORT_HYPERLIKE} ] Kiffer.\n- [ ${kc+Pc.SHORT_SHOOT} ] Huer.\n- [ ${kc+Pc.SHORT_WHISTLE} ] Siffler.\nAttention... ça va cliver!`;class Mc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.chat.sendMessageToPlayer(new vc(e.player,$c))}}class Rc{constructor(e){this.type=e}}var Nc;!function(e){e.QUACK="QUACK",e.DICE_ROLL="DICE_ROLL",e.ERROR="ERROR",e.APPLAUSE="APPLAUSE",e.WHISTLE="WHISTLE",e.SHOOT="SHOOT",e.HYPERLIKE="HYPERLIKE",e.POUFFF="POUFFF",e.TICK="TICK"}(Nc||(Nc={}));class Ic extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.interface.clearCleavage().then((()=>this.applicationServices.interface.playSound(new Rc(Nc.QUACK)))).catch((e=>Promise.reject(e)))}}class Lc extends Ec{constructor(e){super(),this.interfaceApplicationService=e}execute(e){return this.interfaceApplicationService.changeMusicVolumeLevel(e.volume).then((()=>this.interfaceApplicationService.playSound(new Rc(Nc.TICK)))).catch((e=>Promise.reject(e)))}}class Dc extends Ec{constructor(e){super(),this.interfaceApplicationService=e}execute(e){return this.interfaceApplicationService.changeSoundVolumeLevel(e.volume).then((()=>this.interfaceApplicationService.playSound(new Rc(Nc.TICK)))).catch((e=>Promise.reject(e)))}}class Vc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return Promise.resolve([this.applicationServices.interface.changeView(e.targetView),this.applicationServices.interface.playSound(new Rc(Nc.POUFFF))]).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}}class jc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.interface.playSound(new Rc(Nc.APPLAUSE))}}class Gc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.player.addPlayer(e.player).then((()=>this.applicationServices.cleavage.retrieveCurrentGamePhase())).then((t=>t!==Ce.CLEAVING?this.applicationServices.chat.sendMessageToPlayer(new vc(e.player,"Wait for cleavage launch! 👀")):this.onCleavingPhase(e))).catch((e=>Promise.reject(e)))}onCleavingPhase(e){return this.applicationServices.cleavage.hasCleavage().then((t=>{return t?this.onCleavage(e):this.applicationServices.chat.sendMessageToPlayer({player:n=e.player,message:`Il n'y a pas de clivage en cours ${n.username}. Attends un peu.`});var n})).catch((e=>Promise.reject(e)))}onCleavage(e){return this.applicationServices.cleavage.playerCleave(e).then((()=>this.updateCleavageOnInterface())).catch((e=>Promise.reject(e)))}updateCleavageOnInterface(){return this.applicationServices.cleavage.loadCleavage().then((e=>this.applicationServices.interface.updateCleavage(e))).catch((e=>Promise.reject(e)))}}class Bc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.interface.playSound(new Rc(Nc.HYPERLIKE))}}class Fc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.player.players().then((t=>{const n=t.find((t=>t.username===e.username));return n?this.onPlayer(n):this.onMissingPlayer()}))}onMissingPlayer(){return Promise.resolve()}onPlayer(e){return this.applicationServices.player.removePlayer(e).then((()=>this.applicationServices.cleavage.hasCleavage())).then((t=>t?this.onCleavage(e):Promise.resolve())).catch((e=>Promise.reject(e)))}onCleavage(e){return this.applicationServices.cleavage.removePlayerOnCleavage(e).then((()=>this.applicationServices.cleavage.loadCleavage())).then((e=>this.applicationServices.interface.updateCleavage(e))).catch((e=>Promise.reject(e)))}}class qc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.interface.playSound(new Rc(Nc.SHOOT))}}class Uc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.interface.playSound(new Rc(Nc.WHISTLE))}}class Wc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.cleavage.isPublicCleavageExist(e.cleavage).then((t=>t?this.applicationServices.chat.sendMessageToPlayer(new vc(e.player,"Cleavage already suggested.")):this.onPublicCleavageExist(e))).catch((e=>Promise.reject(e)))}onPublicCleavageExist(e){return this.applicationServices.cleavage.addPublicCleavage(e.cleavage).then((()=>{return this.applicationServices.chat.sendMessageToPlayer(new vc(e.player,(t=e.player,`Cleavage '${e.cleavage.title}' suggested to streamer.\n You rocks ${t.username}! 👍`)));var t})).catch((e=>Promise.reject(e)))}}class Hc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.chat.isConnected().then((t=>t?this.onConnected(e):this.applicationServices.event.sentEvent(new Q(X.CONNECT_CHAT)))).catch((e=>Promise.reject(e)))}onConnected(e){return this.applicationServices.player.players().then((t=>this.applicationServices.cleavage.saveCleavage(new _c({title:e.cleavageTitle,leftChoice:{name:e.leftChoiceName,players:[]},rightChoice:{name:e.rightChoiceName,players:[]},players:t})))).then((()=>this.applicationServices.cleavage.loadCleavage())).then((e=>Promise.all([this.applicationServices.interface.updateCleavage(e),this.applicationServices.cleavage.saveGlobalCleavage(e)]))).then((e=>this.applicationServices.event.sentEvent(new cc(Ce.CLEAVING)))).catch((e=>Promise.reject(e)))}}class Yc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.chat.disconnectChat()}}class zc extends J{constructor(e,t,n){super(),this.cleavageTitle=e,this.leftChoiceName=t,this.rightChoiceName=n,this.eventType=Z.LAUNCH_CLEAVAGE}}class Xc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.cleavage.nextPublicCleavage().then((e=>e?this.onCleavage(e):this.onNoPublicCleavage())).catch((e=>Promise.reject(e)))}onCleavage(e){return Promise.all([this.applicationServices.cleavage.saveCleavage(e),this.applicationServices.interface.updateCleavage(e),this.applicationServices.interface.playSound(new Rc(Nc.DICE_ROLL))]).then((e=>this.applicationServices.autoplay.hasAutoplay())).then((t=>t?this.applicationServices.event.sentEvent(new zc(e.title,e.leftChoice.name,e.rightChoice.name)):Promise.resolve())).catch((e=>Promise.reject(e)))}onNoPublicCleavage(){return this.applicationServices.cleavage.randomGlobalCleavage().then((e=>e?this.onCleavage(e):this.onNoGlobalCleavage())).catch((e=>Promise.reject(e)))}onNoGlobalCleavage(){return Promise.all([this.applicationServices.interface.onNoCleavageAvailable(),this.applicationServices.interface.playSound(new Rc(Nc.ERROR))]).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}}class Zc extends J{constructor(){super(),this.eventType=Z.DRAW_CLEAVAGE}}class Jc extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.chat.isConnected().then((e=>e?this.onConnected():this.applicationServices.event.sentEvent(new Q(X.CONNECT_CHAT)))).catch((e=>Promise.reject(e)))}onConnected(){return this.applicationServices.interface.newCleavage().then((()=>Promise.all([this.applicationServices.autoplay.hasAutoplay(),this.applicationServices.interface.retrieveCurrentView(),this.applicationServices.cleavage.retrieveCurrentGamePhase()]))).then((([e,t,n])=>this.applicationServices.event.sentEvents([...n===Ce.NEW_CLEAVAGE?[]:[new cc(Ce.NEW_CLEAVAGE)],...t!==X.GAME?[new Q(X.GAME)]:[],...e?[new Zc]:[]]))).catch((e=>Promise.reject(e)))}}const Kc=new class{constructor(e,t){this.supportedMusic=e,this.volume=t}}(Ka.MAIN,0);class Qc extends class{constructor(e){this.message=e}}{constructor(){super(el)}}const el="La régie du jeu du clivage est chaud patate!\nPour obtenir de l'aide, lancer la commande '!h'";class tl extends J{constructor(){super(...arguments),this.eventType=Z.CREATE_BAR}}class nl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.chat.isConnected().then((t=>t?this.applicationServices.interface.notify(hc):this.onDisconnected(e))).catch((e=>Promise.reject(e)))}onDisconnected(e){return this.applicationServices.chat.connectChat(e.username,e.token,e.channel).then((()=>this.onConnected())).catch((e=>Promise.reject(e)))}onConnected(){return Promise.all([this.applicationServices.event.sentEvent(new tl),this.applicationServices.chat.sendMessage(new Qc),this.applicationServices.interface.playMusic(Kc)]).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}}class sl extends J{constructor(e,t){super(),this.player=e,this.playerCleave=t,this.eventType=Z.PLAYER_CLEAVE}}class il extends J{constructor(e,t){super(),this.player=e,this.cleavage=t,this.eventType=Z.PLAYER_SUGGEST_CLEAVAGE}}class rl extends J{constructor(){super(...arguments),this.eventType=Z.PLAYER_APPLAUSE}}class ol extends J{constructor(){super(...arguments),this.eventType=Z.PLAYER_SHOOT}}class al extends J{constructor(){super(...arguments),this.eventType=Z.PLAYER_HYPERLIKE}}class cl extends J{constructor(){super(...arguments),this.eventType=Z.PLAYER_WHISTLE}}class ll extends J{constructor(e){super(),this.player=e,this.eventType=Z.PLAYER_ASK_FOR_HELP}}class ul extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return e.message.startsWith(kc)?this.onApplicationEvent(e.player,e.message):Promise.resolve()}onApplicationEvent(e,t){const n=this.applicationEventStrategies(t,e).get(!0);return n?this.applicationServices.event.sentEvent(n):this.applicationServices.chat.sendMessageToPlayer(new vc(e,function(e){return`I don't know what to do with that ${e.username}.`}(e)))}applicationEventStrategies(e,t){return new Map([[e===kc+Pc.SHORT_APPLAUSE,new rl],[e===kc+Pc.SHORT_WHISTLE,new cl],[e===kc+Pc.SHORT_HYPERLIKE,new al],[e===kc+Pc.SHORT_SHOOT,new ol],[e===kc+Pc.RIGHT,new sl(t,yc.RIGHT)],[e===kc+Pc.LEFT,new sl(t,yc.LEFT)],[e===kc+Pc.HELP,new ll(t)],[e===kc+Pc.SHORT_HELP,new ll(t)],[e.startsWith(kc+Pc.SUGGEST_CLEAVAGE),new il(t,this.newCleavageFromMessage(e))]])}newCleavageFromMessage(e){return new _c({title:e.replace(kc+Pc.SUGGEST_CLEAVAGE,"").trimStart(),leftChoice:{name:"Gôche",players:[]},rightChoice:{name:"Drouate",players:[]},players:[]})}}class hl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.autoplay.hasAutoplay().then((e=>e?this.onAutoPlay():Promise.resolve())).catch((e=>Promise.reject(e)))}onAutoPlay(){return this.applicationServices.autoplay.isTimeForNextCleavage().then((e=>e?this.onTimeForNextCleavage():Promise.resolve())).catch((e=>Promise.reject(e)))}onTimeForNextCleavage(){return Promise.resolve([this.applicationServices.autoplay.configureNextAutoPlay(),this.applicationServices.event.sentEvent(new Fe)]).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}}class pl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.autoplay.configureNextAutoPlay(e.autoplayMinutes).then((()=>this.applicationServices.interface.enableAutoplay())).then((()=>this.applicationServices.event.sentEvent(new Zc))).catch((e=>Promise.reject(e)))}}class dl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.autoplay.configureNextAutoPlay(0).then((()=>this.applicationServices.interface.disableAutoplay())).catch((e=>Promise.reject(e)))}}class ml extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.bar.hasAvailableTableStool().then((t=>t?this.onTableStoolAvailable(e.username):this.onTableStoolUnavailable(e.username))).catch((e=>Promise.reject(e)))}onTableStoolAvailable(e){return this.applicationServices.bar.installPlayerOnTableStool(e)}onTableStoolUnavailable(e){return this.applicationServices.bar.hasAvailableBarStool().then((t=>t?this.onBarStoolAvailable(e):this.onBarStoolUnavailable(e))).catch((e=>Promise.reject(e)))}onBarStoolUnavailable(e){return this.applicationServices.bar.playerQuit(e)}onBarStoolAvailable(e){return this.applicationServices.bar.installPlayerOnBarStool(e)}}class fl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.player.updatePosition(e.username,e.position)}}class gl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.bar.installNewTable()}}class _l extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.bar.installStoolForTable(e.tableId)}}class vl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.onEvent()}onEvent(){return this.applicationServices.bar.nextOccupiedBarStool().then((e=>e?this.onOccupiedBarStool(e):Promise.resolve())).catch((e=>Promise.reject(e)))}onOccupiedBarStool(e){return this.applicationServices.bar.hasAvailableTableStool().then((t=>t?this.onTableStoolAvailable(e):this.applicationServices.bar.askForNewTable())).catch((e=>Promise.reject(e)))}onTableStoolAvailable(e){return this.applicationServices.bar.installPlayerFromBarStoolToTableStool(e).then((()=>this.onEvent())).catch((e=>Promise.reject(e)))}}class yl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.bar.installBar()}}class wl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.bar.installStoolForBar()}}class bl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return e.interfaceEntityState?this.applicationServices.interface.updateEntityInterfaceState(e.id,e.interfaceEntityState):this.applicationServices.interface.removeEntityInterfaceState(e.id)}}class xl extends Ec{constructor(e){super(),this.applicationServices=e}execute(e){return this.applicationServices.cleavage.retrieveCurrentGamePhase().then((t=>this.onPreviousGamePhase(e,t)))}onPreviousGamePhase(e,t){return this.applicationServices.cleavage.changeGamePhase(e.gamePhase).then((()=>this.applicationServices.interface.changeGamePhase(e.gamePhase))).then((()=>t!==Ce.NONE?this.applicationServices.interface.playSound(new Rc(Nc.POUFFF)):Promise.resolve())).catch((e=>Promise.reject(e)))}}class Cl{constructor(e){this.applicationServices=e,this.useCases=new Map([]),this.useCases.set(Z.DISCONNECT_CHAT,new Yc(this.applicationServices)),this.useCases.set(Z.CONNECT_CHAT,new nl(this.applicationServices)),this.useCases.set(Z.NEW_CLEAVAGE,new Jc(this.applicationServices)),this.useCases.set(Z.LAUNCH_CLEAVAGE,new Hc(this.applicationServices)),this.useCases.set(Z.PLAYER_MESSAGE,new ul(this.applicationServices)),this.useCases.set(Z.PLAYER_CLEAVE,new Gc(this.applicationServices)),this.useCases.set(Z.DRAW_CLEAVAGE,new Xc(this.applicationServices)),this.useCases.set(Z.PLAYER_SUGGEST_CLEAVAGE,new Wc(this.applicationServices)),this.useCases.set(Z.PLAYER_ASK_FOR_HELP,new Mc(this.applicationServices)),this.useCases.set(Z.CANCEL_CLEAVAGE,new Ic(this.applicationServices)),this.useCases.set(Z.PLAYER_APPLAUSE,new jc(this.applicationServices)),this.useCases.set(Z.PLAYER_HYPERLIKE,new Bc(this.applicationServices)),this.useCases.set(Z.PLAYER_WHISTLE,new Uc(this.applicationServices)),this.useCases.set(Z.PLAYER_SHOOT,new qc(this.applicationServices)),this.useCases.set(Z.APPLICATION_START,new Oc(this.applicationServices)),this.useCases.set(Z.NAVIGATE,new Vc(this.applicationServices)),this.useCases.set(Z.CHANGE_MUSIC_VOLUME,new Lc(this.applicationServices.interface)),this.useCases.set(Z.CHANGE_SOUND_VOLUME,new Dc(this.applicationServices.interface)),this.useCases.set(Z.PLAYER_QUIT,new Fc(this.applicationServices)),this.useCases.set(Z.START_AUTOPLAY,new pl(this.applicationServices)),this.useCases.set(Z.CHECK_AUTOPLAY,new hl(this.applicationServices)),this.useCases.set(Z.STOP_AUTOPLAY,new dl(this.applicationServices)),this.useCases.set(Z.PLAYER_JOIN_BAR,new ml(this.applicationServices)),this.useCases.set(Z.PLAYER_MOVE,new fl(this.applicationServices)),this.useCases.set(Z.INSTALL_NEW_TABLE,new gl(this.applicationServices)),this.useCases.set(Z.INSTALL_NEW_STOOLS_ON_TABLE,new _l(this.applicationServices)),this.useCases.set(Z.TABLE_STOOL_AVAILABLE,new vl(this.applicationServices)),this.useCases.set(Z.CREATE_BAR,new yl(this.applicationServices)),this.useCases.set(Z.INSTALL_NEW_STOOLS_ON_BAR,new wl(this.applicationServices)),this.useCases.set(Z.DRAW,new bl(this.applicationServices)),this.useCases.set(Z.CHANGE_GAME_PHASE,new xl(this.applicationServices))}executeEvent(e){const t=this.useCases.get(e.eventType);return t?t.execute(e):Promise.reject(new Error(((e,t)=>`Event '${e.eventType}' is not supported by ${t.constructor.name}.`)(e,this)))}}var Tl={exports:{}},Al=nt(Object.freeze({__proto__:null,default:{}})),Sl={exports:{}};const El=/^\u0001ACTION ([^\u0001]+)\u0001$/,Ol=/^(justinfan)(\d+$)/,kl=/\\([sn:r\\])/g,Pl=/([ \n;\r\\])/g,$l={s:" ",n:"",":":";",r:""},Ml={" ":"s","\n":"n",";":":","\r":"r"},Rl=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),Nl=/[|\\^$*+?:#]/,Il=Sl.exports={get:(e,t)=>void 0===e?t:e,hasOwn:(e,t)=>({}.hasOwnProperty.call(e,t)),promiseDelay:e=>new Promise((t=>setTimeout(t,e))),isFinite:e=>isFinite(e)&&!isNaN(parseFloat(e)),toNumber(e,t){if(null===e)return 0;const n=Math.pow(10,Il.isFinite(t)?t:0);return Math.round(e*n)/n},isInteger:e=>!isNaN(Il.toNumber(e,0)),isRegex:e=>Nl.test(e),isURL:e=>Rl.test(e),justinfan:()=>`justinfan${Math.floor(8e4*Math.random()+1e3)}`,isJustinfan:e=>Ol.test(e),channel(e){const t=(e||"").toLowerCase();return"#"===t[0]?t:"#"+t},username(e){const t=(e||"").toLowerCase();return"#"===t[0]?t.slice(1):t},token:e=>e?e.toLowerCase().replace("oauth:",""):"",password(e){const t=Il.token(e);return t?`oauth:${t}`:""},actionMessage:e=>e.match(El),replaceAll(e,t){if(null==e)return null;for(const n in t)e=e.replace(new RegExp(n,"g"),t[n]);return e},unescapeHtml:e=>e.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'"),unescapeIRC:e=>e&&"string"==typeof e&&e.includes("\\")?e.replace(kl,((e,t)=>t in $l?$l[t]:t)):e,escapeIRC:e=>e&&"string"==typeof e?e.replace(Pl,((e,t)=>t in Ml?`\\${Ml[t]}`:t)):e,addWord:(e,t)=>e.length?e+" "+t:e+t,splitLine(e,t){let n=e.substring(0,t).lastIndexOf(" ");return-1===n&&(n=t-1),[e.substring(0,n),e.substring(n+1)]},extractNumber(e){const t=e.split(" ");for(let e=0;e<t.length;e++)if(Il.isInteger(t[e]))return~~t[e];return 0},formatDate(e){let t=e.getHours(),n=e.getMinutes();return t=(t<10?"0":"")+t,n=(n<10?"0":"")+n,`${t}:${n}`},inherits(e,t){e.super_=t;const n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},isNode(){try{return"object"==typeof process&&"[object process]"===Object.prototype.toString.call(process)}catch(e){}return!1}},Ll=Al,Dl=Sl.exports;var Vl=function(e,t){let n=void 0!==e.url?e.url:e.uri;if(Dl.isURL(n)||(n=`https://api.twitch.tv/kraken${"/"===n[0]?n:`/${n}`}`),Dl.isNode()){const s=Object.assign({method:"GET",json:!0},e);if(s.qs){n+=`?${new URLSearchParams(s.qs)}`}const i={};"fetchAgent"in this.opts.connection&&(i.agent=this.opts.connection.fetchAgent);const r=Ll(n,{...i,method:s.method,headers:s.headers,body:s.body});let o={};r.then((e=>(o={statusCode:e.status,headers:e.headers},s.json?e.json():e.text()))).then((e=>t(null,o,e)),(e=>t(e,o,null)))}else{const s=Object.assign({method:"GET",headers:{}},e,{url:n}),i=new XMLHttpRequest;i.open(s.method,s.url,!0);for(const e in s.headers)i.setRequestHeader(e,s.headers[e]);i.responseType="json",i.addEventListener("load",(e=>{4===i.readyState&&(200!==i.status?t(i.status,null,null):t(null,null,i.response))})),i.send()}};const jl=Sl.exports;function Gl(e,t){return e=jl.channel(e),t=jl.get(t,30),this._sendCommand(null,e,`/followers ${t}`,((n,s)=>{this.once("_promiseFollowers",(i=>{i?s(i):n([e,~~t])}))}))}function Bl(e){return e=jl.channel(e),this._sendCommand(null,e,"/followersoff",((t,n)=>{this.once("_promiseFollowersoff",(s=>{s?n(s):t([e])}))}))}function Fl(e){return e=jl.channel(e),this._sendCommand(null,null,`PART ${e}`,((t,n)=>{this.once("_promisePart",(s=>{s?n(s):t([e])}))}))}function ql(e){return e=jl.channel(e),this._sendCommand(null,e,"/r9kbeta",((t,n)=>{this.once("_promiseR9kbeta",(s=>{s?n(s):t([e])}))}))}function Ul(e){return e=jl.channel(e),this._sendCommand(null,e,"/r9kbetaoff",((t,n)=>{this.once("_promiseR9kbetaoff",(s=>{s?n(s):t([e])}))}))}function Wl(e,t){return e=jl.channel(e),t=jl.get(t,300),this._sendCommand(null,e,`/slow ${t}`,((n,s)=>{this.once("_promiseSlow",(i=>{i?s(i):n([e,~~t])}))}))}function Hl(e){return e=jl.channel(e),this._sendCommand(null,e,"/slowoff",((t,n)=>{this.once("_promiseSlowoff",(s=>{s?n(s):t([e])}))}))}var Yl={action(e,t){return e=jl.channel(e),t=`ACTION ${t}`,this._sendMessage(this._getPromiseDelay(),e,t,((n,s)=>{n([e,t])}))},ban(e,t,n){return e=jl.channel(e),t=jl.username(t),n=jl.get(n,""),this._sendCommand(null,e,`/ban ${t} ${n}`,((s,i)=>{this.once("_promiseBan",(r=>{r?i(r):s([e,t,n])}))}))},clear(e){return e=jl.channel(e),this._sendCommand(null,e,"/clear",((t,n)=>{this.once("_promiseClear",(s=>{s?n(s):t([e])}))}))},color(e,t){return t=jl.get(t,e),this._sendCommand(null,"#tmijs",`/color ${t}`,((e,n)=>{this.once("_promiseColor",(s=>{s?n(s):e([t])}))}))},commercial(e,t){return e=jl.channel(e),t=jl.get(t,30),this._sendCommand(null,e,`/commercial ${t}`,((n,s)=>{this.once("_promiseCommercial",(i=>{i?s(i):n([e,~~t])}))}))},deletemessage(e,t){return e=jl.channel(e),this._sendCommand(null,e,`/delete ${t}`,((t,n)=>{this.once("_promiseDeletemessage",(s=>{s?n(s):t([e])}))}))},emoteonly(e){return e=jl.channel(e),this._sendCommand(null,e,"/emoteonly",((t,n)=>{this.once("_promiseEmoteonly",(s=>{s?n(s):t([e])}))}))},emoteonlyoff(e){return e=jl.channel(e),this._sendCommand(null,e,"/emoteonlyoff",((t,n)=>{this.once("_promiseEmoteonlyoff",(s=>{s?n(s):t([e])}))}))},followersonly:Gl,followersmode:Gl,followersonlyoff:Bl,followersmodeoff:Bl,host(e,t){return e=jl.channel(e),t=jl.username(t),this._sendCommand(2e3,e,`/host ${t}`,((n,s)=>{this.once("_promiseHost",((i,r)=>{i?s(i):n([e,t,~~r])}))}))},join(e){return e=jl.channel(e),this._sendCommand(void 0,null,`JOIN ${e}`,((t,n)=>{const s="_promiseJoin";let i=!1;const r=(o,a)=>{e===jl.channel(a)&&(this.removeListener(s,r),i=!0,o?n(o):t([e]))};this.on(s,r);const o=this._getPromiseDelay();jl.promiseDelay(o).then((()=>{i||this.emit(s,"No response from Twitch.",e)}))}))},mod(e,t){return e=jl.channel(e),t=jl.username(t),this._sendCommand(null,e,`/mod ${t}`,((n,s)=>{this.once("_promiseMod",(i=>{i?s(i):n([e,t])}))}))},mods(e){return e=jl.channel(e),this._sendCommand(null,e,"/mods",((t,n)=>{this.once("_promiseMods",((s,i)=>{s?n(s):(i.forEach((t=>{this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].includes(t)||this.moderators[e].push(t)})),t(i))}))}))},part:Fl,leave:Fl,ping(){return this._sendCommand(null,null,"PING",((e,t)=>{this.latency=new Date,this.pingTimeout=setTimeout((()=>{null!==this.ws&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout))}),jl.get(this.opts.connection.timeout,9999)),this.once("_promisePing",(t=>e([parseFloat(t)])))}))},r9kbeta:ql,r9kmode:ql,r9kbetaoff:Ul,r9kmodeoff:Ul,raw(e){return this._sendCommand(null,null,e,((t,n)=>{t([e])}))},say(e,t){return e=jl.channel(e),t.startsWith(".")&&!t.startsWith("..")||t.startsWith("/")||t.startsWith("\\")?"me "===t.substr(1,3)?this.action(e,t.substr(4)):this._sendCommand(null,e,t,((n,s)=>{n([e,t])})):this._sendMessage(this._getPromiseDelay(),e,t,((n,s)=>{n([e,t])}))},slow:Wl,slowmode:Wl,slowoff:Hl,slowmodeoff:Hl,subscribers(e){return e=jl.channel(e),this._sendCommand(null,e,"/subscribers",((t,n)=>{this.once("_promiseSubscribers",(s=>{s?n(s):t([e])}))}))},subscribersoff(e){return e=jl.channel(e),this._sendCommand(null,e,"/subscribersoff",((t,n)=>{this.once("_promiseSubscribersoff",(s=>{s?n(s):t([e])}))}))},timeout(e,t,n,s){return e=jl.channel(e),t=jl.username(t),null===n||jl.isInteger(n)||(s=n,n=300),n=jl.get(n,300),s=jl.get(s,""),this._sendCommand(null,e,`/timeout ${t} ${n} ${s}`,((i,r)=>{this.once("_promiseTimeout",(o=>{o?r(o):i([e,t,~~n,s])}))}))},unban(e,t){return e=jl.channel(e),t=jl.username(t),this._sendCommand(null,e,`/unban ${t}`,((n,s)=>{this.once("_promiseUnban",(i=>{i?s(i):n([e,t])}))}))},unhost(e){return e=jl.channel(e),this._sendCommand(2e3,e,"/unhost",((t,n)=>{this.once("_promiseUnhost",(s=>{s?n(s):t([e])}))}))},unmod(e,t){return e=jl.channel(e),t=jl.username(t),this._sendCommand(null,e,`/unmod ${t}`,((n,s)=>{this.once("_promiseUnmod",(i=>{i?s(i):n([e,t])}))}))},unvip(e,t){return e=jl.channel(e),t=jl.username(t),this._sendCommand(null,e,`/unvip ${t}`,((n,s)=>{this.once("_promiseUnvip",(i=>{i?s(i):n([e,t])}))}))},vip(e,t){return e=jl.channel(e),t=jl.username(t),this._sendCommand(null,e,`/vip ${t}`,((n,s)=>{this.once("_promiseVip",(i=>{i?s(i):n([e,t])}))}))},vips(e){return e=jl.channel(e),this._sendCommand(null,e,"/vips",((e,t)=>{this.once("_promiseVips",((n,s)=>{n?t(n):e(s)}))}))},whisper(e,t){return(e=jl.username(e))===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(null,"#tmijs",`/w ${e} ${t}`,((e,t)=>{this.once("_promiseWhisper",(e=>{e&&t(e)}))})).catch((n=>{if(n&&"string"==typeof n&&0!==n.indexOf("No response from Twitch."))throw n;const s=jl.channel(e),i=Object.assign({"message-type":"whisper","message-id":null,"thread-id":null,username:this.getUsername()},this.globaluserstate);return this.emits(["whisper","message"],[[s,i,t,!0],[s,i,t,!0]]),[e,t]}))}};function zl(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var Xl=zl;function Zl(e){return"function"==typeof e}function Jl(e){return"object"==typeof e&&null!==e}function Kl(e){return void 0===e}zl.EventEmitter=zl,zl.prototype._events=void 0,zl.prototype._maxListeners=void 0,zl.defaultMaxListeners=10,zl.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},zl.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||Jl(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(Kl(n=this._events[e]))return!1;if(Zl(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(Jl(n))for(i=Array.prototype.slice.call(arguments,1),s=(o=n.slice()).length,r=0;r<s;r++)o[r].apply(this,i);return!0},zl.prototype.addListener=function(e,t){var n;if(!Zl(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,Zl(t.listener)?t.listener:t),this._events[e]?Jl(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,Jl(this._events[e])&&!this._events[e].warned&&(n=Kl(this._maxListeners)?zl.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},zl.prototype.on=zl.prototype.addListener,zl.prototype.once=function(e,t){if(!Zl(t))throw TypeError("listener must be a function");var n=!1;if(this._events.hasOwnProperty(e)&&"_"===e.charAt(0)){var s=1,i=e;for(var r in this._events)this._events.hasOwnProperty(r)&&r.startsWith(i)&&s++;e+=s}function o(){"_"!==e.charAt(0)||isNaN(e.substr(e.length-1))||(e=e.substring(0,e.length-1)),this.removeListener(e,o),n||(n=!0,t.apply(this,arguments))}return o.listener=t,this.on(e,o),this},zl.prototype.removeListener=function(e,t){var n,s,i,r;if(!Zl(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=(n=this._events[e]).length,s=-1,n===t||Zl(n.listener)&&n.listener===t){if(delete this._events[e],this._events.hasOwnProperty(e+"2")&&"_"===e.charAt(0)){var o=e;for(var a in this._events)this._events.hasOwnProperty(a)&&a.startsWith(o)&&(isNaN(parseInt(a.substr(a.length-1)))||(this._events[e+parseInt(a.substr(a.length-1)-1)]=this._events[a],delete this._events[a]));this._events[e]=this._events[e+"1"],delete this._events[e+"1"]}this._events.removeListener&&this.emit("removeListener",e,t)}else if(Jl(n)){for(r=i;r-- >0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},zl.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(Zl(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},zl.prototype.listeners=function(e){return this._events&&this._events[e]?Zl(this._events[e])?[this._events[e]]:this._events[e].slice():[]},zl.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(Zl(t))return 1;if(t)return t.length}return 0},zl.listenerCount=function(e,t){return e.listenerCount(t)};const Ql=Sl.exports;let eu="info";const tu={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function nu(e){return function(t){tu[e]>=tu[eu]&&console.log(`[${Ql.formatDate(new Date)}] ${e}: ${t}`)}}var su={setLevel(e){eu=e},trace:nu("trace"),debug:nu("debug"),info:nu("info"),warn:nu("warn"),error:nu("error"),fatal:nu("fatal")};const iu=Sl.exports,ru=/\S+/g;function ou(e,t,n=",",s="/",i){const r=e[t];if(void 0===r)return e;const o="string"==typeof r;if(e[t+"-raw"]=o?r:null,!0===r)return e[t]=null,e;if(e[t]={},o){const o=r.split(n);for(let n=0;n<o.length;n++){const r=o[n].split(s);let a=r[1];void 0!==i&&a&&(a=a.split(i)),e[t][r[0]]=a||null}}return e}var au={badges:e=>ou(e,"badges"),badgeInfo:e=>ou(e,"badge-info"),emotes:e=>ou(e,"emotes","/",":",","),emoteRegex(e,t,n,s){ru.lastIndex=0;const i=new RegExp("(\\b|^|\\s)"+iu.unescapeHtml(t)+"(\\b|$|\\s)");let r;for(;null!==(r=ru.exec(e));)i.test(r[0])&&(s[n]=s[n]||[],s[n].push([r.index,ru.lastIndex-1]))},emoteString(e,t,n,s){let i;for(ru.lastIndex=0;null!==(i=ru.exec(e));)i[0]===iu.unescapeHtml(t)&&(s[n]=s[n]||[],s[n].push([i.index,ru.lastIndex-1]))},transformEmotes(e){let t="";return Object.keys(e).forEach((n=>{t=`${t+n}:`,e[n].forEach((e=>t=`${t+e.join("-")},`)),t=`${t.slice(0,-1)}/`})),t.slice(0,-1)},formTags(e){const t=[];for(const n in e){const s=iu.escapeIRC(e[n]);t.push(`${n}=${s}`)}return`@${t.join(";")}`},msg(e){const t={raw:e,tags:{},prefix:null,command:null,params:[]};let n=0,s=0;if(64===e.charCodeAt(0)){if(s=e.indexOf(" "),-1===s)return null;const i=e.slice(1,s).split(";");for(let e=0;e<i.length;e++){const n=i[e],s=n.split("=");t.tags[s[0]]=n.substring(n.indexOf("=")+1)||!0}n=s+1}for(;32===e.charCodeAt(n);)n++;if(58===e.charCodeAt(n)){if(s=e.indexOf(" ",n),-1===s)return null;for(t.prefix=e.slice(n+1,s),n=s+1;32===e.charCodeAt(n);)n++}if(s=e.indexOf(" ",n),-1===s)return e.length>n?(t.command=e.slice(n),t):null;for(t.command=e.slice(n,s),n=s+1;32===e.charCodeAt(n);)n++;for(;n<e.length;){if(s=e.indexOf(" ",n),58===e.charCodeAt(n)){t.params.push(e.slice(n+1));break}if(-1===s){if(-1===s){t.params.push(e.slice(n));break}}else for(t.params.push(e.slice(n,s)),n=s+1;32===e.charCodeAt(n);)n++}return t}};var cu=class{constructor(e){this.queue=[],this.index=0,this.defaultDelay=void 0===e?3e3:e}add(e,t){this.queue.push({fn:e,delay:t})}next(){const e=this.index++,t=this.queue[e];if(!t)return;const n=this.queue[this.index];if(t.fn(),n){const e=void 0===n.delay?this.defaultDelay:n.delay;setTimeout((()=>this.next()),e)}}};!function(e){const t=void 0!==tt?tt:"undefined"!=typeof window?window:{},n=t.WebSocket||Al,s=t.fetch||Al,i=Vl,r=Yl,o=Xl.EventEmitter,a=su,c=au,l=cu,u=Sl.exports;let h=!1;const p=function e(t){if(this instanceof e==!1)return new e(t);this.opts=u.get(t,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=u.get(this.opts.options.clientId,null),this._globalDefaultChannel=u.channel(u.get(this.opts.options.globalDefaultChannel,"#tmijs")),this._skipMembership=u.get(this.opts.options.skipMembership,!1),this._skipUpdatingEmotesets=u.get(this.opts.options.skipUpdatingEmotesets,!1),this._updateEmotesetsTimer=null,this._updateEmotesetsTimerDelay=u.get(this.opts.options.updateEmotesetsTimer,6e4),this.maxReconnectAttempts=u.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=u.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=u.get(this.opts.connection.reconnect,!0),this.reconnectDecay=u.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=u.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=u.get(this.opts.connection.secure,!this.opts.connection.server&&!this.opts.connection.port),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;let n="error";this.opts.options.debug&&(n="info"),this.log=this.opts.logger||a;try{a.setLevel(n)}catch(e){}this.opts.channels.forEach(((e,t,n)=>n[t]=u.channel(e))),o.call(this),this.setMaxListeners(0)};u.inherits(p,o);for(const e in r)p.prototype[e]=r[e];p.prototype.emits=function(e,t){for(let n=0;n<e.length;n++){const s=n<t.length?t[n]:t[t.length-1];this.emit.apply(this,[e[n]].concat(s))}},p.prototype.api=function(...e){h||(this.log.warn("Client.prototype.api is deprecated and will be removed for version 2.0.0"),h=!0),i(...e)},p.prototype.handleMessage=function(e){if(!e)return;this.listenerCount("raw_message")&&this.emit("raw_message",JSON.parse(JSON.stringify(e)),e);const t=u.channel(u.get(e.params[0],null));let n=u.get(e.params[1],null);const s=u.get(e.tags["msg-id"],null),i=e.tags=c.badges(c.badgeInfo(c.emotes(e.tags)));for(const e in i){if("emote-sets"===e||"ban-duration"===e||"bits"===e)continue;let t=i[e];"boolean"==typeof t?t=null:"1"===t?t=!0:"0"===t?t=!1:"string"==typeof t&&(t=u.unescapeIRC(t)),i[e]=t}if(null===e.prefix)switch(e.command){case"PING":this.emit("ping"),this._isConnected()&&this.ws.send("PONG");break;case"PONG":{const e=new Date;this.currentLatency=(e.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break}default:this.log.warn(`Could not parse message with no prefix:\n${JSON.stringify(e,null,4)}`)}else if("tmi.twitch.tv"===e.prefix)switch(e.command){case"002":case"003":case"004":case"372":case"375":case"CAP":case"SERVERCHANGE":break;case"001":this.username=e.params[0];break;case"376":{this.log.info("Connected to server."),this.userstate[this._globalDefaultChannel]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval((()=>{this._isConnected()&&this.ws.send("PING"),this.latency=new Date,this.pingTimeout=setTimeout((()=>{null!==this.ws&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer))}),u.get(this.opts.connection.timeout,9999))}),6e4);let e=u.get(this.opts.options.joinInterval,2e3);e<300&&(e=300);const t=new l(e),n=[...new Set([...this.opts.channels,...this.channels])];this.channels=[];for(let e=0;e<n.length;e++){const s=n[e];t.add((()=>{this._isConnected()&&this.join(s).catch((e=>this.log.error(e)))}))}t.next();break}case"NOTICE":{const i=[null],r=[t,s,n],o=[t,!0],a=[t,!1],c=[r,i],l=[r,[s]],u=`[${t}] ${n}`;switch(s){case"subs_on":this.log.info(`[${t}] This room is now in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribers"],[o,o,i]);break;case"subs_off":this.log.info(`[${t}] This room is no longer in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[a,a,i]);break;case"emote_only_on":this.log.info(`[${t}] This room is now in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonly"],[o,i]);break;case"emote_only_off":this.log.info(`[${t}] This room is no longer in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonlyoff"],[a,i]);break;case"slow_on":case"slow_off":case"followers_on_zero":case"followers_on":case"followers_off":case"host_on":case"host_off":break;case"r9k_on":this.log.info(`[${t}] This room is now in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[o,o,i]);break;case"r9k_off":this.log.info(`[${t}] This room is no longer in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[a,a,i]);break;case"room_mods":{const e=n.split(": "),s=(e.length>1?e[1]:"").toLowerCase().split(", ").filter((e=>e));this.emits(["_promiseMods","mods"],[[null,s],[t,s]]);break}case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[t,[]]]);break;case"vips_success":{n.endsWith(".")&&(n=n.slice(0,-1));const e=n.split(": "),s=(e.length>1?e[1]:"").toLowerCase().split(", ").filter((e=>e));this.emits(["_promiseVips","vips"],[[null,s],[t,s]]);break}case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[t,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_anon":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(u),this.emits(["notice","_promiseBan"],l);break;case"ban_success":this.log.info(u),this.emits(["notice","_promiseBan"],c);break;case"usage_clear":this.log.info(u),this.emits(["notice","_promiseClear"],l);break;case"usage_mods":this.log.info(u),this.emits(["notice","_promiseMods"],[r,[s,[]]]);break;case"mod_success":this.log.info(u),this.emits(["notice","_promiseMod"],c);break;case"usage_vips":this.log.info(u),this.emits(["notice","_promiseVips"],[r,[s,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_max_vips_reached":case"bad_vip_achievement_incomplete":this.log.info(u),this.emits(["notice","_promiseVip"],[r,[s,[]]]);break;case"vip_success":this.log.info(u),this.emits(["notice","_promiseVip"],c);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(u),this.emits(["notice","_promiseMod"],l);break;case"unmod_success":this.log.info(u),this.emits(["notice","_promiseUnmod"],c);break;case"unvip_success":this.log.info(u),this.emits(["notice","_promiseUnvip"],c);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(u),this.emits(["notice","_promiseUnmod"],l);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(u),this.emits(["notice","_promiseUnvip"],l);break;case"color_changed":this.log.info(u),this.emits(["notice","_promiseColor"],c);break;case"usage_color":case"turbo_only_color":this.log.info(u),this.emits(["notice","_promiseColor"],l);break;case"commercial_success":this.log.info(u),this.emits(["notice","_promiseCommercial"],c);break;case"usage_commercial":case"bad_commercial_error":this.log.info(u),this.emits(["notice","_promiseCommercial"],l);break;case"hosts_remaining":{this.log.info(u);const e=isNaN(n[0])?0:parseInt(n[0]);this.emits(["notice","_promiseHost"],[r,[null,~~e]]);break}case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(u),this.emits(["notice","_promiseHost"],[r,[s,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(u),this.emits(["notice","_promiseR9kbeta"],l);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(u),this.emits(["notice","_promiseR9kbetaoff"],l);break;case"timeout_success":this.log.info(u),this.emits(["notice","_promiseTimeout"],c);break;case"delete_message_success":this.log.info(`[${t} ${n}]`),this.emits(["notice","_promiseDeletemessage"],c);break;case"already_subs_off":case"usage_subs_off":this.log.info(u),this.emits(["notice","_promiseSubscribersoff"],l);break;case"already_subs_on":case"usage_subs_on":this.log.info(u),this.emits(["notice","_promiseSubscribers"],l);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(u),this.emits(["notice","_promiseEmoteonlyoff"],l);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(u),this.emits(["notice","_promiseEmoteonly"],l);break;case"usage_slow_on":this.log.info(u),this.emits(["notice","_promiseSlow"],l);break;case"usage_slow_off":this.log.info(u),this.emits(["notice","_promiseSlowoff"],l);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_anon":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(u),this.emits(["notice","_promiseTimeout"],l);break;case"untimeout_success":case"unban_success":this.log.info(u),this.emits(["notice","_promiseUnban"],c);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(u),this.emits(["notice","_promiseUnban"],l);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(u),this.emits(["notice","_promiseDeletemessage"],l);break;case"usage_unhost":case"not_hosting":this.log.info(u),this.emits(["notice","_promiseUnhost"],l);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(u),this.emits(["notice","_promiseWhisper"],l);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":case"invalid_user":this.log.info(u),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff","_promiseWhisper"],[r,[s,t]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(u),this.emit("automod",t,s,n);break;case"unrecognized_cmd":case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":case"unavailable_command":this.log.info(u),this.emit("notice",t,s,n);break;default:n.includes("Login unsuccessful")||n.includes("Login authentication failed")||n.includes("Error logging in")||n.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=n,this.log.error(this.reason),this.ws.close()):n.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn(`Could not parse NOTICE from tmi.twitch.tv:\n${JSON.stringify(e,null,4)}`),this.emit("notice",t,s,n))}break}case"USERNOTICE":{const e=i["display-name"]||i.login,r=i["msg-param-sub-plan"]||"",o=u.unescapeIRC(u.get(i["msg-param-sub-plan-name"],""))||null,a={prime:r.includes("Prime"),plan:r,planName:o},c=~~(i["msg-param-streak-months"]||0),l=i["msg-param-recipient-display-name"]||i["msg-param-recipient-user-name"],h=~~i["msg-param-mass-gift-count"];switch(i["message-type"]=s,s){case"resub":this.emits(["resub","subanniversary"],[[t,e,c,n,i,a]]);break;case"sub":this.emits(["subscription","sub"],[[t,e,a,n,i]]);break;case"subgift":this.emit("subgift",t,e,c,l,a,i);break;case"anonsubgift":this.emit("anonsubgift",t,c,l,a,i);break;case"submysterygift":this.emit("submysterygift",t,e,h,a,i);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",t,h,a,i);break;case"primepaidupgrade":this.emit("primepaidupgrade",t,e,a,i);break;case"giftpaidupgrade":{const n=i["msg-param-sender-name"]||i["msg-param-sender-login"];this.emit("giftpaidupgrade",t,e,n,i);break}case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",t,e,i);break;case"raid":{const e=i["msg-param-displayName"]||i["msg-param-login"],n=+i["msg-param-viewerCount"];this.emit("raided",t,e,n,i);break}case"ritual":{const s=i["msg-param-ritual-name"];if("new_chatter"===s)this.emit("newchatter",t,e,i,n);else this.emit("ritual",s,t,e,i,n);break}default:this.emit("usernotice",s,t,i,n)}break}case"HOSTTARGET":{const e=n.split(" "),s=~~e[1]||0;"-"===e[0]?(this.log.info(`[${t}] Exited host mode.`),this.emits(["unhost","_promiseUnhost"],[[t,s],[null]])):(this.log.info(`[${t}] Now hosting ${e[0]} for ${s} viewer(s).`),this.emit("hosting",t,e[0],s));break}case"CLEARCHAT":if(e.params.length>1){const s=u.get(e.tags["ban-duration"],null);null===s?(this.log.info(`[${t}] ${n} has been banned.`),this.emit("ban",t,n,null,e.tags)):(this.log.info(`[${t}] ${n} has been timed out for ${s} seconds.`),this.emit("timeout",t,n,null,~~s,e.tags))}else this.log.info(`[${t}] Chat was cleared by a moderator.`),this.emits(["clearchat","_promiseClear"],[[t],[null]]);break;case"CLEARMSG":if(e.params.length>1){const e=n,s=i.login;i["message-type"]="messagedeleted",this.log.info(`[${t}] ${s}'s message has been deleted.`),this.emit("messagedeleted",t,s,e,i)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info(`Disconnecting and reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.disconnect().catch((e=>this.log.error(e))),setTimeout((()=>this.connect().catch((e=>this.log.error(e)))),this.reconnectTimer);break;case"USERSTATE":e.tags.username=this.username,"mod"===e.tags["user-type"]&&(this.moderators[t]||(this.moderators[t]=[]),this.moderators[t].includes(this.username)||this.moderators[t].push(this.username)),u.isJustinfan(this.getUsername())||this.userstate[t]||(this.userstate[t]=i,this.lastJoined=t,this.channels.push(t),this.log.info(`Joined ${t}`),this.emit("join",t,u.username(this.getUsername()),!0)),e.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(e.tags["emote-sets"]),this.userstate[t]=i;break;case"GLOBALUSERSTATE":this.globaluserstate=i,this.emit("globaluserstate",i),void 0!==e.tags["emote-sets"]&&this._updateEmoteset(e.tags["emote-sets"]);break;case"ROOMSTATE":if(u.channel(this.lastJoined)===t&&this.emit("_promiseJoin",null,t),e.tags.channel=t,this.emit("roomstate",t,e.tags),!u.hasOwn(e.tags,"subs-only")){if(u.hasOwn(e.tags,"slow"))if("boolean"!=typeof e.tags.slow||e.tags.slow){const n=[t,!0,~~e.tags.slow];this.log.info(`[${t}] This room is now in slow mode.`),this.emits(["slow","slowmode","_promiseSlow"],[n,n,[null]])}else{const e=[t,!1,0];this.log.info(`[${t}] This room is no longer in slow mode.`),this.emits(["slow","slowmode","_promiseSlowoff"],[e,e,[null]])}if(u.hasOwn(e.tags,"followers-only"))if("-1"===e.tags["followers-only"]){const e=[t,!1,0];this.log.info(`[${t}] This room is no longer in followers-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[e,e,[null]])}else{const n=[t,!0,~~e.tags["followers-only"]];this.log.info(`[${t}] This room is now in follower-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowers"],[n,n,[null]])}}break;default:this.log.warn(`Could not parse message from tmi.twitch.tv:\n${JSON.stringify(e,null,4)}`)}else if("jtv"===e.prefix)if("MODE"===e.command)"+o"===n?(this.moderators[t]||(this.moderators[t]=[]),this.moderators[t].includes(e.params[2])||this.moderators[t].push(e.params[2]),this.emit("mod",t,e.params[2])):"-o"===n&&(this.moderators[t]||(this.moderators[t]=[]),this.moderators[t].filter((t=>t!==e.params[2])),this.emit("unmod",t,e.params[2]));else this.log.warn(`Could not parse message from jtv:\n${JSON.stringify(e,null,4)}`);else switch(e.command){case"353":this.emit("names",e.params[2],e.params[3].split(" "));break;case"366":break;case"JOIN":{const n=e.prefix.split("!")[0];u.isJustinfan(this.getUsername())&&this.username===n&&(this.lastJoined=t,this.channels.push(t),this.log.info(`Joined ${t}`),this.emit("join",t,n,!0)),this.username!==n&&this.emit("join",t,n,!1);break}case"PART":{let n=!1;const s=e.prefix.split("!")[0];if(this.username===s){n=!0,this.userstate[t]&&delete this.userstate[t];let e=this.channels.indexOf(t);-1!==e&&this.channels.splice(e,1),e=this.opts.channels.indexOf(t),-1!==e&&this.opts.channels.splice(e,1),this.log.info(`Left ${t}`),this.emit("_promisePart",null)}this.emit("part",t,s,n);break}case"WHISPER":{const t=e.prefix.split("!")[0];this.log.info(`[WHISPER] <${t}>: ${n}`),u.hasOwn(e.tags,"username")||(e.tags.username=t),e.tags["message-type"]="whisper";const s=u.channel(e.tags.username);this.emits(["whisper","message"],[[s,e.tags,n,!1]]);break}case"PRIVMSG":if(e.tags.username=e.prefix.split("!")[0],"jtv"===e.tags.username){const e=u.username(n.split(" ")[0]),s=n.includes("auto");if(n.includes("hosting you for")){const i=u.extractNumber(n);this.emit("hosted",t,e,i,s)}else n.includes("hosting you")&&this.emit("hosted",t,e,0,s)}else{const s=u.get(this.opts.options.messagesLogLevel,"info"),i=u.actionMessage(n);if(e.tags["message-type"]=i?"action":"chat",n=i?i[1]:n,u.hasOwn(e.tags,"bits"))this.emit("cheer",t,e.tags,n);else{if(u.hasOwn(e.tags,"msg-id")){if("highlighted-message"===e.tags["msg-id"]){const s=e.tags["msg-id"];this.emit("redeem",t,e.tags.username,s,e.tags,n)}else if("skip-subs-mode-message"===e.tags["msg-id"]){const s=e.tags["msg-id"];this.emit("redeem",t,e.tags.username,s,e.tags,n)}}else if(u.hasOwn(e.tags,"custom-reward-id")){const s=e.tags["custom-reward-id"];this.emit("redeem",t,e.tags.username,s,e.tags,n)}i?(this.log[s](`[${t}] *<${e.tags.username}>: ${n}`),this.emits(["action","message"],[[t,e.tags,n,!1]])):(this.log[s](`[${t}] <${e.tags.username}>: ${n}`),this.emits(["chat","message"],[[t,e.tags,n,!1]]))}}break;default:this.log.warn(`Could not parse message:\n${JSON.stringify(e,null,4)}`)}},p.prototype.connect=function(){return new Promise(((e,t)=>{this.server=u.get(this.opts.connection.server,"irc-ws.chat.twitch.tv"),this.port=u.get(this.opts.connection.port,80),this.secure&&(this.port=443),443===this.port&&(this.secure=!0),this.reconnectTimer=this.reconnectTimer*this.reconnectDecay,this.reconnectTimer>=this.maxReconnectInterval&&(this.reconnectTimer=this.maxReconnectInterval),this._openConnection(),this.once("_promiseConnect",(n=>{n?t(n):e([this.server,~~this.port])}))}))},p.prototype._openConnection=function(){const e=`${this.secure?"wss":"ws"}://${this.server}:${this.port}/`,t={};"agent"in this.opts.connection&&(t.agent=this.opts.connection.agent),this.ws=new n(e,"irc",t),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},p.prototype._onOpen=function(){this._isConnected()&&(this.log.info(`Connecting to ${this.server} on port ${this.port}..`),this.emit("connecting",this.server,~~this.port),this.username=u.get(this.opts.identity.username,u.justinfan()),this._getToken().then((e=>{const t=u.password(e);this.log.info("Sending authentication to server.."),this.emit("logon");let n="twitch.tv/tags twitch.tv/commands";this._skipMembership||(n+=" twitch.tv/membership"),this.ws.send("CAP REQ :"+n),t?this.ws.send(`PASS ${t}`):u.isJustinfan(this.username)&&this.ws.send("PASS SCHMOOPIIE"),this.ws.send(`NICK ${this.username}`)})).catch((e=>{this.emits(["_promiseConnect","disconnected"],[[e],["Could not get a token."]])})))},p.prototype._getToken=function(){const e=this.opts.identity.password;let t;return"function"==typeof e?(t=e(),t instanceof Promise?t:Promise.resolve(t)):Promise.resolve(e)},p.prototype._onMessage=function(e){e.data.trim().split("\r\n").forEach((e=>{const t=c.msg(e);t&&this.handleMessage(t)}))},p.prototype._onError=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.reason=null===this.ws?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout((()=>{this.reconnecting=!1,this.connect().catch((e=>this.log.error(e)))}),this.reconnectTimer)),this.ws=null},p.prototype._onClose=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Could not connect to server. Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout((()=>{this.reconnecting=!1,this.connect().catch((e=>this.log.error(e)))}),this.reconnectTimer))),this.ws=null},p.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},p.prototype._sendCommand=function(e,t,n,s){return new Promise(((i,r)=>{if(!this._isConnected())return r("Not connected to server.");if(null!==e&&"number"!=typeof e||(null===e&&(e=this._getPromiseDelay()),u.promiseDelay(e).then((()=>r("No response from Twitch.")))),null!==t){const e=u.channel(t);this.log.info(`[${e}] Executing command: ${n}`),this.ws.send(`PRIVMSG ${e} :${n}`)}else this.log.info(`Executing command: ${n}`),this.ws.send(n);"function"==typeof s?s(i,r):i()}))},p.prototype._sendMessage=function(e,t,n,s){return new Promise(((i,r)=>{if(!this._isConnected())return r("Not connected to server.");if(u.isJustinfan(this.getUsername()))return r("Cannot send anonymous messages.");const o=u.channel(t);if(this.userstate[o]||(this.userstate[o]={}),n.length>=500){const s=u.splitLine(n,500);n=s[0],setTimeout((()=>{this._sendMessage(e,t,s[1],(()=>{}))}),350)}this.ws.send(`PRIVMSG ${o} :${n}`);const a={};Object.keys(this.emotesets).forEach((e=>this.emotesets[e].forEach((e=>(u.isRegex(e.code)?c.emoteRegex:c.emoteString)(n,e.code,e.id,a)))));const l=Object.assign(this.userstate[o],c.emotes({emotes:c.transformEmotes(a)||null})),h=u.get(this.opts.options.messagesLogLevel,"info"),p=u.actionMessage(n);p?(l["message-type"]="action",this.log[h](`[${o}] *<${this.getUsername()}>: ${p[1]}`),this.emits(["action","message"],[[o,l,p[1],!0]])):(l["message-type"]="chat",this.log[h](`[${o}] <${this.getUsername()}>: ${n}`),this.emits(["chat","message"],[[o,l,n,!0]])),"function"==typeof s?s(i,r):i()}))},p.prototype._updateEmoteset=function(e){let t=void 0!==e;if(t&&(e===this.emotes?t=!1:this.emotes=e),this._skipUpdatingEmotesets)return void(t&&this.emit("emotesets",e,{}));const n=()=>{this._updateEmotesetsTimerDelay>0&&(clearTimeout(this._updateEmotesetsTimer),this._updateEmotesetsTimer=setTimeout((()=>this._updateEmoteset(e)),this._updateEmotesetsTimerDelay))};this._getToken().then((t=>{const n=`https://api.twitch.tv/kraken/chat/emoticon_images?emotesets=${e}`,i={};return"fetchAgent"in this.opts.connection&&(i.agent=this.opts.connection.fetchAgent),s(n,{...i,headers:{Accept:"application/vnd.twitchtv.v5+json",Authorization:`OAuth ${u.token(t)}`,"Client-ID":this.clientId}})})).then((e=>e.json())).then((t=>{this.emotesets=t.emoticon_sets||{},this.emit("emotesets",e,this.emotesets),n()})).catch((()=>n()))},p.prototype.getUsername=function(){return this.username},p.prototype.getOptions=function(){return this.opts},p.prototype.getChannels=function(){return this.channels},p.prototype.isMod=function(e,t){const n=u.channel(e);return this.moderators[n]||(this.moderators[n]=[]),this.moderators[n].includes(u.username(t))},p.prototype.readyState=function(){return null===this.ws?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},p.prototype._isConnected=function(){return null!==this.ws&&1===this.ws.readyState},p.prototype.disconnect=function(){return new Promise(((e,t)=>{null!==this.ws&&3!==this.ws.readyState?(this.wasCloseCalled=!0,this.log.info("Disconnecting from server.."),this.ws.close(),this.once("_promiseDisconnect",(()=>e([this.server,~~this.port])))):(this.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),t("Cannot disconnect from server. Socket is not opened or connection is already closing."))}))},p.prototype.off=p.prototype.removeListener,e.exports&&(e.exports=p),"undefined"!=typeof window&&(window.tmi={client:p,Client:p})}(Tl);const lu=Tl.exports;var uu={client:lu,Client:lu};class hu extends J{constructor(e,t){super(),this.player=e,this.message=t,this.eventType=Z.PLAYER_MESSAGE}}const pu="No Twitch Client Set";const du=e=>`Channel is undefined. Can't send player message: ${e}`,mu=(e,t)=>`Twitch client connecting on ${e}:${t} ...`,fu="Client not connected.",gu=(e,t)=>`Twitch client connected on ${e}:${t}.`,_u="Twitch client message",vu="Twitch client disconnecting ...",yu="Twitch client disconnected.",wu=e=>`@${e.player.username} >>> ${e.message}`,bu=(e,t)=>`${t} joint channel '${e}'.`,xu=(e,t)=>`${t} leave channel '${e}'.`;const Cu="Tone is not ready",Tu=e=>`Tone sound buffer ${e.type} is not loaded.`,Au=e=>`Tone music buffer ${e.supportedMusic} is not loaded.`,Su=e=>`Missing sound ${e.type} on sound assets.`,Eu=e=>`Missing music ${e.supportedMusic} on sound assets.`;var Ou={exports:{}},ku=function(e,t){return function(){for(var n=new Array(arguments.length),s=0;s<n.length;s++)n[s]=arguments[s];return e.apply(t,n)}},Pu=ku,$u=Object.prototype.toString;function Mu(e){return Array.isArray(e)}function Ru(e){return void 0===e}function Nu(e){return"[object ArrayBuffer]"===$u.call(e)}function Iu(e){return null!==e&&"object"==typeof e}function Lu(e){if("[object Object]"!==$u.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function Du(e){return"[object Function]"===$u.call(e)}function Vu(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),Mu(e))for(var n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var ju={isArray:Mu,isArrayBuffer:Nu,isBuffer:function(e){return null!==e&&!Ru(e)&&null!==e.constructor&&!Ru(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===$u.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Nu(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:Iu,isPlainObject:Lu,isUndefined:Ru,isDate:function(e){return"[object Date]"===$u.call(e)},isFile:function(e){return"[object File]"===$u.call(e)},isBlob:function(e){return"[object Blob]"===$u.call(e)},isFunction:Du,isStream:function(e){return Iu(e)&&Du(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===$u.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:Vu,merge:function e(){var t={};function n(n,s){Lu(t[s])&&Lu(n)?t[s]=e(t[s],n):Lu(n)?t[s]=e({},n):Mu(n)?t[s]=n.slice():t[s]=n}for(var s=0,i=arguments.length;s<i;s++)Vu(arguments[s],n);return t},extend:function(e,t,n){return Vu(t,(function(t,s){e[s]=n&&"function"==typeof t?Pu(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}},Gu=ju;function Bu(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Fu=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(Gu.isURLSearchParams(t))s=t.toString();else{var i=[];Gu.forEach(t,(function(e,t){null!=e&&(Gu.isArray(e)?t+="[]":e=[e],Gu.forEach(e,(function(e){Gu.isDate(e)?e=e.toISOString():Gu.isObject(e)&&(e=JSON.stringify(e)),i.push(Bu(t)+"="+Bu(e))})))})),s=i.join("&")}if(s){var r=e.indexOf("#");-1!==r&&(e=e.slice(0,r)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e},qu=ju;function Uu(){this.handlers=[]}Uu.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},Uu.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Uu.prototype.forEach=function(e){qu.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var Wu=Uu,Hu=ju,Yu=function(e,t,n,s,i){return e.config=t,n&&(e.code=n),e.request=s,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},zu=Yu,Xu=function(e,t,n,s,i){var r=new Error(e);return zu(r,t,n,s,i)},Zu=Xu,Ju=ju,Ku=Ju.isStandardBrowserEnv()?{write:function(e,t,n,s,i,r){var o=[];o.push(e+"="+encodeURIComponent(t)),Ju.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Ju.isString(s)&&o.push("path="+s),Ju.isString(i)&&o.push("domain="+i),!0===r&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Qu=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},eh=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},th=ju,nh=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],sh=ju,ih=sh.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function s(e){var s=e;return t&&(n.setAttribute("href",s),s=n.href),n.setAttribute("href",s),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=s(window.location.href),function(t){var n=sh.isString(t)?s(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0};function rh(e){this.message=e}rh.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},rh.prototype.__CANCEL__=!0;var oh=rh,ah=ju,ch=function(e,t,n){var s=n.config.validateStatus;n.status&&s&&!s(n.status)?t(Zu("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)},lh=Ku,uh=Fu,hh=function(e,t){return e&&!Qu(t)?eh(e,t):t},ph=function(e){var t,n,s,i={};return e?(th.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=th.trim(e.substr(0,s)).toLowerCase(),n=th.trim(e.substr(s+1)),t){if(i[t]&&nh.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}})),i):i},dh=ih,mh=Xu,fh=Ah,gh=oh,_h=function(e){return new Promise((function(t,n){var s,i=e.data,r=e.headers,o=e.responseType;function a(){e.cancelToken&&e.cancelToken.unsubscribe(s),e.signal&&e.signal.removeEventListener("abort",s)}ah.isFormData(i)&&delete r["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var l=e.auth.username||"",u=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";r.Authorization="Basic "+btoa(l+":"+u)}var h=hh(e.baseURL,e.url);function p(){if(c){var s="getAllResponseHeaders"in c?ph(c.getAllResponseHeaders()):null,i={data:o&&"text"!==o&&"json"!==o?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:s,config:e,request:c};ch((function(e){t(e),a()}),(function(e){n(e),a()}),i),c=null}}if(c.open(e.method.toUpperCase(),uh(h,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=p:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(p)},c.onabort=function(){c&&(n(mh("Request aborted",e,"ECONNABORTED",c)),c=null)},c.onerror=function(){n(mh("Network Error",e,null,c)),c=null},c.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",s=e.transitional||fh.transitional;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(mh(t,e,s.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",c)),c=null},ah.isStandardBrowserEnv()){var d=(e.withCredentials||dh(h))&&e.xsrfCookieName?lh.read(e.xsrfCookieName):void 0;d&&(r[e.xsrfHeaderName]=d)}"setRequestHeader"in c&&ah.forEach(r,(function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete r[t]:c.setRequestHeader(t,e)})),ah.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),o&&"json"!==o&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(s=function(e){c&&(n(!e||e&&e.type?new gh("canceled"):e),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(s),e.signal&&(e.signal.aborted?s():e.signal.addEventListener("abort",s))),i||(i=null),c.send(i)}))},vh=ju,yh=function(e,t){Hu.forEach(e,(function(n,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[s])}))},wh=Yu,bh={"Content-Type":"application/x-www-form-urlencoded"};function xh(e,t){!vh.isUndefined(e)&&vh.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Ch,Th={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Ch=_h),Ch),transformRequest:[function(e,t){return yh(t,"Accept"),yh(t,"Content-Type"),vh.isFormData(e)||vh.isArrayBuffer(e)||vh.isBuffer(e)||vh.isStream(e)||vh.isFile(e)||vh.isBlob(e)?e:vh.isArrayBufferView(e)?e.buffer:vh.isURLSearchParams(e)?(xh(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):vh.isObject(e)||t&&"application/json"===t["Content-Type"]?(xh(t,"application/json"),function(e,t,n){if(vh.isString(e))try{return(t||JSON.parse)(e),vh.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Th.transitional,n=t&&t.silentJSONParsing,s=t&&t.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||s&&vh.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw wh(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};vh.forEach(["delete","get","head"],(function(e){Th.headers[e]={}})),vh.forEach(["post","put","patch"],(function(e){Th.headers[e]=vh.merge(bh)}));var Ah=Th,Sh=ju,Eh=Ah,Oh=function(e){return!(!e||!e.__CANCEL__)},kh=ju,Ph=function(e,t,n){var s=this||Eh;return Sh.forEach(n,(function(n){e=n.call(s,e,t)})),e},$h=Oh,Mh=Ah,Rh=oh;function Nh(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Rh("canceled")}var Ih=ju,Lh=function(e,t){t=t||{};var n={};function s(e,t){return Ih.isPlainObject(e)&&Ih.isPlainObject(t)?Ih.merge(e,t):Ih.isPlainObject(t)?Ih.merge({},t):Ih.isArray(t)?t.slice():t}function i(n){return Ih.isUndefined(t[n])?Ih.isUndefined(e[n])?void 0:s(void 0,e[n]):s(e[n],t[n])}function r(e){if(!Ih.isUndefined(t[e]))return s(void 0,t[e])}function o(n){return Ih.isUndefined(t[n])?Ih.isUndefined(e[n])?void 0:s(void 0,e[n]):s(void 0,t[n])}function a(n){return n in t?s(e[n],t[n]):n in e?s(void 0,e[n]):void 0}var c={url:r,method:r,data:r,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a};return Ih.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,s=t(e);Ih.isUndefined(s)&&t!==a||(n[e]=s)})),n},Dh="0.25.0",Vh=Dh,jh={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){jh[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var Gh={};jh.transitional=function(e,t,n){function s(e,t){return"[Axios v"+Vh+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,r){if(!1===e)throw new Error(s(i," has been removed"+(t?" in "+t:"")));return t&&!Gh[i]&&(Gh[i]=!0,console.warn(s(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,r)}};var Bh={assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var s=Object.keys(e),i=s.length;i-- >0;){var r=s[i],o=t[r];if(o){var a=e[r],c=void 0===a||o(a,r,e);if(!0!==c)throw new TypeError("option "+r+" must be "+c)}else if(!0!==n)throw Error("Unknown option "+r)}},validators:jh},Fh=ju,qh=Fu,Uh=Wu,Wh=function(e){return Nh(e),e.headers=e.headers||{},e.data=Ph.call(e,e.data,e.headers,e.transformRequest),e.headers=kh.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),kh.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||Mh.adapter)(e).then((function(t){return Nh(e),t.data=Ph.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return $h(t)||(Nh(e),t&&t.response&&(t.response.data=Ph.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},Hh=Lh,Yh=Bh,zh=Yh.validators;function Xh(e){this.defaults=e,this.interceptors={request:new Uh,response:new Uh}}Xh.prototype.request=function(e,t){if("string"==typeof e?(t=t||{}).url=e:t=e||{},!t.url)throw new Error("Provided config url is not valid");(t=Hh(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&Yh.assertOptions(n,{silentJSONParsing:zh.transitional(zh.boolean),forcedJSONParsing:zh.transitional(zh.boolean),clarifyTimeoutError:zh.transitional(zh.boolean)},!1);var s=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));var r,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!i){var a=[Wh,void 0];for(Array.prototype.unshift.apply(a,s),a=a.concat(o),r=Promise.resolve(t);a.length;)r=r.then(a.shift(),a.shift());return r}for(var c=t;s.length;){var l=s.shift(),u=s.shift();try{c=l(c)}catch(e){u(e);break}}try{r=Wh(c)}catch(e){return Promise.reject(e)}for(;o.length;)r=r.then(o.shift(),o.shift());return r},Xh.prototype.getUri=function(e){if(!e.url)throw new Error("Provided config url is not valid");return e=Hh(this.defaults,e),qh(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},Fh.forEach(["delete","get","head","options"],(function(e){Xh.prototype[e]=function(t,n){return this.request(Hh(n||{},{method:e,url:t,data:(n||{}).data}))}})),Fh.forEach(["post","put","patch"],(function(e){Xh.prototype[e]=function(t,n,s){return this.request(Hh(s||{},{method:e,url:t,data:n}))}}));var Zh=Xh,Jh=oh;function Kh(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,s=n._listeners.length;for(t=0;t<s;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,s=new Promise((function(e){n.subscribe(e),t=e})).then(e);return s.cancel=function(){n.unsubscribe(t)},s},e((function(e){n.reason||(n.reason=new Jh(e),t(n.reason))}))}Kh.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Kh.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},Kh.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},Kh.source=function(){var e;return{token:new Kh((function(t){e=t})),cancel:e}};var Qh=Kh,ep=ju,tp=ju,np=ku,sp=Zh,ip=Lh;var rp=function e(t){var n=new sp(t),s=np(sp.prototype.request,n);return tp.extend(s,sp.prototype,n),tp.extend(s,n),s.create=function(n){return e(ip(t,n))},s}(Ah);rp.Axios=sp,rp.Cancel=oh,rp.CancelToken=Qh,rp.isCancel=Oh,rp.VERSION=Dh,rp.all=function(e){return Promise.all(e)},rp.spread=function(e){return function(t){return e.apply(null,t)}},rp.isAxiosError=function(e){return ep.isObject(e)&&!0===e.isAxiosError},Ou.exports=rp,Ou.exports.default=rp;var op,ap,cp=Ou.exports;!function(e){e.GLOBAL_CLEAVAGE_DRAWPILE_DRAW="/globalCleavageDrawPile/draw",e.GLOBAL_CLEAVAGE_DRAWPILE_SAVE="/globalCleavageDrawPile/save"}(op||(op={}));!function(e){e.TWITCHTOKEN="TWITCHTOKEN",e.TWITCHUSERNAME="TWITCHUSERNAME",e.TWITCHCHANNEL="TWITCHCHANNEL",e.GCP_PROJECT_ID="GCP_PROJECT_ID",e.GCP_CLIENT_EMAIL="GCP_CLIENT_EMAIL",e.GCP_PRIVATE_KEY="GCP_PRIVATE_KEY",e.BACKEND_PORT="PORT",e.BACKEND_FQDN="BACKEND_FQDN",e.BACKEND_SHEME="BACKEND_SHEME"}(ap||(ap={}));var lp,up=new Uint8Array(16);function hp(){if(!lp&&!(lp="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return lp(up)}var pp=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function dp(e){return"string"==typeof e&&pp.test(e)}for(var mp=[],fp=0;fp<256;++fp)mp.push((fp+256).toString(16).substr(1));function gp(e,t,n){var s=(e=e||{}).random||(e.rng||hp)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=s[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(mp[e[t+0]]+mp[e[t+1]]+mp[e[t+2]]+mp[e[t+3]]+"-"+mp[e[t+4]]+mp[e[t+5]]+"-"+mp[e[t+6]]+mp[e[t+7]]+"-"+mp[e[t+8]]+mp[e[t+9]]+"-"+mp[e[t+10]]+mp[e[t+11]]+mp[e[t+12]]+mp[e[t+13]]+mp[e[t+14]]+mp[e[t+15]]).toLowerCase();if(!dp(n))throw TypeError("Stringified UUID is invalid");return n}(s)}const _p=new Map([[Nc.QUACK,new ko("/sounds/quack.mp3")],[Nc.DICE_ROLL,new ko("/sounds/dice_roll.mp3")],[Nc.ERROR,new ko("/sounds/error.mp3")],[Nc.HYPERLIKE,new ko("/sounds/hyperlike.mp3")],[Nc.SHOOT,new ko("/sounds/shoot.mp3")],[Nc.WHISTLE,new ko("/sounds/whistle.mp3")],[Nc.POUFFF,new ko("/sounds/poufff.mp3")],[Nc.APPLAUSE,new ko("/sounds/applause.mp3")],[Nc.TICK,new ko("/sounds/tick.mp3")]]),vp=new Map([[Ka.MAIN,new ko("/music/Ken_Hamm-Buckbreak.mp3")]]),yp=new class{constructor(e,t){this.supportedSounds=e,this.supportedMusics=t,this.interfaceState=new Map,this.musicVolumeFader=new ha(No(1)).toDestination(),this.soundVolumeFader=new ha(No(1)).toDestination(),this.currentView=X.NONE,this.toneReady=!1}changeGamePhase(e){return Pe.set(e),Promise.resolve()}removeEntityInterfaceState(e){return this.interfaceState.delete(e),Promise.resolve()}updateEntityInterfaceState(e,t){return this.interfaceState.set(e,t),Promise.resolve()}disableAutoplay(){return ke.set(!1),Promise.resolve()}enableAutoplay(){return ke.set(!0),Promise.resolve()}changeMusicVolumeLevel(e){return this.musicVolumeFader.volume.value=No(e/100),Ee.set(e),Promise.resolve()}changeSoundVolumeLevel(e){return this.soundVolumeFader.volume.value=No(e/100),Oe.set(e),Promise.resolve()}load(){return console.log("Tone loading..."),ko.loaded().then((()=>(console.log("Tone loaded."),this.toneReady=!0,console.log("Tone starting..."),Mo.resume()))).then((()=>(console.log("Tone started."),Promise.resolve()))).catch((e=>Promise.reject(e)))}playMusic(e){console.log("PLAY_MUSIC",e.supportedMusic);const t=this.supportedMusics.get(e.supportedMusic);return this.toneReady?t?t.loaded?this.onMusicReadyToPlay(e,t):Promise.reject(new Error(Au(e))):Promise.reject(new Error(Eu(e))):Promise.reject(new Error(Cu))}playSound(e){console.log("PLAY_SOUND",e.type);const t=this.supportedSounds.get(e.type);return this.toneReady?t?t.loaded?this.onSoundReadyToPlay(e.type,t):Promise.reject(new Error(Tu(e))):Promise.reject(new Error(Su(e))):Promise.reject(new Error(Cu))}retrieveCurrentView(){return Promise.resolve(this.currentView)}notify(e){return console.log("NOTIFY",e.message),Promise.resolve()}updateCleavage(e){return console.log("UPDATE_CLEAVAGE",e),Ae.set(e),Promise.resolve()}changeView(e){return console.log("CHANGE_VIEW",e),this.currentView=e,Se.set(e),Promise.resolve()}onMusicReadyToPlay(e,t){console.log("PLAYING_MUSIC",e.supportedMusic);const n=new Ia(t).connect(this.musicVolumeFader);return n.loop=!0,n.start(),Promise.resolve()}onSoundReadyToPlay(e,t){console.log("PLAYING_SOUND",e);return new Ia(t).connect(this.soundVolumeFader).start(),Promise.resolve()}}(_p,vp),wp=new class extends class{onEvents(e){return Promise.all(e.map((e=>this.onEvent(e)))).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}onEvent(e){return this.controller?this.controller.executeEvent(e):Promise.reject(new Error("Controller not configured."))}configureController(e){this.controller=e}}{sendEvents(e){return Promise.all(e.map((e=>this.sendEvent(e)))).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}sendEvent(e){return console.log("NEW EVENT",e),this.onEvent(e)}},bp={chat:new class{constructor(e,t=!1){this.eventBus=e,this.twitchClientDebug=t,this.isClientConnected=!1,this.tmiClient=null,this.channel=null}sendMessage(e){return null===this.tmiClient?Promise.reject(new Error(pu)):this.channel?this.isClientConnected?this.sendTmiMessage(this.tmiClient,this.channel,e):Promise.reject(new Error(fu)):Promise.reject(new Error(du(e.message)))}connect(e,t,n){const s={identity:{username:e,password:t},options:{debug:this.twitchClientDebug}},i=new uu.Client(s);return this.tmiClient=i,this.clientEvents(),this.tmiClient.connect().then((([e,t])=>(this.isClientConnected=!0,i.join(n)))).then((e=>{console.log("channel join - promise resolved"),this.channel=n})).catch((e=>Promise.reject(e)))}sendMessageToPlayer(e){return null===this.tmiClient?Promise.reject(new Error(pu)):this.channel?this.isClientConnected?this.sendTmiMessage(this.tmiClient,this.channel,e):Promise.reject(new Error(fu)):Promise.reject(new Error(du(e.message)))}sendTmiMessage(e,t,n){const s=n.message.split("\n");return n instanceof vc&&(s[0]=wu(new vc(n.player,s[0]))),Promise.all(s.map((n=>e.say(t,n)))).then((e=>Promise.resolve())).catch((e=>Promise.reject(e)))}disconnect(){return null===this.tmiClient?Promise.reject(new Error(pu)):this.channel?this.isClientConnected?this.tmiClient.part(this.channel).then((e=>(console.info(vu),null===this.tmiClient?Promise.reject(new Error(pu)):this.tmiClient.disconnect()))).then((([e,t])=>(console.log(yu,"host :",e,"port :",t),this.isClientConnected=!1,this.tmiClient=null,this.channel=null,Promise.resolve()))).catch((e=>Promise.reject(e))):Promise.reject(new Error(fu)):Promise.reject(new Error(du("")))}isConnected(){return Promise.resolve(this.isClientConnected)}clientEvents(){if(null===this.tmiClient)throw new Error(pu);this.tmiClient.on("join",((e,t,n)=>{console.log(bu(e,t))})),this.tmiClient.on("part",((e,t,n)=>{console.log(xu(e,t)),this.eventBus.sendEvent(new oc(t))})),this.tmiClient.on("connected",((e,t)=>{console.log(gu(e,t))})),this.tmiClient.on("connecting",((e,t)=>{console.log(mu(e,t))})),this.tmiClient.on("disconnected",(e=>{console.log(yu,"Reason :",e)})),this.tmiClient.on("message",((e,t,n,s)=>{console.log(_u,{channel:e,userstate:t,message:n}),t.username&&this.sendPlayerMessageEventOnEventBus(new hu(new fc({username:t.username}),n))}))}sendPlayerMessageEventOnEventBus(e){this.eventBus.sendEvent(e)}}(wp),event:wp,interface:yp,random:new class{randomIntegerOnRange(e,t){return e=Math.ceil(e),t=Math.floor(t),Promise.resolve(Math.floor(Math.random()*(t-e+1))+e)}},date:new class{retrieveCurrentDate(){return Promise.resolve(new Date)}},globalCleavageDrawPile:new class{constructor(e,t,n){const s=`${e}://${t}${n?`:${parseInt(n).toString()}`:""}`;this.backendApiInstance=cp.create({baseURL:s}),console.log(`${this.constructor.name} with backend base url: ${s}`)}drawGlobalCleavage(){return this.backendApiInstance.get(op.GLOBAL_CLEAVAGE_DRAWPILE_DRAW).then((e=>(console.log(e.data),Promise.resolve(e.data?new _c(e.data):void 0)))).catch((e=>Promise.reject(e)))}save(e){return this.backendApiInstance.post(op.GLOBAL_CLEAVAGE_DRAWPILE_SAVE,e).then((e=>Promise.resolve(e.data))).catch((e=>Promise.reject(e)))}}("http","localhost","8888"),uuid:new class{nextId(){return Promise.resolve(gp())}}},xp={publicCleavageDrawPile:new class{constructor(){this.publicCleavages=[]}isCleavageExistByTitle(e){return Promise.resolve(this.publicCleavages.some((t=>t.title===e.title)))}addCleavage(e){return this.publicCleavages.push(e),Promise.resolve()}nextCleavage(){return Promise.resolve(this.publicCleavages.shift())}},currentCleavage:new class{hasCleavage(){return Promise.resolve(!!this.cleavage)}load(){return this.cleavage?Promise.resolve(this.cleavage):Promise.reject(new Error("Cleavage is undefined."))}save(e){return this.cleavage=e,Promise.resolve()}},player:new class{constructor(){this.currentPlayers=new Map}playerByUsername(e){const t=this.currentPlayers.get(e);return t?Promise.resolve(t):Promise.reject(new Error(`Player with username '${e}' not found.`))}hasPlayer(e){return Promise.resolve(this.currentPlayers.has(e.username))}loadAllPlayers(){return Promise.resolve([...this.currentPlayers.values()])}remove(e){return this.currentPlayers.delete(e.username),Promise.resolve()}save(e){return this.currentPlayers.set(e.username,e),Promise.resolve()}},autoplay:new class{constructor(){this.autoplayInterval=0}configureNextAutoPlay(e){return this.nextCleavageDate=e||void 0,Promise.resolve()}configureAutoplayInterval(e){return this.autoplayInterval=e,Promise.resolve()}retreiveAutoplayInterval(){return Promise.resolve(this.autoplayInterval)}retrieveNextAutoPlayDate(){return this.nextCleavageDate?Promise.resolve(this.nextCleavageDate):Promise.reject(new Error("next autoplay date is undefined."))}hasAutoplay(){return Promise.resolve(void 0!==this.nextCleavageDate)}},gamePhase:new class{constructor(){this.currentGamePhase=Ce.NONE}changeGamePhase(e){return this.currentGamePhase=e,Promise.resolve()}retrieveCurrentGamePhase(){return Promise.resolve(this.currentGamePhase)}},bar:new class{constructor(){this.availableTableStools=[],this.occupiedTableStools=new Map,this.availableBarStools=[],this.occupiedBarStools=new Map,this.tables=[],this.tableDirection=Qa.RIGHT,this.bar={id:"0",position:{x:0,y:0},size:{height:0,width:0}}}addAvailableBarStool(e){return this.availableBarStools.push(e),Promise.resolve()}installBar(e){return this.bar=e,Promise.resolve()}freeBarStool(e){const t=this.occupiedBarStools.get(e);return t?(this.occupiedBarStools.delete(e),this.availableBarStools.push(t),Promise.resolve()):Promise.reject(new Error(`Occupied bar stool with user ${e} not found.`))}nextOccupiedBarStool(){const e=[...this.occupiedBarStools.keys()].at(0),t=e?this.occupiedBarStools.get(e):void 0;return e&&t?Promise.resolve({username:e,stool:t}):Promise.resolve(void 0)}retrieveTableById(e){const t=this.tables.find((t=>t.id===e));return t?Promise.resolve(t):Promise.reject(new Error(`Table with id '${e}' missing on ${this.constructor.name}`))}addAvailableTableStool(e){return this.availableTableStools.push(e),Promise.resolve()}updateTableDirection(e){return this.tableDirection=e,Promise.resolve()}retreiveTableDirection(){return Promise.resolve(this.tableDirection)}retrieveBar(){return Promise.resolve(this.bar)}retrieveTables(){return Promise.resolve(this.tables)}addTable(e){return this.tables.push(e),Promise.resolve()}setOccupiedBarStool(e,t){return this.occupiedBarStools.set(e,t),Promise.resolve()}setOccupiedTableStool(e,t){return this.occupiedTableStools.set(e,t),Promise.resolve()}nextAvailableTableStool(){const e=this.availableTableStools.shift();return e?Promise.resolve(e):Promise.reject(new Error("No table stool available."))}nextAvailableBarStool(){const e=this.availableBarStools.shift();return e?Promise.resolve(e):Promise.reject(new Error("No bar stool available."))}hasAvailableTableStool(){return Promise.resolve(this.availableTableStools.length>0)}hasAvailableBarStool(){return Promise.resolve(this.availableBarStools.length>0)}}},Cp=new class{constructor(e,t){this.gateways=e,this.repositories=t}start(){return console.log("Application starting..."),this.gateways.interface.load().then((()=>{const e={chat:new mc(this.gateways.chat,this.gateways.interface),event:new bc(this.gateways.event),cleavage:new wc(this.repositories.publicCleavageDrawPile,this.gateways.globalCleavageDrawPile,this.repositories.currentCleavage,this.gateways.chat,this.repositories.gamePhase),interface:new xc(this.gateways.interface),player:new Tc(this.repositories.player,this.gateways.event),autoplay:new tc(this.repositories.autoplay,this.gateways.date),bar:new uc(this.repositories.bar,this.gateways.event,this.gateways.uuid)};this.gateways.event.configureController(new Cl(e)),Te.subscribe((e=>{e&&this.gateways.event.sendEvent(e)})),Te.set(new Ac),console.log("Application started.");return setInterval((()=>this.gateways.event.sendEvent(new Sc)),1e3*1),Promise.resolve()})).catch((e=>console.error(e)))}}(bp,xp);function Tp(t){let n,s,i,r,o,a,p,m;return{c(){n=h("main"),s=h("h1"),s.textContent="Le jeu du clivage",i=d(),r=h("p"),r.textContent="Un jeu open source et gratuit inspiré du jeu d'Usul et Cotentin de l'émission Mediapart - Ouvrez Les Guillemets nommé \"Le jeu du clivage\".",o=d(),a=h("h2"),a.textContent="<<< cliquer n'importe où pour lancer le jeu >>>",g(s,"class","text-no-emphasis sm:text-4xl text-lg"),g(r,"class","text-no-emphasis w-full md:w-1/2 p-3 sm:text-lg text-sm font-light"),g(a,"class","text-no-emphasis sm:text-2xl text-xs font-light animate-pulse "),g(n,"class","bg-dark-background h-full w-full flex flex-col items-center justify-evenly p-3 text-center")},m(e,u){l(e,n,u),c(n,s),c(n,i),c(n,r),c(n,o),c(n,a),p||(m=f(n,"click",t[0]),p=!0)},p:e,i:e,o:e,d(e){e&&u(n),p=!1,m()}}}function Ap(e){let t=!1;const n=()=>(t=!0,Cp.start().then((()=>Promise.resolve())).catch((e=>(t=!1,Promise.reject(e)))));return[()=>t?Promise.resolve():n()]}class Sp extends z{constructor(e){super(),Y(this,e,Ap,Tp,r,{})}}const Ep=new Map([[Nc.APPLAUSE,"Benjamin Bohec"],[Nc.DICE_ROLL,"Benjamin Bohec"],[Nc.ERROR,"Windows XP - Error"],[Nc.HYPERLIKE,"Kaamelott - Perceval"],[Nc.POUFFF,"Piff the Magic Dragon"],[Nc.QUACK,"Benjamin Bohec"],[Nc.SHOOT,"The Simpsons - Homer"],[Nc.TICK,"Benjamin Bohec"],[Nc.WHISTLE,"Benjamin Bohec"]]);function Op(t){let n,s,i,r,o,a,p,m,f,_,v,y,w,b,x,C,T,A,S,E,O,k;return i=new we({}),o=new _e({props:{subtitle:"Credits"}}),m=new _e({props:{subtitle:"Team"}}),_=new De({props:{text:t[0],center:!0}}),y=new _e({props:{subtitle:"Sounds"}}),b=new De({props:{text:t[1],center:!0}}),C=new _e({props:{subtitle:"Musics"}}),A=new De({props:{text:t[2],center:!0}}),O=new ne({props:{onClick:t[3],text:"Menu Principal!"}}),{c(){n=h("main"),s=h("div"),q(i.$$.fragment),r=d(),q(o.$$.fragment),a=d(),p=h("div"),q(m.$$.fragment),f=d(),q(_.$$.fragment),v=d(),q(y.$$.fragment),w=d(),q(b.$$.fragment),x=d(),q(C.$$.fragment),T=d(),q(A.$$.fragment),S=d(),E=h("div"),q(O.$$.fragment),g(s,"class","flex flex-col w-full items-center"),g(p,"class","flex flex-col w-full items-center"),g(E,"class","flex flex-col w-full items-center"),g(n,"class","bg-dark-background h-full w-full flex flex-col justify-evenly")},m(e,t){l(e,n,t),c(n,s),U(i,s,null),c(s,r),U(o,s,null),c(n,a),c(n,p),U(m,p,null),c(p,f),U(_,p,null),c(p,v),U(y,p,null),c(p,w),U(b,p,null),c(p,x),U(C,p,null),c(p,T),U(A,p,null),c(n,S),c(n,E),U(O,E,null),k=!0},p:e,i(e){k||(G(i.$$.fragment,e),G(o.$$.fragment,e),G(m.$$.fragment,e),G(_.$$.fragment,e),G(y.$$.fragment,e),G(b.$$.fragment,e),G(C.$$.fragment,e),G(A.$$.fragment,e),G(O.$$.fragment,e),k=!0)},o(e){B(i.$$.fragment,e),B(o.$$.fragment,e),B(m.$$.fragment,e),B(_.$$.fragment,e),B(y.$$.fragment,e),B(b.$$.fragment,e),B(C.$$.fragment,e),B(A.$$.fragment,e),B(O.$$.fragment,e),k=!1},d(e){e&&u(n),W(i),W(o),W(m),W(_),W(y),W(b),W(C),W(A),W(O)}}}function kp(e){return["Lead Developer - Benjamin Bohec",new Array(...Ep).map((([e,t])=>`${e} - ${t}`)).join("<br>"),"Main Music - Ken Hamm - Buckbreak",()=>Te.set(new Q(X.MAIN_MENU))]}class Pp extends z{constructor(e){super(),Y(this,e,kp,Op,r,{})}}function $p(t){let n,s,i;return{c(){n=h("div"),s=h("p"),i=p(t[0]),g(s,"class","p-2 font-sans font-bold text-center"),g(n,"class","flex flex-col w-full")},m(e,t){l(e,n,t),c(n,s),c(s,i)},p(e,[t]){1&t&&v(i,e[0])},i:e,o:e,d(e){e&&u(n)}}}function Mp(e,t,n){let s,{qty:i}=t;return C((()=>{n(0,s="");for(let e=0;e<i;e++)n(0,s+="😀")})),e.$$set=e=>{"qty"in e&&n(1,i=e.qty)},[s,i]}class Rp extends z{constructor(e){super(),Y(this,e,Mp,$p,r,{qty:1})}}function Np(e){let t,n,s,i,r,o;return t=new Rp({props:{qty:e[1].leftChoice.players.length}}),s=new Rp({props:{qty:e[1].players.length-(e[1].leftChoice.players.length+e[1].rightChoice.players.length)}}),r=new Rp({props:{qty:e[1].rightChoice.players.length}}),{c(){q(t.$$.fragment),n=d(),q(s.$$.fragment),i=d(),q(r.$$.fragment)},m(e,a){U(t,e,a),l(e,n,a),U(s,e,a),l(e,i,a),U(r,e,a),o=!0},p(e,n){const i={};2&n&&(i.qty=e[1].leftChoice.players.length),t.$set(i);const o={};2&n&&(o.qty=e[1].players.length-(e[1].leftChoice.players.length+e[1].rightChoice.players.length)),s.$set(o);const a={};2&n&&(a.qty=e[1].rightChoice.players.length),r.$set(a)},i(e){o||(G(t.$$.fragment,e),G(s.$$.fragment,e),G(r.$$.fragment,e),o=!0)},o(e){B(t.$$.fragment,e),B(s.$$.fragment,e),B(r.$$.fragment,e),o=!1},d(e){W(t,e),e&&u(n),W(s,e),e&&u(i),W(r,e)}}}function Ip(e){let t,n,s=e[0]===Ce.CLEAVING&&e[1]&&Np(e);return{c(){t=h("div"),s&&s.c(),g(t,"class","flex flex-row w-full h-full items-center justify-between")},m(e,i){l(e,t,i),s&&s.m(t,null),n=!0},p(e,[n]){e[0]===Ce.CLEAVING&&e[1]?s?(s.p(e,n),3&n&&G(s,1)):(s=Np(e),s.c(),G(s,1),s.m(t,null)):s&&(V(),B(s,1,1,(()=>{s=null})),j())},i(e){n||(G(s),n=!0)},o(e){B(s),n=!1},d(e){e&&u(t),s&&s.d()}}}function Lp(e,t,n){let s,i;return o(e,Pe,(e=>n(0,s=e))),o(e,Ae,(e=>n(1,i=e))),[s,i]}class Dp extends z{constructor(e){super(),Y(this,e,Lp,Ip,r,{})}}function Vp(e){let t,n;return t=new _e({props:{subtitle:"Préparation du nouveau clivage"}}),{c(){q(t.$$.fragment)},m(e,s){U(t,e,s),n=!0},i(e){n||(G(t.$$.fragment,e),n=!0)},o(e){B(t.$$.fragment,e),n=!1},d(e){W(t,e)}}}function jp(e){let t,n;return t=new _e({props:{subtitle:`${e[1]}/${e[0]} joueurs ont clivés`}}),{c(){q(t.$$.fragment)},m(e,s){U(t,e,s),n=!0},p(e,n){const s={};3&n&&(s.subtitle=`${e[1]}/${e[0]} joueurs ont clivés`),t.$set(s)},i(e){n||(G(t.$$.fragment,e),n=!0)},o(e){B(t.$$.fragment,e),n=!1},d(e){W(t,e)}}}function Gp(e){let t,n,s,i=e[2]===Ce.NEW_CLEAVAGE&&Vp(),r=e[2]===Ce.CLEAVING&&jp(e);return{c(){t=h("div"),i&&i.c(),n=d(),r&&r.c(),g(t,"class","flex flex-col w-full")},m(e,o){l(e,t,o),i&&i.m(t,null),c(t,n),r&&r.m(t,null),s=!0},p(e,[s]){e[2]===Ce.NEW_CLEAVAGE?i?4&s&&G(i,1):(i=Vp(),i.c(),G(i,1),i.m(t,n)):i&&(V(),B(i,1,1,(()=>{i=null})),j()),e[2]===Ce.CLEAVING?r?(r.p(e,s),4&s&&G(r,1)):(r=jp(e),r.c(),G(r,1),r.m(t,null)):r&&(V(),B(r,1,1,(()=>{r=null})),j())},i(e){s||(G(i),G(r),s=!0)},o(e){B(i),B(r),s=!1},d(e){e&&u(t),i&&i.d(),r&&r.d()}}}function Bp(e,t,n){let s;o(e,Pe,(e=>n(2,s=e)));let i,{cleaveLeftChoice:r}=t,{cleaveRightChoice:a}=t,{players:c}=t;return C((()=>{n(1,i=r.players.length+a.players.length)})),e.$$set=e=>{"cleaveLeftChoice"in e&&n(3,r=e.cleaveLeftChoice),"cleaveRightChoice"in e&&n(4,a=e.cleaveRightChoice),"players"in e&&n(0,c=e.players)},[c,i,s,r,a]}class Fp extends z{constructor(e){super(),Y(this,e,Bp,Gp,r,{cleaveLeftChoice:3,cleaveRightChoice:4,players:0})}}function qp(e){let t,n,s="Left"===e[1]&&Up(e),i="Right"===e[1]&&Wp(e);return{c(){s&&s.c(),t=d(),i&&i.c(),n=m()},m(e,r){s&&s.m(e,r),l(e,t,r),i&&i.m(e,r),l(e,n,r)},p(e,r){"Left"===e[1]?s?s.p(e,r):(s=Up(e),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null),"Right"===e[1]?i?i.p(e,r):(i=Wp(e),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(e){s&&s.d(e),e&&u(t),i&&i.d(e),e&&u(n)}}}function Up(e){let t,n,s,i;return{c(){t=p(e[2]),n=d(),s=p(e[3]),i=p("%")},m(e,r){l(e,t,r),l(e,n,r),l(e,s,r),l(e,i,r)},p(e,n){4&n&&v(t,e[2]),8&n&&v(s,e[3])},d(e){e&&u(t),e&&u(n),e&&u(s),e&&u(i)}}}function Wp(e){let t,n,s;return{c(){t=p(e[3]),n=p("% "),s=p(e[2])},m(e,i){l(e,t,i),l(e,n,i),l(e,s,i)},p(e,n){8&n&&v(t,e[3]),4&n&&v(s,e[2])},d(e){e&&u(t),e&&u(n),e&&u(s)}}}function Hp(e){let t;return{c(){t=p(e[2])},m(e,n){l(e,t,n)},p(e,n){4&n&&v(t,e[2])},d(e){e&&u(t)}}}function Yp(t){let n,s,i,r=t[4]===Ce.CLEAVING&&qp(t),o=t[4]===Ce.NEW_CLEAVAGE&&Hp(t);return{c(){n=h("p"),r&&r.c(),s=d(),o&&o.c(),g(n,"class",i="p-2 font-sans font-bold "+(t[5]<33?"":t[5]<66?"rotate-3":"-rotate-3")+" break-all text-5xl text-center "+("Red"===t[0]?"text-cleave-left":"text-cleave-right"))},m(e,t){l(e,n,t),r&&r.m(n,null),c(n,s),o&&o.m(n,null)},p(e,[t]){e[4]===Ce.CLEAVING?r?r.p(e,t):(r=qp(e),r.c(),r.m(n,s)):r&&(r.d(1),r=null),e[4]===Ce.NEW_CLEAVAGE?o?o.p(e,t):(o=Hp(e),o.c(),o.m(n,null)):o&&(o.d(1),o=null),1&t&&i!==(i="p-2 font-sans font-bold "+(e[5]<33?"":e[5]<66?"rotate-3":"-rotate-3")+" break-all text-5xl text-center "+("Red"===e[0]?"text-cleave-left":"text-cleave-right"))&&g(n,"class",i)},i:e,o:e,d(e){e&&u(n),r&&r.d(),o&&o.d()}}}function zp(e,t,n){let s;o(e,Pe,(e=>n(4,s=e)));let{color:i}=t,{choiceType:r}=t,{choiceName:a}=t,{choicePercentageText:c}=t;const l=100*Math.random();return e.$$set=e=>{"color"in e&&n(0,i=e.color),"choiceType"in e&&n(1,r=e.choiceType),"choiceName"in e&&n(2,a=e.choiceName),"choicePercentageText"in e&&n(3,c=e.choicePercentageText)},[i,r,a,c,s,l]}class Xp extends z{constructor(e){super(),Y(this,e,zp,Yp,r,{color:0,choiceType:1,choiceName:2,choicePercentageText:3})}}function Zp(e){let t,n,s;return n=new Xp({props:{choiceName:e[0],choicePercentageText:e[3],choiceType:e[2],color:e[1]}}),{c(){t=h("div"),q(n.$$.fragment),g(t,"class","flex flex-col w-full")},m(e,i){l(e,t,i),U(n,t,null),s=!0},p(e,[t]){const s={};1&t&&(s.choiceName=e[0]),8&t&&(s.choicePercentageText=e[3]),4&t&&(s.choiceType=e[2]),2&t&&(s.color=e[1]),n.$set(s)},i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){e&&u(t),W(n)}}}function Jp(e,t,n){let s,{text:i=""}=t,{cleave:r}=t,{totalCleave:o}=t,{color:a}=t,{choiceType:c}=t;return C((()=>{const e=0===o?0:r/o*100;n(3,s=e%1==0?e.toString():(Math.round(100*e)/100).toFixed(2))})),e.$$set=e=>{"text"in e&&n(0,i=e.text),"cleave"in e&&n(4,r=e.cleave),"totalCleave"in e&&n(5,o=e.totalCleave),"color"in e&&n(1,a=e.color),"choiceType"in e&&n(2,c=e.choiceType)},[i,a,c,s,r,o]}class Kp extends z{constructor(e){super(),Y(this,e,Jp,Zp,r,{text:0,cleave:4,totalCleave:5,color:1,choiceType:2})}}function Qp(e){let t,n,s,i,r,o,a,p,m;function f(t){e[4](t)}let _={choiceType:"Left",color:"Red",cleave:e[0].players.length,totalCleave:e[3]};function v(t){e[5](t)}void 0!==e[0].name&&(_.text=e[0].name),n=new Kp({props:_}),A.push((()=>F(n,"text",f))),r=new Fp({props:{players:e[2],cleaveLeftChoice:e[0],cleaveRightChoice:e[1]}});let y={choiceType:"Right",color:"Blue",cleave:e[1].players.length,totalCleave:e[3]};return void 0!==e[1].name&&(y.text=e[1].name),a=new Kp({props:y}),A.push((()=>F(a,"text",v))),{c(){t=h("div"),q(n.$$.fragment),i=d(),q(r.$$.fragment),o=d(),q(a.$$.fragment),g(t,"class","flex w-full flex-row")},m(e,s){l(e,t,s),U(n,t,null),c(t,i),U(r,t,null),c(t,o),U(a,t,null),m=!0},p(e,[t]){const i={};1&t&&(i.cleave=e[0].players.length),8&t&&(i.totalCleave=e[3]),!s&&1&t&&(s=!0,i.text=e[0].name,$((()=>s=!1))),n.$set(i);const o={};4&t&&(o.players=e[2]),1&t&&(o.cleaveLeftChoice=e[0]),2&t&&(o.cleaveRightChoice=e[1]),r.$set(o);const c={};2&t&&(c.cleave=e[1].players.length),8&t&&(c.totalCleave=e[3]),!p&&2&t&&(p=!0,c.text=e[1].name,$((()=>p=!1))),a.$set(c)},i(e){m||(G(n.$$.fragment,e),G(r.$$.fragment,e),G(a.$$.fragment,e),m=!0)},o(e){B(n.$$.fragment,e),B(r.$$.fragment,e),B(a.$$.fragment,e),m=!1},d(e){e&&u(t),W(n),W(r),W(a)}}}function ed(e,t,n){let s,{cleaveLeftChoice:i}=t,{cleaveRightChoice:r}=t,{players:o}=t;return C((()=>{n(3,s=i.players.length+r.players.length)})),e.$$set=e=>{"cleaveLeftChoice"in e&&n(0,i=e.cleaveLeftChoice),"cleaveRightChoice"in e&&n(1,r=e.cleaveRightChoice),"players"in e&&n(2,o=e.players)},[i,r,o,s,function(t){e.$$.not_equal(i.name,t)&&(i.name=t,n(0,i))},function(t){e.$$.not_equal(r.name,t)&&(r.name=t,n(1,r))}]}class td extends z{constructor(e){super(),Y(this,e,ed,Qp,r,{cleaveLeftChoice:0,cleaveRightChoice:1,players:2})}}function nd(t){let n,s,i,r;return n=new we({}),i=new _e({props:{subtitle:"Préparation du nouveau clivage"}}),{c(){q(n.$$.fragment),s=d(),q(i.$$.fragment)},m(e,t){U(n,e,t),l(e,s,t),U(i,e,t),r=!0},p:e,i(e){r||(G(n.$$.fragment,e),G(i.$$.fragment,e),r=!0)},o(e){B(n.$$.fragment,e),B(i.$$.fragment,e),r=!1},d(e){W(n,e),e&&u(s),W(i,e)}}}function sd(e){let t,n,s,i;return t=new we({props:{title:e[0].title,rotate:!1}}),s=new td({props:{cleaveLeftChoice:e[0].leftChoice,cleaveRightChoice:e[0].rightChoice,players:e[0].players.length}}),{c(){q(t.$$.fragment),n=d(),q(s.$$.fragment)},m(e,r){U(t,e,r),l(e,n,r),U(s,e,r),i=!0},p(e,n){const i={};1&n&&(i.title=e[0].title),t.$set(i);const r={};1&n&&(r.cleaveLeftChoice=e[0].leftChoice),1&n&&(r.cleaveRightChoice=e[0].rightChoice),1&n&&(r.players=e[0].players.length),s.$set(r)},i(e){i||(G(t.$$.fragment,e),G(s.$$.fragment,e),i=!0)},o(e){B(t.$$.fragment,e),B(s.$$.fragment,e),i=!1},d(e){W(t,e),e&&u(n),W(s,e)}}}function id(e){let t,n,s,i;const r=[sd,nd],o=[];function a(e,t){return e[0]?0:1}return n=a(e),s=o[n]=r[n](e),{c(){t=h("div"),s.c(),g(t,"class","flex flex-col px-2 pt-2 w-full items-center")},m(e,s){l(e,t,s),o[n].m(t,null),i=!0},p(e,[i]){let c=n;n=a(e),n===c?o[n].p(e,i):(V(),B(o[c],1,1,(()=>{o[c]=null})),j(),s=o[n],s?s.p(e,i):(s=o[n]=r[n](e),s.c()),G(s,1),s.m(t,null))},i(e){i||(G(s),i=!0)},o(e){B(s),i=!1},d(e){e&&u(t),o[n].d()}}}function rd(e,t,n){let s;return o(e,Ae,(e=>n(0,s=e))),[s]}class od extends z{constructor(e){super(),Y(this,e,rd,id,r,{})}}class ad extends J{constructor(){super(...arguments),this.eventType=Z.CANCEL_CLEAVAGE}}class cd extends J{constructor(e){super(),this.autoplayMinutes=e,this.eventType=Z.START_AUTOPLAY}}class ld extends J{constructor(){super(...arguments),this.eventType=Z.STOP_AUTOPLAY}}function ud(t){let n,s,i,r;return{c(){n=h("input"),g(n,"class",s="p-1 m-2 w-1/3 "+(t[4]?"text-2xl":"text-xl")+" "+(t[5]<33?"":t[5]<66?"rotate-3":"-rotate-3")+" rounded-xl border-low-emphasis focus:border-medium-emphasis focus:ring-1 focus:ring-medium-emphasis text-no-emphasis placeholder-no-emphasis border-2 bg-dark-background font-sans text-center"),g(n,"type","number"),g(n,"min","0"),g(n,"id",t[2]),g(n,"name",t[3]),n.required=!0,g(n,"placeholder",t[1])},m(e,s){l(e,n,s),y(n,t[0]),i||(r=f(n,"input",t[6]),i=!0)},p(e,[t]){16&t&&s!==(s="p-1 m-2 w-1/3 "+(e[4]?"text-2xl":"text-xl")+" "+(e[5]<33?"":e[5]<66?"rotate-3":"-rotate-3")+" rounded-xl border-low-emphasis focus:border-medium-emphasis focus:ring-1 focus:ring-medium-emphasis text-no-emphasis placeholder-no-emphasis border-2 bg-dark-background font-sans text-center")&&g(n,"class",s),4&t&&g(n,"id",e[2]),8&t&&g(n,"name",e[3]),2&t&&g(n,"placeholder",e[1]),1&t&&_(n.value)!==e[0]&&y(n,e[0])},i:e,o:e,d(e){e&&u(n),i=!1,r()}}}function hd(e,t,n){let{inputValue:s}=t,{placeholder:i}=t,{id:r}=t,{name:o}=t,{mainInput:a=!1}=t;const c=100*Math.random();return e.$$set=e=>{"inputValue"in e&&n(0,s=e.inputValue),"placeholder"in e&&n(1,i=e.placeholder),"id"in e&&n(2,r=e.id),"name"in e&&n(3,o=e.name),"mainInput"in e&&n(4,a=e.mainInput)},[s,i,r,o,a,c,function(){s=_(this.value),n(0,s)}]}class pd extends z{constructor(e){super(),Y(this,e,hd,ud,r,{inputValue:0,placeholder:1,id:2,name:3,mainInput:4})}}function dd(e){let t,n,s,i,r;function o(t){e[4](t)}let a={id:"autoPlayTime",name:"autoPlayTime",placeholder:"Auto play time"};return void 0!==e[0]&&(a.inputValue=e[0]),t=new pd({props:a}),A.push((()=>F(t,"inputValue",o))),i=new ne({props:{onClick:e[2],text:"Start Auto Play!"}}),{c(){q(t.$$.fragment),s=d(),q(i.$$.fragment)},m(e,n){U(t,e,n),l(e,s,n),U(i,e,n),r=!0},p(e,s){const i={};!n&&1&s&&(n=!0,i.inputValue=e[0],$((()=>n=!1))),t.$set(i)},i(e){r||(G(t.$$.fragment,e),G(i.$$.fragment,e),r=!0)},o(e){B(t.$$.fragment,e),B(i.$$.fragment,e),r=!1},d(e){W(t,e),e&&u(s),W(i,e)}}}function md(t){let n,s;return n=new ne({props:{onClick:t[3],text:"Stop Auto Play!"}}),{c(){q(n.$$.fragment)},m(e,t){U(n,e,t),s=!0},p:e,i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){W(n,e)}}}function fd(e){let t,n,s,i;const r=[md,dd],o=[];function a(e,t){return e[1]?0:1}return n=a(e),s=o[n]=r[n](e),{c(){t=h("div"),s.c(),g(t,"class","flex flex-row items-end justify-end")},m(e,s){l(e,t,s),o[n].m(t,null),i=!0},p(e,[i]){let c=n;n=a(e),n===c?o[n].p(e,i):(V(),B(o[c],1,1,(()=>{o[c]=null})),j(),s=o[n],s?s.p(e,i):(s=o[n]=r[n](e),s.c()),G(s,1),s.m(t,null))},i(e){i||(G(s),i=!0)},o(e){B(s),i=!1},d(e){e&&u(t),o[n].d()}}}function gd(e,t,n){let s;o(e,ke,(e=>n(1,s=e)));let i=3;const r=e=>Te.set(e);return[i,s,()=>r(new cd(i)),()=>r(new ld),function(e){i=e,n(0,i)}]}class _d extends z{constructor(e){super(),Y(this,e,gd,fd,r,{})}}function vd(t){let n,s,i,r,o,a,c,p;return r=new ne({props:{onClick:t[4],text:"Nouveau clivage!"}}),c=new _d({}),{c(){n=h("div"),s=d(),i=h("div"),q(r.$$.fragment),o=d(),a=h("div"),q(c.$$.fragment),g(n,"class","flex flex-col w-full items-start"),g(i,"class","flex flex-col w-full items-center"),g(a,"class","flex flex-col w-full items-end justify-end")},m(e,t){l(e,n,t),l(e,s,t),l(e,i,t),U(r,i,null),l(e,o,t),l(e,a,t),U(c,a,null),p=!0},p:e,i(e){p||(G(r.$$.fragment,e),G(c.$$.fragment,e),p=!0)},o(e){B(r.$$.fragment,e),B(c.$$.fragment,e),p=!1},d(e){e&&u(n),e&&u(s),e&&u(i),W(r),e&&u(o),e&&u(a),W(c)}}}function yd(e){let t,n,s,i,r,o,a,p,m,f,_,v;n=new ne({props:{onClick:e[7],text:"Menu Principal!"}});let y=!e[2]&&wd(e);const w=[xd,bd],b=[];function x(e,t){return e[0].title.length>0&&e[0].leftChoice.name.length>0&&e[0].rightChoice.name.length>0?0:1}return a=x(e),p=b[a]=w[a](e),_=new _d({}),{c(){t=h("div"),q(n.$$.fragment),s=d(),i=h("div"),y&&y.c(),r=d(),o=h("div"),p.c(),m=d(),f=h("div"),q(_.$$.fragment),g(t,"class","flex flex-col w-full items-start justify-end"),g(o,"class","flex flex-row w-full items-center justify-center"),g(i,"class","flex flex-col w-full items-center"),g(f,"class","flex flex-col w-full items-end justify-end")},m(e,u){l(e,t,u),U(n,t,null),l(e,s,u),l(e,i,u),y&&y.m(i,null),c(i,r),c(i,o),b[a].m(o,null),l(e,m,u),l(e,f,u),U(_,f,null),v=!0},p(e,t){e[2]?y&&(V(),B(y,1,1,(()=>{y=null})),j()):y?(y.p(e,t),4&t&&G(y,1)):(y=wd(e),y.c(),G(y,1),y.m(i,r));let n=a;a=x(e),a===n?b[a].p(e,t):(V(),B(b[n],1,1,(()=>{b[n]=null})),j(),p=b[a],p?p.p(e,t):(p=b[a]=w[a](e),p.c()),G(p,1),p.m(o,null))},i(e){v||(G(n.$$.fragment,e),G(y),G(p),G(_.$$.fragment,e),v=!0)},o(e){B(n.$$.fragment,e),B(y),B(p),B(_.$$.fragment,e),v=!1},d(e){e&&u(t),W(n),e&&u(s),e&&u(i),y&&y.d(),b[a].d(),e&&u(m),e&&u(f),W(_)}}}function wd(e){let t,n,s,i,r,o,a,p,m,f;function _(t){e[8](t)}let v={id:"title",name:"title",type:"textarea",mainInput:!0,placeholder:"On clive sur quoi?"};function y(t){e[9](t)}void 0!==e[0].title&&(v.inputValue=e[0].title),t=new le({props:v}),A.push((()=>F(t,"inputValue",_)));let w={id:"leftChoice",name:"leftChoice",placeholder:"Choix?"};function b(t){e[10](t)}void 0!==e[0].leftChoice.name&&(w.inputValue=e[0].leftChoice.name),r=new le({props:w}),A.push((()=>F(r,"inputValue",y)));let x={id:"rightChoice",name:"rightChoice",placeholder:"Choix?"};return void 0!==e[0].rightChoice.name&&(x.inputValue=e[0].rightChoice.name),p=new le({props:x}),A.push((()=>F(p,"inputValue",b))),{c(){q(t.$$.fragment),s=d(),i=h("div"),q(r.$$.fragment),a=d(),q(p.$$.fragment),g(i,"class","flex flex-row items-center")},m(e,n){U(t,e,n),l(e,s,n),l(e,i,n),U(r,i,null),c(i,a),U(p,i,null),f=!0},p(e,s){const i={};!n&&1&s&&(n=!0,i.inputValue=e[0].title,$((()=>n=!1))),t.$set(i);const a={};!o&&1&s&&(o=!0,a.inputValue=e[0].leftChoice.name,$((()=>o=!1))),r.$set(a);const c={};!m&&1&s&&(m=!0,c.inputValue=e[0].rightChoice.name,$((()=>m=!1))),p.$set(c)},i(e){f||(G(t.$$.fragment,e),G(r.$$.fragment,e),G(p.$$.fragment,e),f=!0)},o(e){B(t.$$.fragment,e),B(r.$$.fragment,e),B(p.$$.fragment,e),f=!1},d(e){W(t,e),e&&u(s),e&&u(i),W(r),W(p)}}}function bd(t){let n,s;return n=new ne({props:{onClick:t[6],size:"large",text:"🎲"}}),{c(){q(n.$$.fragment)},m(e,t){U(n,e,t),s=!0},p:e,i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){W(n,e)}}}function xd(t){let n,s,i,r,o,a;return n=new ne({props:{onClick:t[3],text:"Let'z go!",wfull:!0}}),i=new ne({props:{onClick:t[6],size:"large",text:"🎲"}}),o=new ne({props:{onClick:t[5],text:"heu... non 😅",wfull:!0}}),{c(){q(n.$$.fragment),s=d(),q(i.$$.fragment),r=d(),q(o.$$.fragment)},m(e,t){U(n,e,t),l(e,s,t),U(i,e,t),l(e,r,t),U(o,e,t),a=!0},p:e,i(e){a||(G(n.$$.fragment,e),G(i.$$.fragment,e),G(o.$$.fragment,e),a=!0)},o(e){B(n.$$.fragment,e),B(i.$$.fragment,e),B(o.$$.fragment,e),a=!1},d(e){W(n,e),e&&u(s),W(i,e),e&&u(r),W(o,e)}}}function Cd(e){let t,n,s,i=e[1]===Ce.CLEAVING&&vd(e),r=e[1]===Ce.NEW_CLEAVAGE&&yd(e);return{c(){t=h("div"),i&&i.c(),n=d(),r&&r.c(),g(t,"class","flex flex-row w-full px-2 pb-2")},m(e,o){l(e,t,o),i&&i.m(t,null),c(t,n),r&&r.m(t,null),s=!0},p(e,[s]){e[1]===Ce.CLEAVING?i?(i.p(e,s),2&s&&G(i,1)):(i=vd(e),i.c(),G(i,1),i.m(t,n)):i&&(V(),B(i,1,1,(()=>{i=null})),j()),e[1]===Ce.NEW_CLEAVAGE?r?(r.p(e,s),2&s&&G(r,1)):(r=yd(e),r.c(),G(r,1),r.m(t,null)):r&&(V(),B(r,1,1,(()=>{r=null})),j())},i(e){s||(G(i),G(r),s=!0)},o(e){B(i),B(r),s=!1},d(e){e&&u(t),i&&i.d(),r&&r.d()}}}function Td(e,t,n){let s,i,r,c;o(e,Te,(e=>n(11,s=e))),o(e,Pe,(e=>n(1,i=e))),o(e,Ae,(e=>n(2,r=e)));const l=()=>new _c({title:"",leftChoice:{name:"Gôche",players:[]},rightChoice:{name:"Drouate",players:[]},players:[]}),u=e=>{n(0,c=l()),Te.set(e)};return Ae.subscribe((e=>{console.log("UPDATED CURRENT CLEAVAGE STORE"),n(0,c=e||l())})),[c,i,r,()=>u(new zc(c.title,c.leftChoice.name,c.rightChoice.name)),()=>a(Te,s=new Fe,s),()=>u(new ad),()=>u(new Zc),()=>u(new Q(X.MAIN_MENU)),function(t){e.$$.not_equal(c.title,t)&&(c.title=t,n(0,c))},function(t){e.$$.not_equal(c.leftChoice.name,t)&&(c.leftChoice.name=t,n(0,c))},function(t){e.$$.not_equal(c.rightChoice.name,t)&&(c.rightChoice.name=t,n(0,c))}]}class Ad extends z{constructor(e){super(),Y(this,e,Td,Cd,r,{})}}function Sd(t){let n,s,i,r,o,a,p;return s=new od({}),r=new Dp({}),a=new Ad({}),{c(){n=h("main"),q(s.$$.fragment),i=d(),q(r.$$.fragment),o=d(),q(a.$$.fragment),g(n,"class","bg-dark-background h-full w-full flex flex-col justify-between")},m(e,t){l(e,n,t),U(s,n,null),c(n,i),U(r,n,null),c(n,o),U(a,n,null),p=!0},p:e,i(e){p||(G(s.$$.fragment,e),G(r.$$.fragment,e),G(a.$$.fragment,e),p=!0)},o(e){B(s.$$.fragment,e),B(r.$$.fragment,e),B(a.$$.fragment,e),p=!1},d(e){e&&u(n),W(s),W(r),W(a)}}}class Ed extends z{constructor(e){super(),Y(this,e,null,Sd,r,{})}}function Od(t){let n,s;return n=new Ge({}),{c(){q(n.$$.fragment)},m(e,t){U(n,e,t),s=!0},p:e,i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){W(n,e)}}}function kd(t){let n,s;return n=new Pp({}),{c(){q(n.$$.fragment)},m(e,t){U(n,e,t),s=!0},p:e,i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){W(n,e)}}}function Pd(t){let n,s;return n=new Qe({}),{c(){q(n.$$.fragment)},m(e,t){U(n,e,t),s=!0},p:e,i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){W(n,e)}}}function $d(t){let n,s;return n=new Sp({}),{c(){q(n.$$.fragment)},m(e,t){U(n,e,t),s=!0},p:e,i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){W(n,e)}}}function Md(t){let n,s;return n=new We({}),{c(){q(n.$$.fragment)},m(e,t){U(n,e,t),s=!0},p:e,i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){W(n,e)}}}function Rd(t){let n,s;return n=new Ed({}),{c(){q(n.$$.fragment)},m(e,t){U(n,e,t),s=!0},p:e,i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){W(n,e)}}}function Nd(t){let n,s;return n=new Ne({}),{c(){q(n.$$.fragment)},m(e,t){U(n,e,t),s=!0},p:e,i(e){s||(G(n.$$.fragment,e),s=!0)},o(e){B(n.$$.fragment,e),s=!1},d(e){W(n,e)}}}function Id(t){let n,s,i,r;const o=[jd,Vd,Dd,Ld],a=[];return~(n=function(e,t){return e[1]===X.CONNECT_CHAT?0:e[1]===X.GAME?1:e[1]===X.SETTINGS?2:e[1]===X.ABOUT?3:-1}(t))&&(s=a[n]=o[n](t)),{c(){s&&s.c(),i=m()},m(e,t){~n&&a[n].m(e,t),l(e,i,t),r=!0},p:e,i(e){r||(G(s),r=!0)},o(e){B(s),r=!1},d(e){~n&&a[n].d(e),e&&u(i)}}}function Ld(e){let t,n;return t=new Ge({}),{c(){q(t.$$.fragment)},m(e,s){U(t,e,s),n=!0},i(e){n||(G(t.$$.fragment,e),n=!0)},o(e){B(t.$$.fragment,e),n=!1},d(e){W(t,e)}}}function Dd(e){let t,n;return t=new Qe({}),{c(){q(t.$$.fragment)},m(e,s){U(t,e,s),n=!0},i(e){n||(G(t.$$.fragment,e),n=!0)},o(e){B(t.$$.fragment,e),n=!1},d(e){W(t,e)}}}function Vd(e){let t,n;return t=new Ed({}),{c(){q(t.$$.fragment)},m(e,s){U(t,e,s),n=!0},i(e){n||(G(t.$$.fragment,e),n=!0)},o(e){B(t.$$.fragment,e),n=!1},d(e){W(t,e)}}}function jd(e){let t,n;return t=new Ne({}),{c(){q(t.$$.fragment)},m(e,s){U(t,e,s),n=!0},i(e){n||(G(t.$$.fragment,e),n=!0)},o(e){B(t.$$.fragment,e),n=!1},d(e){W(t,e)}}}function Gd(e){let t,n,s,i;const r=[Id,Nd,Rd,Md,$d,Pd,kd,Od],o=[];function a(e,t){return e[1]?0:e[0]===X.CONNECT_CHAT?1:e[0]===X.GAME?2:e[0]===X.MAIN_MENU?3:e[0]===X.INTRO?4:e[0]===X.SETTINGS?5:e[0]===X.CREDITS?6:e[0]===X.ABOUT?7:-1}return~(t=a(e))&&(n=o[t]=r[t](e)),{c(){n&&n.c(),s=m()},m(e,n){~t&&o[t].m(e,n),l(e,s,n),i=!0},p(e,[i]){let c=t;t=a(e),t===c?~t&&o[t].p(e,i):(n&&(V(),B(o[c],1,1,(()=>{o[c]=null})),j()),~t?(n=o[t],n?n.p(e,i):(n=o[t]=r[t](e),n.c()),G(n,1),n.m(s.parentNode,s)):n=null)},i(e){i||(G(n),i=!0)},o(e){B(n),i=!1},d(e){~t&&o[t].d(e),e&&u(s)}}}function Bd(e,t,n){let s,i,r;var c;return o(e,Te,(e=>n(2,s=e))),o(e,Se,(e=>n(0,i=e))),Se.set(X.INTRO),c=()=>a(Te,s=new Be,s),x().$$.on_destroy.push(c),[i,r]}return new class extends z{constructor(e){super(),Y(this,e,Bd,Gd,r,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
